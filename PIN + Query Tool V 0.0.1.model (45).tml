guid: c7bfaf9f-483b-49a4-9a3e-fd44d3e5cd70
obj_id: PINQueryToolV0.0.1-c7bfaf9f
model:
  name: PIN + Query Tool V 0.0.1
  description: This worksheet, titled "PIN + Query Tool V 0.0.1," provides a comprehensive analysis of various financial and sales metrics related to automotive transactions. It includes detailed information on different types of sales, financing options, incentive offerings, and customer demographics. Additionally, the worksheet tracks performance metrics over different periods, such as sales days and months, and provides insights into inventory management and pricing strategies. (AI generated)
  model_tables:
  - name: PIN_RETAIL_DATA_DIGEST_FINAL_V3
    fqn: fbe60b49-b29d-4e59-9b3c-a7a14bda7e63
  formulas:
  - id: formula_% Core Spending
    name: '% Core Spending'
    expr: if ( [formula_Core Spending/Unit] >= 0.0 ) then [formula_Core Spending/Unit] / [formula_Incentive Spending] else 0
  - id: formula_% No Traditional Incentives Penetration
    name: '% No Traditional Incentives Penetration'
    expr: ifnull ( [formula_% Cash Without Customer Cash Rebate] , 0 ) + ifnull ( [formula_% Captive Non-Supported Finance Without Customer Cash Rebate] , 0 ) + ifnull ( [formula_% Non-Captive Non-Supported Finance] , 0 ) + ifnull ( [formula_% Captive Non-Supported Lease Without Customer Cash Rebate] , 0 ) + ifnull ( [formula_% Non-Captive Non-Supported Lease] , 0 )
  - id: formula_% Captive Non-Supported Finance Without Customer Cash Rebate
    name: '% Captive Non-Supported Finance Without Customer Cash Rebate'
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_nonsupported_finance_without_ccrebate.capt_nosubd_noreba_pct')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_nonsupported_finance_without_ccrebate.capt_nosubd_noreba_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_nonsupported_finance_without_ccrebate.capt_nosubd_noreba_pct')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Captive Non-Supported Lease Without Customer Cash Rebate
    name: '% Captive Non-Supported Lease Without Customer Cash Rebate'
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_nonsupported_lease_without_ccrebate.capt_nosubl_noreba_pct')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_nonsupported_lease_without_ccrebate.capt_nosubl_noreba_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_nonsupported_lease_without_ccrebate.capt_nosubl_noreba_pct')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Cash Without Customer Cash Rebate
    name: '% Cash Without Customer Cash Rebate'
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_cash_without_cc_rebate.noreba_pct')" ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_cash_without_cc_rebate.noreba_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_cash_without_cc_rebate.noreba_pct')" ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Non-Captive Non-Supported Finance
    name: '% Non-Captive Non-Supported Finance'
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_noncaptive_nonsupported_finance.nocaptd_noreba_pct')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_noncaptive_nonsupported_finance.nocaptd_noreba_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_noncaptive_nonsupported_finance.nocaptd_noreba_pct')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Non-Captive Non-Supported Lease
    name: '% Non-Captive Non-Supported Lease'
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_noncaptive_nonsupported_lease.nocaptl_noreba_pct')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_noncaptive_nonsupported_lease.nocaptl_noreba_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_noncaptive_nonsupported_lease.nocaptl_noreba_pct')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Non-Core Spending
    name: '% Non-Core Spending'
    expr: 'if ( [formula_Non-Core Cash Incentive Spending: Wgt''d $/unit] >= 0.0 ) then ( [formula_Non-Core Spending/Unit] / [formula_Incentive Spending] ) else 0'
  - id: formula_% Non-Visible Spending
    name: '% Non-Visible Spending'
    expr: '[formula_Non-Visible Spending/Unit] / [formula_Incentive Spending]'
  - id: formula_% Total Penetration
    name: '% Total Penetration'
    expr: '[formula_% Cash Type of Sale] + [formula_% Finance Type of Sale] + [formula_% Lease Type of Sale]'
  - id: formula_% Cash Type of Sale
    name: '% Cash Type of Sale'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_cash_typeofsale.cash_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Finance Type of Sale
    name: '% Finance Type of Sale'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_finance_typeofsale.fin_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Lease Type of Sale
    name: '% Lease Type of Sale'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_lease_typeofsale.lease_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Traditional Incentives Penetration
    name: '% Traditional Incentives Penetration'
    expr: '[formula_% Cash With Customer Cash Rebate] + [formula_% Captive Supported Finance APR] + [formula_% Captive Supported Combo] + [formula_% Captive Non-Supported Finance With Customer Cash Rebate] + [formula_% Non-Captive OEM Supported Finance] + [formula_% Captive Supported Lease] + [formula_% Captive Non-Supported Lease With Customer Cash Rebate] + [formula_% Non-Captive OEM Supported Lease]'
  - id: formula_% Captive Non-Supported Finance With Customer Cash Rebate
    name: '% Captive Non-Supported Finance With Customer Cash Rebate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_nonsupported_finance_with_ccrebate.capt_nosubd_reba_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Captive Non-Supported Lease With Customer Cash Rebate
    name: '% Captive Non-Supported Lease With Customer Cash Rebate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_nonsupported_lease_with_ccrebate.capt_nosubl_reba_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Captive Supported Combo
    name: '% Captive Supported Combo'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_supported_combo.rbsd_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Captive Supported Finance APR
    name: '% Captive Supported Finance APR'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_supported_finance_apr.subd_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Captive Supported Lease
    name: '% Captive Supported Lease'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_captive_supported_lease.subl_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Cash With Customer Cash Rebate
    name: '% Cash With Customer Cash Rebate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_cash_with_customercashrebate.reba_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Non-Captive OEM Supported Finance
    name: '% Non-Captive OEM Supported Finance'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_noncaptive_oem_supported_finance.nocaptd_reba_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Non-Captive OEM Supported Lease
    name: '% Non-Captive OEM Supported Lease'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.percent_noncaptive_oem_supported_lease.nocaptl_reba_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_% Visible Spending
    name: '% Visible Spending'
    expr: '[formula_Visible Spending/Unit] / [formula_Incentive Spending]'
  - id: formula_13 Month Trend Dim
    name: 13 Month Trend Dim
    expr: if ( [13 Month Trend Dimension] = 'OEM' ) then [formula_OEM] else if ( [13 Month Trend Dimension] = 'Segment' ) then [formula_Client Segment] else if ( [13 Month Trend Dimension] = 'Super Segment' ) then [formula_Super Segment] else if ( [13 Month Trend Dimension] = 'Series' ) then [formula_Series] else if ( [13 Month Trend Dimension] = 'Model' ) then [formula_Model] else if ( [13 Month Trend Dimension] = 'Industry' ) then '' else if ( [13 Month Trend Dimension] = 'Class' ) then [formula_Premium Flag] else if ( [13 Month Trend Dimension] = 'Nameplate' ) then [formula_Nameplate] else null
  - id: formula_60M PMT - Finance (49-60)
    name: 60M PMT - Finance (49-60)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthlypayment_term_wtd.mopmt49_60fin_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthlypayment_term_weights.mopmt49_60fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_72M PMT - Finance (61-72)
    name: 72M PMT - Finance (61-72)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthlypayment_term_wtd.mopmt61_72fin_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthlypayment_term_weights.mopmt61_72fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_72mo+ Term Mix
    name: 72mo+ Term Mix
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_term_weights.term_fin_72_plus_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_84M PMT - Finance (73-84)
    name: 84M PMT - Finance (73-84)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthlypayment_term_wtd.mopmt73_84fin_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthlypayment_term_weights.mopmt73_84fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_84mo+ Term Mix
    name: 84mo+ Term Mix
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_term_weights.term_fin_84_plus_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_AH Insurance Income
    name: AH Insurance Income
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disability_insurance_premium.disabilityinsprem_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) > 0 ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disabilityinsincome.disabilityinsincome_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disability_insurance_premium.disabilityinsprem_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) > 0 ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_AH Insurance Penetration (%)
    name: AH Insurance Penetration (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disability_insurance_premium.disabilityinsprem_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) > 0 ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disability_insurance_premium.disabilityinsprem_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_price.totalprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_price.totalprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_AH Insurance Premium
    name: AH Insurance Premium
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disability_insurance_premium.disabilityinsprem_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disability_insurance_premium.disabilityinsprem_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Aged Inventory Program: $ Offer'
    name: 'Aged Inventory Program: $ Offer'
    expr: '[formula_Aged Inventory Program: Wgt''d $/unit] / [formula_Aged Inventory Program: Take Rate]'
  - id: 'formula_Aged Inventory Program: Take Rate'
    name: 'Aged Inventory Program: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.aged_inventory_program_takerate.aip_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.aged_inventory_program_takerate.aip_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Aged Inventory Program: Wgt''d $/unit'
    name: 'Aged Inventory Program: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.aged_inventory_program.aip_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.aged_inventory_program.aip_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Aggregate Payment (Sum of all payments over the entire lease term)
    name: Aggregate Payment (Sum of all payments over the entire lease term)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.aggregatepmt')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_All
    name: All
    expr: '''All'''
  - id: formula_Average APR
    name: Average APR
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.apr.apr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.apr.apr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Average Amount Financed
    name: Average Amount Financed
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.amountfinanced.amountfinanced_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.amountfinanced.amountfinanced_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Average Disability Income
    name: Average Disability Income
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disabilityinsincome.disabilityinsincome_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disabilityinsincome.disabilityinsincome_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Average Disability Insurance
    name: Average Disability Insurance
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disability_insurance_cost.disabilityinscost_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.disability_insurance_cost.disabilityinscost_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Average FI Income
    name: Average FI Income
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.fi_income.fi_income_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.fi_income.fi_income_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Average Finance Lease Reserve
    name: Average Finance Lease Reserve
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.financeleasereserve.financeleasereserve_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.financeleasereserve.financeleasereserve_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Average Term
    name: Average Term
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.term.term_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.term.term_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Average Total Price
    name: Average Total Price
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_price.totalprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_price.totalprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Average Trade Equity Percent
    name: Average Trade Equity Percent
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradeequity.tradeequity_pct_Wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradeequity.tradeequity_pct_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Avg Finance APR
    name: Avg Finance APR
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_apr.apr_fin_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_apr.apr_fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Avg Finance Term
    name: Avg Finance Term
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_term.financeterm_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_term.financeterm_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Avg Lease APR
    name: Avg Lease APR
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_apr.apr_lease_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_apr.apr_lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Avg Lease Term
    name: Avg Lease Term
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_term.leaseterm_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_term.leaseterm_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Buy Rate APR/IRR
    name: Buy Rate APR/IRR
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.buyrate.buyrate_apr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.buyrate.buyrate_apr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_CFTP % of MSRP
    name: CFTP % of MSRP
    expr: ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) ) / ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.imputed_msrp.msrp_isr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.imputed_msrp.msrp_isr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) )
  - id: formula_CFTP Above MSRP (%)
    name: CFTP Above MSRP (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' and [formula_CFTP PCT MSRP] > 1 ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' and [formula_CFTP PCT MSRP] > 0 ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_CFTP PCT MSRP
    name: CFTP PCT MSRP
    expr: ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) ) / ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.imputed_msrp.msrp_isr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.imputed_msrp.msrp_isr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) )
  - id: formula_Captive %
    name: Captive %
    expr: ( sum ( if ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.msrp.msrp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Y' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) ) / ( sum ( if ( concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.lender')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) != 'null' and not contains ( concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.lender')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) , 'INV' ) and not contains ( concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.lender')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) , 'N/AP' ) and not contains ( concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.lender')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) , 'N/AV' ) and concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.msrp.msrp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) )
  - id: 'formula_Captive Lender Customer Bonus - Finance Type of Sale: $ Offer'
    name: 'Captive Lender Customer Bonus - Finance Type of Sale: $ Offer'
    expr: '[formula_Captive Lender Customer Bonus - Finance Type of Sale: Wgt''d $/unit] / [formula_Captive Lender Customer Bonus - Finance Type of Sale: Take Rate]'
  - id: 'formula_Captive Lender Customer Bonus - Finance Type of Sale: Take Rate'
    name: 'Captive Lender Customer Bonus - Finance Type of Sale: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_cust_bonuscash_tos_finance_takerate.fbcsh_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_cust_bonuscash_tos_finance_takerate.fbcsh_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Captive Lender Customer Bonus - Finance Type of Sale: Wgt''d $/unit'
    name: 'Captive Lender Customer Bonus - Finance Type of Sale: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_cust_bonuscash_tos_finance.fbcsh_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_cust_bonuscash_tos_finance.fbcsh_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Captive Lender Customer Bonus - Lease Type of Sale: $ Offer'
    name: 'Captive Lender Customer Bonus - Lease Type of Sale: $ Offer'
    expr: '[formula_Captive Lender Customer Bonus - Lease Type of Sale: Wgt''d $/unit] / [formula_Captive Lender Customer Bonus - Lease Type of Sale: Take Rate]'
  - id: 'formula_Captive Lender Customer Bonus - Lease Type of Sale: Take Rate'
    name: 'Captive Lender Customer Bonus - Lease Type of Sale: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_cust_bonuscash_tos_lease_takerate.fbcsh_ls_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_cust_bonuscash_tos_lease_takerate.fbcsh_ls_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Captive Lender Customer Bonus - Lease Type of Sale: Wgt''d $/unit'
    name: 'Captive Lender Customer Bonus - Lease Type of Sale: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_cust_bonuscash_tos_lease.fbcsh_ls_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_cust_bonuscash_tos_lease.fbcsh_ls_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Captive Lender Dealer Cash - Finance Type of Sale: $ Offer'
    name: 'Captive Lender Dealer Cash - Finance Type of Sale: $ Offer'
    expr: '[formula_Captive Lender Dealer Cash - Finance Type of Sale: Wgt''d $/unit] / [formula_Captive Lender Dealer Cash - Finance Type of Sale: Take Rate]'
  - id: 'formula_Captive Lender Dealer Cash - Finance Type of Sale: Take Rate'
    name: 'Captive Lender Dealer Cash - Finance Type of Sale: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_dealercash_finance_tos_takerate.ldcbcshf_fi_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_dealercash_finance_tos_takerate.ldcbcshf_fi_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Captive Lender Dealer Cash - Finance Type of Sale: Wgt''d $/unit'
    name: 'Captive Lender Dealer Cash - Finance Type of Sale: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_dealercash_finance_tos.ldcbcshf_fi_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_dealercash_finance_tos.ldcbcshf_fi_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Captive Lender Dealer Cash - Lease Type of Sale: $ Offer'
    name: 'Captive Lender Dealer Cash - Lease Type of Sale: $ Offer'
    expr: '[formula_Captive Lender Dealer Cash - Lease Type of Sale: Wgt''d $/unit] / [formula_Captive Lender Dealer Cash - Lease Type of Sale: Take Rate]'
  - id: 'formula_Captive Lender Dealer Cash - Lease Type of Sale: Take Rate'
    name: 'Captive Lender Dealer Cash - Lease Type of Sale: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_dealercash_lease_tos_takerate.ldcbcsh_ls_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_dealercash_lease_tos_takerate.ldcbcsh_ls_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Captive Lender Dealer Cash - Lease Type of Sale: Wgt''d $/unit'
    name: 'Captive Lender Dealer Cash - Lease Type of Sale: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_dealercash_lease_tos.ldcbcsh_ls_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_dealercash_lease_tos.ldcbcsh_ls_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Cash %
    name: Cash %
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = '*N/AP' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.cash_weight.cash_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'Y' , 'N' , '*N/AP' } ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Cash Incentive Offering/Unit
    name: Cash Incentive Offering/Unit
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cash_incentivespending_per_unit.cash_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cash_incentive_penetration.cash_incntv_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Cash Rebate Penetration (%)
    name: Cash Rebate Penetration (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.customer_cash_rebate.customercashrebate_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) / ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.retail_transactions_measure_group.total_price.totalprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) < 0.3 ) then 1 else ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.customer_cash_rebate.customercashrebate_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.customer_cash_rebate.customercashrebate_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) / ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.retail_transactions_measure_group.total_price.totalprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) < 0.3 ) then 1 else ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_price.totalprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) )
  - id: formula_City of Origin
    name: City of Origin
    expr: concat ( sql_string_op ( "json_value(vehicleattributes, '$.factory_city')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Class
    name: Class
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Color
    name: Color
    expr: concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.color')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Combo APR
    name: Combo APR
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.comboapr.comb_aprd_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.comboapr.comb_aprd_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Combo Down Payment
    name: Combo Down Payment
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_combo_downpayment.cmbtotaldown_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_combo_downpayment.cmbtotaldown_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Combo Monthly Payment
    name: Combo Monthly Payment
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_combo_monthlypayment.cmbmonthlyp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_combo_monthlypayment.cmbmonthlyp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Conquest Cash: $ Offer'
    name: 'Conquest Cash: $ Offer'
    expr: '[formula_Conquest Cash: Wgt''d $/unit] / [formula_Conquest Cash: Take Rate]'
  - id: 'formula_Conquest Cash: Take Rate'
    name: 'Conquest Cash: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.conquest_cash_takerate.cqcsh_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.conquest_cash_takerate.cqcsh_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Conquest Cash: Wgt''d $/unit'
    name: 'Conquest Cash: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.conquest_cash.cqcsh_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.conquest_cash.cqcsh_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Consumer Bonus Cash: $ Offer'
    name: 'Consumer Bonus Cash: $ Offer'
    expr: '[formula_Consumer Bonus Cash: Wgt''d $/unit] / [formula_Consumer Bonus Cash: Take Rate]'
  - id: 'formula_Consumer Bonus Cash: Take Rate'
    name: 'Consumer Bonus Cash: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.consumer_bonuscash_takerate.cbcsh_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.consumer_bonuscash_takerate.cbcsh_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Consumer Bonus Cash: Wgt''d $/unit'
    name: 'Consumer Bonus Cash: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.consumer_bonuscash.cbcsh_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.consumer_bonuscash.cbcsh_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Consumer Expenditure
    name: Consumer Expenditure
    expr: '[formula_Retail Sales] * [formula_CFTP]'
  - id: formula_Contract Price
    name: Contract Price
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.contractprice.contractprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.contractprice.contractprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Core Cash Offer/Unit
    name: Core Cash Offer/Unit
    expr: '[formula_Core Cash Incentive Spending: Wgt''d $/unit] / [formula_Cash Incentive Penetration]'
  - id: formula_Core Finance Offer/Unit
    name: Core Finance Offer/Unit
    expr: '[formula_Core Finance Incentive Spending: Wgt''d $/unit] / [formula_Supported Finance Incentive Penetration]'
  - id: formula_Core Lease Offer/Unit
    name: Core Lease Offer/Unit
    expr: '[formula_Core Lease Incentive Spending: Wgt''d $/unit] / [formula_Supported Lease Incentive Penetration]'
  - id: formula_Core Spending/Unit
    name: Core Spending/Unit
    expr: '[formula_Core Cash Incentive Spending: Wgt''d $/unit] + [formula_Core Finance Incentive Spending: Wgt''d $/unit] + [formula_Core Lease Incentive Spending: Wgt''d $/unit]'
  - id: 'formula_Core Cash Incentive Spending: Wgt''d $/unit'
    name: 'Core Cash Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.core_cash_incentive_spending_per_unit.core_cash_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.core_cash_incentive_spending_per_unit.core_cash_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Core Finance Incentive Spending: Wgt''d $/unit'
    name: 'Core Finance Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.core_finance_incentive_spending_per_unit.core_fi_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Core Lease Incentive Spending: Wgt''d $/unit'
    name: 'Core Lease Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.core_lease_incentive_spending_per_unit.core_ls_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Country
    name: Country
    expr: concat ( sql_string_op ( "json_value(geography, '$.country')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Country of Origin
    name: Country of Origin
    expr: concat ( sql_string_op ( "json_value(vehicleattributes, '$.factory_country')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Credit Score
    name: Credit Score
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.creditscore_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.creditscore_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Current Month
    name: Current Month
    expr: group_aggregate ( max ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) , query_groups ( ) , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = 0 } )
  - id: formula_Customer Age
    name: Customer Age
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Customer Age 18-35 (%)
    name: Customer Age 18-35 (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_18_35_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Customer Age 35-55 (%)
    name: Customer Age 35-55 (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_36_55_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Customer Age 56+ (%)
    name: Customer Age 56+ (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_56_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Customer Cash Rebate Penetration
    name: Customer Cash Rebate Penetration
    expr: ( if ( ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.customer_cash_rebate.Cust_Cash_Reba_pene')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != 'null' ) then 1 else 0 ) / ( if ( ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price.vehprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != 'null' ) then 1 else 0 )
  - id: 'formula_Customer Cash Rebate: $ Offer'
    name: 'Customer Cash Rebate: $ Offer'
    expr: '[formula_Customer Cash Rebate: Wgt''d $/unit] / [formula_Customer Cash Rebate: Take Rate]'
  - id: formula_Customer cash rebate  $ offer value
    name: Customer cash rebate  $ offer value
    expr: '[formula_Customer Cash Rebate: Wgt''d $/unit] / [formula_Customer Cash Rebate: Take Rate]'
  - id: 'formula_Customer Cash Rebate: Take Rate'
    name: 'Customer Cash Rebate: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cust_cash_rebate_takerate.reba_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cust_cash_rebate_takerate.reba_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Customer Cash Rebate: Wgt''d $/unit'
    name: 'Customer Cash Rebate: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cust_cash_rebate.reba_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cust_cash_rebate.reba_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Date Filter
    name: Date Filter
    expr: if ( ts_groups = 'pin_lucid' ) then if ( to_date ( '2021-08-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_acura' ) then if ( to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_afs' ) then if ( to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_audi' ) then if ( to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_ford' ) then if ( to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_genesis' ) then if ( to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_gm' ) then if ( to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_hatcigenesis' ) then if ( to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_hatcihyundai' ) then if ( to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_hatcikia' ) then if ( to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_honda' ) then if ( to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_honda_corp' ) then if ( to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_honda_incentive' ) then if ( to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_hyundai' ) then if ( to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_infiniti' ) then if ( to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_jlr' ) then if ( to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_mazda' ) then if ( to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_nissan' ) then if ( to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_nissan_incentive' ) then if ( to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_rivian' ) then if ( to_date ( '2023-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_set' ) then if ( to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_volvo' ) then if ( to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_gst' ) then if ( to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_maserati' ) then if ( to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_mitsu' ) then if ( to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_porsche' ) then if ( to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_subaru' ) then if ( to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_tms_lexus' ) then if ( to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_tms_toyota' ) then if ( to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_vci' ) then if ( to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_vw' ) then if ( to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) then true else null else if ( ts_groups = 'pin_kia' or ts_groups = 'pin_kia_incentive' ) then if ( ( add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Forecast' , 'Incentives - Regular' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) or ( add_years ( start_of_year ( now ( ) ) , - 3 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' ) or ( add_years ( start_of_year ( now ( ) ) , - 7 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' ) ) then true else null else if ( ts_groups = 'pin_mercedes' ) then if ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Explorer - New' , 'Explorer - Used' } ) or ( not ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Explorer - New' , 'Explorer - Used' } ) and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) then true else null else if ( ts_groups = 'pin_stellantis' ) then if ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and add_months ( start_of_month ( now ( ) ) , - 24 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] != 'Market Timer' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) then true else null else true
  - id: formula_Days to Turn
    name: Days to Turn
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.daystoturn.daystoturn_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.daystoturn.daystoturn_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Dealer Cash - Cash Type of Sale: $ Offer'
    name: 'Dealer Cash - Cash Type of Sale: $ Offer'
    expr: '[formula_Dealer Cash - Cash Type of Sale: Wgt''d $/unit] / [formula_Dealer Cash - Cash Type of Sale: Take Rate]'
  - id: 'formula_Dealer Cash - Cash Type of Sale: Take Rate'
    name: 'Dealer Cash - Cash Type of Sale: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash_takerate.dcsh_cash_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash_takerate.dcsh_cash_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Dealer Cash - Cash Type of Sale: Wgt''d $/unit'
    name: 'Dealer Cash - Cash Type of Sale: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash.dcsh_cash_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash.dcsh_cash_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Dealer Cash - Finance Type of Sale: $ Offer'
    name: 'Dealer Cash - Finance Type of Sale: $ Offer'
    expr: '[formula_Dealer Cash - Finance Type of Sale: Wgt''d $/unit] / [formula_Dealer Cash - Finance Type of Sale: Take Rate]'
  - id: 'formula_Dealer Cash - Finance Type of Sale: Take Rate'
    name: 'Dealer Cash - Finance Type of Sale: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash_finance_tos_takerate.dcsh_fi_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash_finance_tos_takerate.dcsh_fi_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Dealer Cash - Finance Type of Sale: Wgt''d $/unit'
    name: 'Dealer Cash - Finance Type of Sale: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash_finance_tos.dcsh_fi_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash_finance_tos.dcsh_fi_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Dealer Cash - Lease Type of Sale: $ Offer'
    name: 'Dealer Cash - Lease Type of Sale: $ Offer'
    expr: '[formula_Dealer Cash - Lease Type of Sale: Wgt''d $/unit] / [formula_Dealer Cash - Lease Type of Sale: Take Rate]'
  - id: 'formula_Dealer Cash - Lease Type of Sale: Take Rate'
    name: 'Dealer Cash - Lease Type of Sale: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash_lease_tos_takerate.dcsh_ls_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash_lease_tos_takerate.dcsh_ls_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Dealer Cash - Lease Type of Sale: Wgt''d $/unit'
    name: 'Dealer Cash - Lease Type of Sale: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash_lease_tos.dcsh_ls_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash_lease_tos.dcsh_ls_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Dealer Reserve
    name: Dealer Reserve
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.financeleasereserve.financeleasereserve_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.financeleasereserve.financeleasereserve_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Dealer Reserve Penetration
    name: Dealer Reserve Penetration
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'n' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.financeleasereserve.financeleasereserve_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) != 0 ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.financeleasereserve.financeleasereserve_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'n' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.financeleasereserve.financeleasereserve_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.financeleasereserve.financeleasereserve_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Dealer Volume Bonus: $ Offer'
    name: 'Dealer Volume Bonus: $ Offer'
    expr: '[formula_Dealer Volume Bonus: Wgt''d $/unit] / [formula_Dealer Volume Bonus: Take Rate]'
  - id: 'formula_Dealer Volume Bonus: Take Rate'
    name: 'Dealer Volume Bonus: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealervolumebonus_takerate.vbcsh_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealervolumebonus_takerate.vbcsh_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Dealer Volume Bonus: Wgt''d $/unit'
    name: 'Dealer Volume Bonus: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealervolumebonus.vbcsh_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealervolumebonus.vbcsh_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Direct Fin Flag
    name: Direct Fin Flag
    expr: concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.directfinflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Distance Per Charge
    name: Distance Per Charge
    expr: ( concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.DISTANCE_PER_CHARGE')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Distribution Dimension 1
    name: Distribution Dimension 1
    expr: if ( [Select Distribution by Dimension 1] = 'Aspiration' ) then [formula_Aspirations] else if ( [Select Distribution by Dimension 1] = 'body type' ) then [formula_Body Type] else if ( [Select Distribution by Dimension 1] = 'body type detail' ) then [formula_Body Type 2] else if ( [Select Distribution by Dimension 1] = 'captive/ non-captive' ) then [formula_Captive Flag] else if ( [Select Distribution by Dimension 1] = 'class' ) then [formula_Premium Flag] else if ( [Select Distribution by Dimension 1] = 'cylinders' ) then [formula_Cylinders] else if ( [Select Distribution by Dimension 1] = 'dealer market area' ) then [formula_DMA] else if ( [Select Distribution by Dimension 1] = 'displacement' ) then [formula_Displacement] else if ( [Select Distribution by Dimension 1] = 'doors' ) then [formula_Doors] else if ( [Select Distribution by Dimension 1] = 'drive type' ) then [formula_Drive Type] else if ( [Select Distribution by Dimension 1] = 'fuel type' ) then [formula_Fuel Type] else if ( [Select Distribution by Dimension 1] = 'incentive type' ) then [formula_Fuel Type] else if ( [Select Distribution by Dimension 1] = 'market' ) then [formula_PIN Market] else if ( [Select Distribution by Dimension 1] = 'model' ) then [formula_Model] else if ( [Select Distribution by Dimension 1] = 'model year' ) then [formula_Model Year] else if ( [Select Distribution by Dimension 1] = 'nameplate' ) then [formula_Nameplate] else if ( [Select Distribution by Dimension 1] = 'new/used' ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] else if ( [Select Distribution by Dimension 1] = 'oem' ) then [formula_OEM] else if ( [Select Distribution by Dimension 1] = 'region' ) then [formula_PIN Region] else if ( [Select Distribution by Dimension 1] = 'trim' ) then [formula_Trim Level] else if ( [Select Distribution by Dimension 1] = 'type of sale' ) then [formula_Type of Sale] else if ( [Select Distribution by Dimension 1] = 'sales time (year)' ) then [formula_Sales Year] else if ( [Select Distribution by Dimension 1] = 'sales time (month)' ) then [formula_Sales Month (String)] else if ( [Select Distribution by Dimension 1] = 'sales time (quarter)' ) then [formula_Sales Quarter] else if ( [Select Distribution by Dimension 1] = 'sector' ) then [formula_Sector] else if ( [Select Distribution by Dimension 1] = 'segment' ) then [formula_Client Segment] else if ( [Select Distribution by Dimension 1] = 'series' ) then [formula_Series] else if ( [Select Distribution by Dimension 1] = 'state' ) then [formula_State] else if ( [Select Distribution by Dimension 1] = 'super segment' ) then [formula_Super Segment] else null
  - id: formula_Distribution Dimension 2
    name: Distribution Dimension 2
    expr: if ( [Select Distribution by Dimension 2] = 'Aspiration' ) then [formula_Aspirations] else if ( [Select Distribution by Dimension 2] = 'body type' ) then [formula_Body Type] else if ( [Select Distribution by Dimension 2] = 'body type detail' ) then [formula_Body Type 2] else if ( [Select Distribution by Dimension 2] = 'captive/ non-captive' ) then [formula_Captive Flag] else if ( [Select Distribution by Dimension 2] = 'class' ) then [formula_Premium Flag] else if ( [Select Distribution by Dimension 2] = 'cylinders' ) then [formula_Cylinders] else if ( [Select Distribution by Dimension 2] = 'dealer market area' ) then [formula_DMA] else if ( [Select Distribution by Dimension 2] = 'displacement' ) then [formula_Displacement] else if ( [Select Distribution by Dimension 2] = 'doors' ) then [formula_Doors] else if ( [Select Distribution by Dimension 2] = 'drive type' ) then [formula_Drive Type] else if ( [Select Distribution by Dimension 2] = 'fuel type' ) then [formula_Fuel Type] else if ( [Select Distribution by Dimension 2] = 'incentive type' ) then [formula_Fuel Type] else if ( [Select Distribution by Dimension 2] = 'market' ) then [formula_PIN Market] else if ( [Select Distribution by Dimension 2] = 'model' ) then [formula_Model] else if ( [Select Distribution by Dimension 2] = 'model year' ) then [formula_Model Year] else if ( [Select Distribution by Dimension 2] = 'nameplate' ) then [formula_Nameplate] else if ( [Select Distribution by Dimension 2] = 'new/used' ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] else if ( [Select Distribution by Dimension 2] = 'oem' ) then [formula_OEM] else if ( [Select Distribution by Dimension 2] = 'region' ) then [formula_PIN Region] else if ( [Select Distribution by Dimension 2] = 'trim' ) then [formula_Trim Level] else if ( [Select Distribution by Dimension 2] = 'type of sale' ) then [formula_Type of Sale] else if ( [Select Distribution by Dimension 2] = 'sales time (year)' ) then [formula_Sales Year] else if ( [Select Distribution by Dimension 2] = 'sales time (month)' ) then [formula_Sales Month (String)] else if ( [Select Distribution by Dimension 2] = 'sales time (quarter)' ) then [formula_Sales Quarter] else if ( [Select Distribution by Dimension 2] = 'sector' ) then [formula_Sector] else if ( [Select Distribution by Dimension 2] = 'segment' ) then [formula_Client Segment] else if ( [Select Distribution by Dimension 2] = 'series' ) then [formula_Series] else if ( [Select Distribution by Dimension 2] = 'state' ) then [formula_State] else if ( [Select Distribution by Dimension 2] = 'super segment' ) then [formula_Super Segment] else null
  - id: formula_Distribution Dimension 3
    name: Distribution Dimension 3
    expr: if ( [Select Distribution by Dimension 3] = 'Aspiration' ) then [formula_Aspirations] else if ( [Select Distribution by Dimension 3] = 'body type' ) then [formula_Body Type] else if ( [Select Distribution by Dimension 3] = 'body type detail' ) then [formula_Body Type 2] else if ( [Select Distribution by Dimension 3] = 'captive/ non-captive' ) then [formula_Captive Flag] else if ( [Select Distribution by Dimension 3] = 'class' ) then [formula_Premium Flag] else if ( [Select Distribution by Dimension 3] = 'cylinders' ) then [formula_Cylinders] else if ( [Select Distribution by Dimension 3] = 'dealer market area' ) then [formula_DMA] else if ( [Select Distribution by Dimension 3] = 'displacement' ) then [formula_Displacement] else if ( [Select Distribution by Dimension 3] = 'doors' ) then [formula_Doors] else if ( [Select Distribution by Dimension 3] = 'drive type' ) then [formula_Drive Type] else if ( [Select Distribution by Dimension 3] = 'fuel type' ) then [formula_Fuel Type] else if ( [Select Distribution by Dimension 3] = 'incentive type' ) then [formula_Fuel Type] else if ( [Select Distribution by Dimension 3] = 'market' ) then [formula_PIN Market] else if ( [Select Distribution by Dimension 3] = 'model' ) then [formula_Model] else if ( [Select Distribution by Dimension 3] = 'model year' ) then [formula_Model Year] else if ( [Select Distribution by Dimension 3] = 'nameplate' ) then [formula_Nameplate] else if ( [Select Distribution by Dimension 3] = 'new/used' ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] else if ( [Select Distribution by Dimension 3] = 'oem' ) then [formula_OEM] else if ( [Select Distribution by Dimension 3] = 'region' ) then [formula_PIN Region] else if ( [Select Distribution by Dimension 3] = 'trim' ) then [formula_Trim Level] else if ( [Select Distribution by Dimension 3] = 'type of sale' ) then [formula_Type of Sale] else if ( [Select Distribution by Dimension 3] = 'sales time (year)' ) then [formula_Sales Year] else if ( [Select Distribution by Dimension 3] = 'sales time (month)' ) then [formula_Sales Month (String)] else if ( [Select Distribution by Dimension 3] = 'sales time (quarter)' ) then [formula_Sales Quarter] else if ( [Select Distribution by Dimension 3] = 'sector' ) then [formula_Sector] else if ( [Select Distribution by Dimension 3] = 'segment' ) then [formula_Client Segment] else if ( [Select Distribution by Dimension 3] = 'series' ) then [formula_Series] else if ( [Select Distribution by Dimension 3] = 'state' ) then [formula_State] else if ( [Select Distribution by Dimension 3] = 'super segment' ) then [formula_Super Segment] else null
  - id: formula_Aspirations
    name: Aspirations
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_kia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Market Timer' } or ( add_years ( start_of_year ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_kia_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Market Timer' } or ( add_years ( start_of_year ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Inventory' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Inventory' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_volvo' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.aspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Body Type
    name: Body Type
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Body Type 2
    name: Body Type 2
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.bodytype2')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Captive Flag
    name: Captive Flag
    expr: concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Cylinders
    name: Cylinders
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.cylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_DMA
    name: DMA
    expr: if ( ts_groups = 'administrator' ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Customer Success' ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Customer Success (Demographics)' ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Internal Non Customer Success' ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_acura' ) then '' else if ( ts_groups = 'pin_afs' ) then concat ( sql_string_op ( "json_value(audi_attributes, '$.audimarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_audi' ) then concat ( sql_string_op ( "json_value(audi_attributes, '$.audimarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_bmw' ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_ford' ) then '' else if ( ts_groups = 'pin_genesis' ) then '' else if ( ts_groups = 'pin_gm' ) then '' else if ( ts_groups = 'pin_hatcigenesis' ) then '' else if ( ts_groups = 'pin_hatcihyundai' ) then '' else if ( ts_groups = 'pin_hatcikia' ) then '' else if ( ts_groups = 'pin_honda' ) then '' else if ( ts_groups = 'pin_honda_corp' ) then '' else if ( ts_groups = 'pin_honda_incentive' ) then '' else if ( ts_groups = 'pin_hyundai' ) then '' else if ( ts_groups = 'pin_infiniti' ) then if ( concat ( sql_string_op ( "lower(json_value(geography,'$.dma'))" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'atlanta' , 'boston (manchester)' , 'cleveland-akron (canton)' , 'dallas-ft. worth' , 'denver' , 'los angeles' , 'miami-ft. lauderdale' , 'minneapolis-st. paul' , 'philadelphia' , 'phoenix (prescott)' , 'san francisco-oak-san jose' , 'washington, dc (hagrstwn)' , 'new york' , 'tampa-st. pete (sarasota)' , 'chicago' } ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else 'Rest of Nation' else if ( ts_groups = 'pin_jlr' ) then '' else if ( ts_groups = 'pin_kia' ) then '' else if ( ts_groups = 'pin_kia_incentive' ) then '' else if ( ts_groups = 'pin_lucid' ) then '' else if ( ts_groups = 'pin_mazda' ) then if ( concat ( sql_string_op ( "lower(json_value(geography,'$.dma'))" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'atlanta' , 'austin' , 'boston (manchester)' , 'chicago' , 'cincinnati' , 'cleveland-akron (canton)' , 'dallas-ft. worth' , 'denver' , 'houston' , 'los angeles' , 'miami-ft. lauderdale' , 'minneapolis-st. paul' , 'orlando-daytona bch-melbrn' , 'philadelphia' , 'phoenix (prescott)' , 'pittsburgh' , 'raleigh-durham (fayetvlle)' , 'sacramnto-stkton-modesto' , 'san antonio' , 'san francisco-oak-san jose' , 'seattle-tacoma' , 'st. louis' , 'washington, dc (hagrstwn)' , 'west palm beach-ft. pierce' , 'new york' } ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else 'Rest of Nation' else if ( ts_groups = 'pin_mercedes' ) then if ( concat ( sql_string_op ( "lower(json_value(geography,'$.dma'))" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'new york' , 'los angeles' , 'miami-ft. lauderdale' , 'chicago' , 'houston' } ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else 'Rest of Nation' else if ( ts_groups = 'pin_nissan' ) then if ( concat ( sql_string_op ( "lower(json_value(geography,'$.dma'))" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'atlanta' , 'boston (manchester)' , 'cleveland-akron (canton)' , 'dallas-ft. worth' , 'denver' , 'los angeles' , 'miami-ft. lauderdale' , 'minneapolis-st. paul' , 'philadelphia' , 'phoenix (prescott)' , 'san francisco-oak-san jose' , 'washington, dc (hagrstwn)' , 'new york' , 'tampa-st. pete (sarasota)' , 'chicago' } ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else 'Rest of Nation' else if ( ts_groups = 'pin_nissan_incentive' ) then if ( concat ( sql_string_op ( "lower(json_value(geography,'$.dma'))" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'atlanta' , 'boston (manchester)' , 'cleveland-akron (canton)' , 'dallas-ft. worth' , 'denver' , 'los angeles' , 'miami-ft. lauderdale' , 'minneapolis-st. paul' , 'philadelphia' , 'phoenix (prescott)' , 'san francisco-oak-san jose' , 'washington, dc (hagrstwn)' , 'new york' , 'tampa-st. pete (sarasota)' , 'chicago' } ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else 'Rest of Nation' else if ( ts_groups = 'pin_rivian' ) then '' else if ( ts_groups = 'pin_set' ) then '' else if ( ts_groups = 'pin_stellantis' ) then if ( concat ( sql_string_op ( "lower(json_value(geography,'$.dma'))" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'new york' , 'los angeles' , 'dallas-ft. worth' , 'chicago' , 'miami-ft. lauderdale' , 'houston' , 'philadelphia' , 'boston (manchester)' , 'san francisco-oak-san jose' , 'washington, dc (hagrstwn)' , 'atlanta' , 'tampa-st. pete (sarasota)' , 'phoenix (prescott)' , 'orlando-daytona bch-melbrn' , 'denver' , 'cleveland-akron (canton)' , 'minneapolis-st. paul' , 'sacramnto-stkton-modesto' , 'san antonio' , 'west palm beach-ft. pierce' , 'san diego' , 'austin' , 'raleigh-durham (fayetvlle)' , 'charlotte' , 'pittsburgh' } ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else 'Rest of Nation' else if ( ts_groups = 'pin_volvo' ) then '' else if ( ts_groups = 'pin_ally' ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_gst' ) then concat ( sql_string_op ( "json_value(geography, '$.dma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_karma' ) then '' else if ( ts_groups = 'pin_maserati' ) then '' else if ( ts_groups = 'pin_mitsu' ) then '' else if ( ts_groups = 'pin_porsche' ) then '' else if ( ts_groups = 'pin_subaru' ) then '' else if ( ts_groups = 'pin_tms_lexus' ) then '' else if ( ts_groups = 'pin_tms_toyota' ) then '' else if ( ts_groups = 'pin_vci' ) then '' else if ( ts_groups = 'pin_vw' ) then '' else if ( ts_groups = 'pin_squarepointcap' ) then '' else if ( ts_groups = 'pin_haval' ) then '' else ''
  - id: formula_Displacement
    name: Displacement
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.displacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Distribution Group Calc
    name: Distribution Group Calc
    expr: if ( [Distribution Metric] = 'Age' ) then if ( floor ( [formula_Filter - Age] / [Bucket Size] ) = ceil ( [formula_Filter - Age] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - Age] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Age] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - Age] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Age] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'CFTP' ) then if ( floor ( [formula_Filter - CFTP] / [Bucket Size] ) = ceil ( [formula_Filter - CFTP] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - CFTP] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - CFTP] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - CFTP] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - CFTP] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Credit Score' ) then if ( floor ( [formula_Filter - Credit Score] / [Bucket Size] ) = ceil ( [formula_Filter - Credit Score] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - Credit Score] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Credit Score] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - Credit Score] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Credit Score] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'DaysToTurn' ) then if ( floor ( [formula_Filter - Days To Turn] / [Bucket Size] ) = ceil ( [formula_Filter - Days To Turn] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - Days To Turn] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Days To Turn] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - Days To Turn] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Days To Turn] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'DaysSupply' ) then if ( floor ( [formula_Filter - Days Supply] / [Bucket Size] ) = ceil ( [formula_Filter - Days Supply] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - Days Supply] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Days Supply] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - Days Supply] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Days Supply] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'FI Income' ) then if ( floor ( [formula_Filter - FI Income] / [Bucket Size] ) = ceil ( [formula_Filter - FI Income] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - FI Income] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - FI Income] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - FI Income] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - FI Income] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Finance APR' ) then if ( floor ( [formula_Filter - APR Fin] / [Bucket Size] ) = ceil ( [formula_Filter - APR Fin] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - APR Fin] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - APR Fin] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - APR Fin] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - APR Fin] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Finance Monthly Payment' ) then if ( floor ( [formula_Filter - MO PMT Fin] / [Bucket Size] ) = ceil ( [formula_Filter - MO PMT Fin] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - MO PMT Fin] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - MO PMT Fin] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - MO PMT Fin] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - MO PMT Fin] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Finance Term' ) then if ( floor ( [formula_Filter - Finance Term] / [Bucket Size] ) = ceil ( [formula_Filter - Finance Term] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - Finance Term] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Finance Term] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - Finance Term] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Finance Term] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Lease APR' ) then if ( floor ( [formula_Filter - APR Lease] / [Bucket Size] ) = ceil ( [formula_Filter - APR Lease] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - APR Lease] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - APR Lease] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - APR Lease] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - APR Lease] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Lease Monthly Payment' ) then if ( floor ( [formula_Filter - MO PMT Lease] / [Bucket Size] ) = ceil ( [formula_Filter - MO PMT Lease] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - MO PMT Lease] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - MO PMT Lease] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - MO PMT Lease] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - MO PMT Lease] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Lease Term' ) then if ( floor ( [formula_Filter - Lease Term] / [Bucket Size] ) = ceil ( [formula_Filter - Lease Term] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - Lease Term] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Lease Term] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - Lease Term] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Lease Term] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'MSRP Distribution' ) then if ( floor ( [formula_Filter - MSRP] / [Bucket Size] ) = ceil ( [formula_Filter - MSRP] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - MSRP] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - MSRP] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - MSRP] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - MSRP] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Total Gross Profit' ) then if ( floor ( [formula_Filter - Total PIN Gross Profit] / [Bucket Size] ) = ceil ( [formula_Filter - Total PIN Gross Profit] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - Total PIN Gross Profit] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Total PIN Gross Profit] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - Total PIN Gross Profit] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Total PIN Gross Profit] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Trade ACV LP Distribution' ) then if ( floor ( [formula_Filter - Trade ACV LP] / [Bucket Size] ) = ceil ( [formula_Filter - Trade ACV LP] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - Trade ACV LP] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Trade ACV LP] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - Trade ACV LP] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Trade ACV LP] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Vehicle Gross' ) then if ( floor ( [formula_Filter - Vehicle Gross] / [Bucket Size] ) = ceil ( [formula_Filter - Vehicle Gross] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - Vehicle Gross] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Vehicle Gross] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - Vehicle Gross] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Vehicle Gross] / [Bucket Size] ) * [Bucket Size] ) ) else if ( [Distribution Metric] = 'Vehicle Price' ) then if ( floor ( [formula_Filter - Vehicle Price] / [Bucket Size] ) = ceil ( [formula_Filter - Vehicle Price] / [Bucket Size] ) ) then concat ( to_string ( floor ( ( [formula_Filter - Vehicle Price] - 1 ) / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Vehicle Price] / [Bucket Size] ) * [Bucket Size] ) ) else concat ( to_string ( floor ( [formula_Filter - Vehicle Price] / [Bucket Size] ) * [Bucket Size] ) , " - " , to_string ( ceil ( [formula_Filter - Vehicle Price] / [Bucket Size] ) * [Bucket Size] ) ) else null
  - id: formula_Distribution Weight
    name: Distribution Weight
    expr: if ( [Distribution Metric] = 'Age' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'CFTP' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'Credit Score' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.creditscore_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'DaysToTurn' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.daystoturn.daystoturn_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'DaysSupply' ) then [formula_Days Supply] else if ( [Distribution Metric] = 'FI Income' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.fi_income.fi_income_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'Finance APR' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_apr.apr_fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'Finance Monthly Payment' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthly_payment.mopmt_fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'Finance Term' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_term.financeterm_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'Lease APR' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_apr.apr_lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'Lease Monthly Payment' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthly_payment.mopmt_lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'Lease Term' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_term.leaseterm_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'MSRP Distribution' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.pin_msrp.msrp_pin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'Total Gross Profit' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_gross_profit.vehgrossprofit_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'Trade ACV LP Distribution' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.trade_acv_less_payoff.tradeacv_lp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) else if ( [Distribution Metric] = 'Vehicle Gross' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_gross.vehgross_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else if ( [Distribution Metric] = 'Vehicle Price' ) then sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) else null
  - id: formula_Days Supply
    name: Days Supply
    expr: ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::inventory_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(inventory_measure_group, '$.invcountwtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::inventory_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(inventory_measure_group, '$.prior3msales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) ) * 90
  - id: formula_Doors
    name: Doors
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.doors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Drive Type
    name: Drive Type
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.drivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Equalized payments (Finance)
    name: Equalized payments (Finance)
    expr: ( if ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'D' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthly_payment.mopmt_fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) = 0 ) then 0 else sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'D' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthly_payment.mopmt_fin_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'D' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthly_payment.mopmt_fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) ) + ( if ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'D' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_downpayment.totaldown_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) = 0 or sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'D' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.term.term_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) = 0 ) then 0 else ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'D' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_downpayment.totaldown_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'D' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_downpayment.totaldown_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) ) / ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'D' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.term.term_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'D' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.term.term_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) ) )
  - id: formula_Equalized payments (Lease)
    name: Equalized payments (Lease)
    expr: ( if ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthly_payment.mopmt_lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) = 0 ) then 0 else sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthly_payment.mopmt_lease_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthly_payment.mopmt_lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) ) + ( if ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_downpayment.totaldown_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) = 0 or sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.term.term_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) = 0 ) then 0 else ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_downpayment.totaldown_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_downpayment.totaldown_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) ) / ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.term.term_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' ) then to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.term.term_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else 0 ) ) )
  - id: formula_Equity Weighted Counts
    name: Equity Weighted Counts
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.equity.equity')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_FICO  A+ (720+)
    name: FICO  A+ (720+)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.fico_aplus_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / [formula_FICO Sum]
  - id: formula_FICO A (680 - 719)
    name: FICO A (680 - 719)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.fico_a_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / [formula_FICO Sum]
  - id: formula_FICO B (650 - 679)
    name: FICO B (650 - 679)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.fico_b_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / [formula_FICO Sum]
  - id: formula_FICO C (625 - 649)
    name: FICO C (625 - 649)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.fico_c_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / [formula_FICO Sum]
  - id: formula_FICO D <625
    name: FICO D <625
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.fico_d_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / [formula_FICO Sum]
  - id: formula_FICO Sum
    name: FICO Sum
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.fico_aplus_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) + sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.fico_a_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) + sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.fico_b_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) + sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.fico_c_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) + sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.fico_d_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Female %
    name: Female %
    expr: '[formula_Weighted Counts of Female customers] / ( [formula_Weighted Counts of Female customers] + [formula_Weighted Counts of Male customers] )'
  - id: formula_Filter - APR Fin
    name: Filter - APR Fin
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_apr.apr_fin_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_apr.apr_fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - APR Lease
    name: Filter - APR Lease
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_apr.apr_lease_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_apr.apr_lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - Age
    name: Filter - Age
    expr: ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.age.age_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Filter - CFTP
    name: Filter - CFTP
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - Credit Score
    name: Filter - Credit Score
    expr: ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.creditscore_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::navigator_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(navigator_measure_group, '$.credit_score.creditscore_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Filter - Days Supply
    name: Filter - Days Supply
    expr: ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::inventory_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(inventory_measure_group, '$.invcountwtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::inventory_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(inventory_measure_group, '$.prior3msales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) ) * 90
  - id: formula_Filter - Days To Turn
    name: Filter - Days To Turn
    expr: ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.daystoturn.daystoturn_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.daystoturn.daystoturn_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Filter - FI Income
    name: Filter - FI Income
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.fi_income.fi_income_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.fi_income.fi_income_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - Finance Term
    name: Filter - Finance Term
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_term.financeterm_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_term.financeterm_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - Lease Term
    name: Filter - Lease Term
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_term.leaseterm_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_term.leaseterm_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - MO PMT Fin
    name: Filter - MO PMT Fin
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthly_payment.mopmt_fin_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthly_payment.mopmt_fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - MO PMT Lease
    name: Filter - MO PMT Lease
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthly_payment.mopmt_lease_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthly_payment.mopmt_lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - MSRP
    name: Filter - MSRP
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.pin_msrp.msrp_pin_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.pin_msrp.msrp_pin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - Total PIN Gross Profit
    name: Filter - Total PIN Gross Profit
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_profit_markup_percent.vehprofitmarkuppct_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_profit_markup_percent.vehprofitmarkuppct_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - Trade ACV LP
    name: Filter - Trade ACV LP
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.trade_acv_less_payoff.tradeacv_lp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.trade_acv_less_payoff.tradeacv_lp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) , .01 )
  - id: formula_Filter - Vehicle Age
    name: Filter - Vehicle Age
    expr: ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_age.vehicleage_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_age.vehicleage_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Filter - Vehicle Gross
    name: Filter - Vehicle Gross
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_gross_profit.vehgrossprofit_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_gross_profit.vehgrossprofit_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Filter - Vehicle Price
    name: Filter - Vehicle Price
    expr: round ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .01 )
  - id: formula_Finance - Captive %  All Type of Sales
    name: Finance - Captive %  All Type of Sales
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Y' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_weight.finance_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'Y' , 'N' , '*N/AP' } ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance - Captive % Finance Sales
    name: Finance - Captive % Finance Sales
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Y' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_weight.finance_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'Y' , 'N' , '*N/AP' } ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_weight.finance_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance - Non-Captive %
    name: Finance - Non-Captive %
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'N' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_weight.finance_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'Y' , 'N' , '*N/AP' } ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance APR (24<Term<=36)
    name: Finance APR (24<Term<=36)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_36.apr36d_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_36.apr36d_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Finance APR (36<Term<=48)
    name: Finance APR (36<Term<=48)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_48.apr48d_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_48.apr48d_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Finance APR (48<Term<=60)
    name: Finance APR (48<Term<=60)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_60.apr60d_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_60.apr60d_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Finance APR (60<Term <= 72)
    name: Finance APR (60<Term <= 72)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_72.apr72d_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_72.apr72d_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Finance APR (Term <= 24)
    name: Finance APR (Term <= 24)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_24.apr24d_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_24.apr24d_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Finance APR (Term>72)
    name: Finance APR (Term>72)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_84.apr84d_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_term_lteq_84.apr84d_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Finance APR / Combo Cost of Funds (48<Term<=60)
    name: Finance APR / Combo Cost of Funds (48<Term<=60)
    expr: sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_48_60.fundcost_d_48')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_48_60.fundcost_d_48')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 * if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_48_60.fundcost_d_48')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_48_60.fundcost_d_48')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Finance APR / Combo Cost of Funds (Term<=48)
    name: Finance APR / Combo Cost of Funds (Term<=48)
    expr: sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_lteq_48.fund_cost_d')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_lteq_48.fund_cost_d')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 * if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_lteq_48.fund_cost_d')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_lteq_48.fund_cost_d')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Finance APR / Combo Cost of Funds (Term>60)
    name: Finance APR / Combo Cost of Funds (Term>60)
    expr: sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_gteq_60.fundcost_d_60')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_gteq_60.fundcost_d_60')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 * if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_gteq_60.fundcost_d_60')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeapr_combo_costoffunds_term_gteq_60.fundcost_d_60')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Finance APR Monthly Payment (Term <= 24)
    name: Finance APR Monthly Payment (Term <= 24)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_24.monthly24')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_24.monthly24_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_24.monthly24')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_24.monthly24_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance APR Monthly Payment (Term <= 36)
    name: Finance APR Monthly Payment (Term <= 36)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_36.monthly36')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_36.monthly36_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_36.monthly36')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_36.monthly36_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance APR Monthly Payment (Term <= 48)
    name: Finance APR Monthly Payment (Term <= 48)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_48.monthly48')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_48.monthly48_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_48.monthly48')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_48.monthly48_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance APR Monthly Payment (Term <= 60)
    name: Finance APR Monthly Payment (Term <= 60)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_60.monthly60')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_60.monthly60_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_60.monthly60')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_60.monthly60_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
    properties:
      column_type: ATTRIBUTE
  - id: formula_Finance APR Monthly Payment (Term <= 72)
    name: Finance APR Monthly Payment (Term <= 72)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_72.monthly72')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_72.monthly72_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_72.monthly72')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_72.monthly72_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
    properties:
      column_type: ATTRIBUTE
  - id: formula_Finance APR Monthly Payment (Term <= 84)
    name: Finance APR Monthly Payment (Term <= 84)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_84.monthly84')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_84.monthly84_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_84.monthly84')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_monthlypayment_term_lteq_84.monthly84_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Finance APR Subvention (Term <= 24): $ Offer'
    name: 'Finance APR Subvention (Term <= 24): $ Offer'
    expr: '[formula_Finance APR Subvention (Term <= 24): Wgt''d $/unit] / [formula_Finance APR Subvention (Term <= 24): Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 24): Wgt''d $/unit'
    name: 'Finance APR Subvention (Term <= 24): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_24.subd24_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_24.subd24_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Finance APR Subvention (Term <= 36): $ Offer'
    name: 'Finance APR Subvention (Term <= 36): $ Offer'
    expr: '[formula_Finance APR Subvention (Term <= 36): Wgt''d $/unit] / [formula_Finance APR Subvention (Term <= 36): Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 36): Wgt''d $/unit'
    name: 'Finance APR Subvention (Term <= 36): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_36.subd36_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_36.subd36_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Finance APR Subvention (Term <= 48): $ Offer'
    name: 'Finance APR Subvention (Term <= 48): $ Offer'
    expr: '[formula_Finance APR Subvention (Term <= 48): Wgt''d $/unit] / [formula_Finance APR Subvention (Term <= 48): Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 48): Wgt''d $/unit'
    name: 'Finance APR Subvention (Term <= 48): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_48.subd48_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_48.subd48_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Finance APR Subvention (Term <= 60): $ Offer'
    name: 'Finance APR Subvention (Term <= 60): $ Offer'
    expr: '[formula_Finance APR Subvention (Term <= 60): Wgt''d $/unit] / [formula_Finance APR Subvention (Term <= 60): Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 60): Wgt''d $/unit'
    name: 'Finance APR Subvention (Term <= 60): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_60.subd60_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_60.subd60_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Finance APR Subvention (Term <= 72): $ Offer'
    name: 'Finance APR Subvention (Term <= 72): $ Offer'
    expr: '[formula_Finance APR Subvention (Term <= 72): Wgt''d $/unit] / [formula_Finance APR Subvention (Term <= 72): Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 72): Wgt''d $/unit'
    name: 'Finance APR Subvention (Term <= 72): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_72.subd72_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_72.subd72_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Finance APR Subvention (Term <= 84): $ Offer'
    name: 'Finance APR Subvention (Term <= 84): $ Offer'
    expr: '[formula_Finance APR Subvention (Term <= 84): Wgt''d $/unit] / [formula_Finance APR Subvention (Term <= 84): Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 84): Wgt''d $/unit'
    name: 'Finance APR Subvention (Term <= 84): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_84.subd84_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_84.subd84_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance Down Payment Term Mix (Term <=24)
    name: Finance Down Payment Term Mix (Term <=24)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_24.totaldown24')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_24.totaldown24_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_24.totaldown24')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_24.totaldown24_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
    properties:
      column_type: ATTRIBUTE
  - id: formula_Finance Down Payment Term Mix (Term <=36)
    name: Finance Down Payment Term Mix (Term <=36)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_36.totaldown36')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_36.totaldown36_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_36.totaldown36')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_36.totaldown36_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance Down Payment Term Mix (Term <=48)
    name: Finance Down Payment Term Mix (Term <=48)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_48.totaldown48')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_48.totaldown48_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_48.totaldown48')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_48.totaldown48_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance Down Payment Term Mix (Term <=60)
    name: Finance Down Payment Term Mix (Term <=60)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_60.totaldown60')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_60.totaldown60_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_60.totaldown60')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_60.totaldown60_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance Down Payment Term Mix (Term <=72)
    name: Finance Down Payment Term Mix (Term <=72)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_72.totaldown72')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_72.totaldown72_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_72.totaldown72')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_72.totaldown72_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance Down Payment Term Mix (Term <=84)
    name: Finance Down Payment Term Mix (Term <=84)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_84.totaldown84')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_84.totaldown84_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_84.totaldown84')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_downpayment_term_lteq_84.totaldown84_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance Reserve Penetration
    name: Finance Reserve Penetration
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.financeleasereserve.financeleasereserve_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) != 0 ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.financeleasereserve.financeleasereserve_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Fuel Type
    name: Fuel Type
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.fueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Gap Insurance Premium
    name: Gap Insurance Premium
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.gap_insurance_premium.gapinspremium_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.gap_insurance_premium.gapinspremium_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Gross/Unit
    name: Gross/Unit
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_gross_profit.vehgrossprofit_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_gross_profit.vehgrossprofit_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_ISR Weighted Counts
    name: ISR Weighted Counts
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Incentives % of Vehicle Price
    name: Incentives % of Vehicle Price
    expr: '[formula_Incentive Spending] / [formula_Vehicle Price]'
  - id: formula_Inventory Share %
    name: Inventory Share %
    expr: sum ( group_aggregate ( [formula_Inventory] , query_groups ( ) , query_filters ( ) ) ) / sum ( group_aggregate ( [formula_Inventory] , query_groups ( ) + { [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } , query_filters ( ) + { [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } ) )
  - id: formula_JD Power Segment
    name: JD Power Segment
    expr: concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_KWH
    name: KWH
    expr: ( concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.KWH')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Lease  APR Down Payment (Term <= 36)
    name: Lease  APR Down Payment (Term <= 36)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_36.totaldown36_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_36.totaldown36_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_36.totaldown36_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_36.totaldown36_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease  APR Down Payment (Term <= 48)
    name: Lease  APR Down Payment (Term <= 48)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_48.totaldown48_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_48.totaldown48_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_48.totaldown48_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_48.totaldown48_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease - Captive %  Lease Sales
    name: Lease - Captive %  Lease Sales
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Y' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_weight.lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'Y' , 'N' , '*N/AP' } ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_weight.lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease - Captive % All Type of Sales Sales
    name: Lease - Captive % All Type of Sales Sales
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Y' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_weight.lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'Y' , 'N' , '*N/AP' } ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease - Non-Captive %
    name: Lease - Non-Captive %
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'N' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_weight.lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.captiveflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'Y' , 'N' , '*N/AP' } ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease 36M PMT  (25-36)
    name: Lease 36M PMT  (25-36)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthlypayment_term_wtd.mopmt24_36lease_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthlypayment_term_weights.mopmt24_36lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease 39M PMT (37-39)
    name: Lease 39M PMT (37-39)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthlypayment_term_wtd.mopmt37_39lease_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthlypayment_term_weights.mopmt37_39lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease 48M PMT (40-48)
    name: Lease 48M PMT (40-48)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthlypayment_term_wtd.mopmt_40_48lease_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthlypayment_term_weights.mopmt40_48lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease APR (Term <= 24)
    name: Lease APR (Term <= 24)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseapr_term_lteq_24.apr24l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseapr_term_lteq_24.apr24l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Lease APR (Term <= 36)
    name: Lease APR (Term <= 36)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseapr_term_lteq_36.apr36l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseapr_term_lteq_36.apr36l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Lease APR (Term <= 39)
    name: Lease APR (Term <= 39)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseapr_term_lteq_39.apr39l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseapr_term_lteq_39.apr39l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Lease APR (Term <= 48)
    name: Lease APR (Term <= 48)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseapr_term_lteq_48.apr48l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseapr_term_lteq_48.apr48l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Lease APR (Term <= 60)
    name: Lease APR (Term <= 60)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseapr_term_lteq_60.apr60l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseapr_term_lteq_60.apr60l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Lease APR Down Payment (Term <= 24)
    name: Lease APR Down Payment (Term <= 24)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_24.totaldown24_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_24.totaldown24_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_24.totaldown24_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_24.totaldown24_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease APR Down Payment (Term <= 39)
    name: Lease APR Down Payment (Term <= 39)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_39.totaldown39_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_39.totaldown39_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_39.totaldown39_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_39.totaldown39_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease APR Down Payment (Term <= 60)
    name: Lease APR Down Payment (Term <= 60)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_60.totaldown60_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_60.totaldown60_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_60.totaldown60_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_downpayment_term_lteq_60.totaldown60_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease APR Subvention: $ Offer'
    name: 'Lease APR Subvention: $ Offer'
    expr: '[formula_Lease APR Subvention: Wgt''d $/unit] / [formula_Lease APR Subvention: Take Rate]'
  - id: 'formula_Lease APR Subvention: Take Rate'
    name: 'Lease APR Subvention: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_apr_subvention_takerate.subl_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_apr_subvention_takerate.subl_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease APR Subvention: Wgt''d $/unit'
    name: 'Lease APR Subvention: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_apr_subvention.subl_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_apr_subvention.subl_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Cap Reduction
    name: Lease Cap Reduction
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_cap_reduction.leasecapreduction_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_cap_reduction.leasecapreduction_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Cash: $ Offer'
    name: 'Lease Cash: $ Offer'
    expr: '[formula_Lease Cash: Wgt''d $/unit] / [formula_Lease Cash: Take Rate]'
  - id: 'formula_Lease Cash: Take Rate'
    name: 'Lease Cash: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_cash_takerate.lcsh_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_cash_takerate.lcsh_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Cash: Wgt''d $/unit'
    name: 'Lease Cash: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_cash_offer.lcsh_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_cash_offer.lcsh_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Cost of Funds
    name: Lease Cost of Funds
    expr: ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_costoffunds.fundcost_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_costoffunds.fundcost_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) ) / 100
  - id: formula_Lease Customer-Facing Transaction Price
    name: Lease Customer-Facing Transaction Price
    expr: '[formula_Lease CFTP: Wgt''d $/unit] / [formula_Lease CFTP: Take Rate]'
  - id: 'formula_Lease CFTP: Take Rate'
    name: 'Lease CFTP: Take Rate'
    expr: round ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_cftp_takerate.cftp_ls_tr')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .001 )
  - id: 'formula_Lease CFTP: Wgt''d $/unit'
    name: 'Lease CFTP: Wgt''d $/unit'
    expr: round ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_cftp.cftp_ls_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .001 )
  - id: 'formula_Lease Incentive Spending: Wgt''d $/unit'
    name: 'Lease Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_incentivespending_per_unit.ls_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Loyalty Cash: $ Offer'
    name: 'Lease Loyalty Cash: $ Offer'
    expr: '[formula_Lease Loyalty Cash: Wgt''d $/unit] / [formula_Lease Loyalty Cash: Take Rate]'
  - id: 'formula_Lease Loyalty Cash: Take Rate'
    name: 'Lease Loyalty Cash: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_loyalty_cash_takerate.takellcsh_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_loyalty_cash_takerate.takellcsh_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Loyalty Cash: Wgt''d $/unit'
    name: 'Lease Loyalty Cash: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_loyalty_cash.avgllcsh_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_loyalty_cash.avgllcsh_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Monthly Payment (Term <= 24)
    name: Lease Monthly Payment (Term <= 24)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_24.monthly24_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_24.monthly24_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_24.monthly24_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_24.monthly24_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Monthly Payment (Term <= 36)
    name: Lease Monthly Payment (Term <= 36)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_36.monthly36_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_36.monthly36_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_36.monthly36_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_36.monthly36_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Monthly Payment (Term <= 39)
    name: Lease Monthly Payment (Term <= 39)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_39.monthly39_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_39.monthly39_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_39.monthly39_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_39.monthly39_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Monthly Payment (Term <= 48)
    name: Lease Monthly Payment (Term <= 48)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_48.monthly48_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_48.monthly48_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_48.monthly48_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_48.monthly48_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Monthly Payment (Term <= 60)
    name: Lease Monthly Payment (Term <= 60)
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_60.monthly60_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_60.monthly60_l_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_60.monthly60_l')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_monthlypayment_term_lteq_60.monthly60_l_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
    properties:
      column_type: ATTRIBUTE
  - id: formula_Lease Residual
    name: Lease Residual
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.leaseresidual.leaseresiudal_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.leaseresidual.leaseresiudal_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Residual Subvention: $ Offer'
    name: 'Lease Residual Subvention: $ Offer'
    expr: '[formula_Lease Residual Subvention: Wgt''d $/unit] / [formula_Lease Residual Subvention: Take Rate]'
  - id: 'formula_Lease Residual Subvention: Take Rate'
    name: 'Lease Residual Subvention: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_residual_subvention_takerate.subr_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_residual_subvention_takerate.subr_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Residual Subvention: Wgt''d $/unit'
    name: 'Lease Residual Subvention: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_residual_subvention.subr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_residual_subvention.subr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Subvention (Term <= 24): $ Offer'
    name: 'Lease Subvention (Term <= 24): $ Offer'
    expr: '[formula_Lease Subvention (Term <= 24): Wgt''d $/unit] / [formula_Lease Subvention (Term <= 24): Take Rate]'
  - id: 'formula_Lease Subvention (Term <= 24): Wgt''d $/unit'
    name: 'Lease Subvention (Term <= 24): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_24.lcsub24_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_24.lcsub24_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Subvention (Term <= 36): $ Offer'
    name: 'Lease Subvention (Term <= 36): $ Offer'
    expr: '[formula_Lease Subvention (Term <= 36): Wgt''d $/unit] / [formula_Lease Subvention (Term <= 36): Take Rate]'
  - id: 'formula_Lease Subvention (Term <= 36): Wgt''d $/unit'
    name: 'Lease Subvention (Term <= 36): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_36.lcsub36_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_36.lcsub36_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Subvention (Term <= 39): $ Offer'
    name: 'Lease Subvention (Term <= 39): $ Offer'
    expr: '[formula_Lease Subvention (Term <= 39): Wgt''d $/unit] / [formula_Lease Subvention (Term <= 39): Take Rate]'
  - id: 'formula_Lease Subvention (Term <= 39): Wgt''d $/unit'
    name: 'Lease Subvention (Term <= 39): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_39.lcsub39_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_39.lcsub39_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Subvention (Term <= 48): $ Offer'
    name: 'Lease Subvention (Term <= 48): $ Offer'
    expr: '[formula_Lease Subvention (Term <= 48): Wgt''d $/unit] / [formula_Lease Subvention (Term <= 48): Take Rate]'
  - id: 'formula_Lease Subvention (Term <= 48): Wgt''d $/unit'
    name: 'Lease Subvention (Term <= 48): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_48.lcsub48_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_48.lcsub48_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Lease Subvention (Term <= 60): $ Offer'
    name: 'Lease Subvention (Term <= 60): $ Offer'
    expr: '[formula_Lease Subvention (Term <= 60): Wgt''d $/unit] / [formula_Lease Subvention (Term <= 60): Take Rate]'
  - id: 'formula_Lease Subvention (Term <= 60): Wgt''d $/unit'
    name: 'Lease Subvention (Term <= 60): Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_60.lcsub60_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_60.lcsub60_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lender
    name: Lender
    expr: concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.lender')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Life Insurance Cost
    name: Life Insurance Cost
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.life_insurance_cost.lifeinscost_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.life_insurance_cost.lifeinscost_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Life Insurance Income
    name: Life Insurance Income
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.life_insurance_income.lifeinsincome_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.life_insurance_income.lifeinsincome_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Life Insurance Penetration
    name: Life Insurance Penetration
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'n' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.life_insurance_premium.lifeinspremium_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) != 0 ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.life_insurance_premium.lifeinspremium_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'n' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price.vehicleprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price.vehicleprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Life Insurance Premium
    name: Life Insurance Premium
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.life_insurance_premium.lifeinspremium_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.life_insurance_premium.lifeinspremium_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Loan to Cost
    name: Loan to Cost
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.loantocost.loantocost_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.loantocost.loantocost_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Loan to Value (%)
    name: Loan to Value (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.loantovalue.loantovalue_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.loantovalue.loantovalue_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_MSRP
    name: MSRP
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.msrp.msrp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.msrp.msrp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_MSRP ISR
    name: MSRP ISR
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.imputed_msrp.msrp_isr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.imputed_msrp.msrp_isr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Male %
    name: Male %
    expr: '[formula_Weighted Counts of Male customers] / ( [formula_Weighted Counts of Male customers] + [formula_Weighted Counts of Female customers] )'
  - id: formula_Max Date
    name: Max Date
    expr: '[PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] = group_max ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] )'
  - id: formula_MoM CFTP
    name: MoM CFTP
    expr: ( [formula_Current Month CFTP] - [formula_Previous Month CFTP] )
  - id: formula_MoM Incentive Spending
    name: MoM Incentive Spending
    expr: '[formula_Current Month Incentive Spending] - [formula_Previous Month Incentive Spending]'
  - id: formula_MoM Inventory Share
    name: MoM Inventory Share
    expr: '[formula_Current Month Inventory Share] - [formula_Previous Month Inventory Share]'
  - id: formula_MoM Retail Share
    name: MoM Retail Share
    expr: '[formula_Current Month Retail Share] - [formula_Previous Month Retail Share]'
  - id: formula_Monthly Payment
    name: Monthly Payment
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.monthlypayment.monthlypayment_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.monthlypayment.monthlypayment_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Monthly Payment Finance
    name: Monthly Payment Finance
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthly_payment.mopmt_fin_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_monthly_payment.mopmt_fin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Monthly Payment Lease
    name: Monthly Payment Lease
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthly_payment.mopmt_lease_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_monthly_payment.mopmt_lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_National
    name: National
    expr: if ( ts_groups = 'pin_subaru' ) then if ( contains ( concat ( sql_string_op ( "json_value(subaru_attributes, '$.subaruregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) , 'Nation' ) ) then 'National' else null else if ( ts_groups = 'pin_ally' ) then if ( contains ( concat ( sql_string_op ( "json_value(pin_attributes, '$.pinregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) , 'Nation' ) ) then 'National' else null else null
  - id: formula_Negative Equity Percentage
    name: Negative Equity Percentage
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.negative_equity.negequity_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.equity.equity_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Negative Equity Weighted Counts
    name: Negative Equity Weighted Counts
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.negative_equity.negative_equity')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_New Date Filter
    name: New Date Filter
    expr: if ( [Period] = 'Current Month' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( now ( ) ) ) then true else if ( [Period] = 'Rolling 2 Months' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( add_months ( now ( ) , - 1 ) ) ) then true else if ( [Period] = 'Rolling 3 Months' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( add_months ( now ( ) , - 2 ) ) ) then true else if ( [Period] = 'Rolling 4 Months' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( add_months ( now ( ) , - 3 ) ) ) then true else if ( [Period] = 'Rolling 6 Months' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( add_months ( now ( ) , - 5 ) ) ) then true else if ( [Period] = 'Rolling 12 Months' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( add_months ( now ( ) , - 11 ) ) ) then true else if ( [Period] = 'Rolling 13 Months' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( add_months ( now ( ) , - 12 ) ) ) then true else if ( [Period] = 'Rolling 24 Months' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( add_months ( now ( ) , - 23 ) ) ) then true else if ( [Period] = 'Rolling 25 Months' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( add_months ( now ( ) , - 24 ) ) ) then true else if ( [Period] = 'Rolling 36 Months' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( add_months ( now ( ) , - 35 ) ) ) then true else if ( [Period] = 'Rolling 37 Months' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_month ( add_months ( now ( ) , - 36 ) ) ) then true else if ( [Period] = 'Rolling 2 Years' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_year ( add_years ( now ( ) , - 1 ) ) ) then true else if ( [Period] = 'Rolling 3 Years' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_year ( add_years ( now ( ) , - 2 ) ) ) then true else if ( [Period] = 'YTD' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_year ( add_years ( now ( ) , 0 ) ) ) then true else if ( [Period] = 'Current Week' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] >= start_of_week ( add_weeks ( now ( ) , 0 ) ) ) then true else if ( [Period] = 'Rolling Dates' ) then true else false
  - id: formula_Non-Core Cash Offer/Unit
    name: Non-Core Cash Offer/Unit
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_cash_incentive_spending_per_unit.ncore_cash_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cash_incentive_penetration.cash_incntv_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Non-Core Finance Offer/Unit
    name: Non-Core Finance Offer/Unit
    expr: '[formula_Non-Core Finance Incentive Spending: Wgt''d $/unit] / [formula_Supported Finance Incentive Penetration]'
  - id: 'formula_Non-Core Incentive 10: $ Offer'
    name: 'Non-Core Incentive 10: $ Offer'
    expr: '[formula_Non-Core Incentive 10: Wgt''d $/unit] / [formula_Non-Core Incentive 10: Take Rate]'
  - id: 'formula_Non-Core Incentive 10: Take Rate'
    name: 'Non-Core Incentive 10: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive10_takerate.ncore10_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive10_takerate.ncore10_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 10: Wgt''d $/unit'
    name: 'Non-Core Incentive 10: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive10.ncore10_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive10.ncore10_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 1: $ Offer'
    name: 'Non-Core Incentive 1: $ Offer'
    expr: '[formula_Non-Core Incentive 1: Wgt''d $/unit] / [formula_Non-Core Incentive 1: Take Rate]'
  - id: 'formula_Non-Core Incentive 1: Take Rate'
    name: 'Non-Core Incentive 1: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive1_emp_supplier_dealerbonuscash_takerate.ncore1_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive1_emp_supplier_dealerbonuscash_takerate.ncore1_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 1: Wgt''d $/unit'
    name: 'Non-Core Incentive 1: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive1_emp_supplier_dealerbonuscash.ncore1_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive1_emp_supplier_dealerbonuscash.ncore1_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 2: $ Offer'
    name: 'Non-Core Incentive 2: $ Offer'
    expr: '[formula_Non-Core Incentive 2: Wgt''d $/unit] / [formula_Non-Core Incentive 2: Take Rate]'
  - id: 'formula_Non-Core Incentive 2: Take Rate'
    name: 'Non-Core Incentive 2: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive2_employeepricing_takerate.ncore2_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive2_employeepricing_takerate.ncore2_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 2: Wgt''d $/unit'
    name: 'Non-Core Incentive 2: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive2_employeepricing.ncore2_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive2_employeepricing.ncore2_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 3: $ Offer'
    name: 'Non-Core Incentive 3: $ Offer'
    expr: '[formula_Non-Core Incentive 3: Wgt''d $/unit] / [formula_Non-Core Incentive 3: Take Rate]'
  - id: 'formula_Non-Core Incentive 3: Take Rate'
    name: 'Non-Core Incentive 3: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive3_firsttimebuyer_takerate.ncore3_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive3_firsttimebuyer_takerate.ncore3_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 3: Wgt''d $/unit'
    name: 'Non-Core Incentive 3: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive3_firsttimebuyer.ncore3_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive3_firsttimebuyer.ncore3_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 4: $ Offer'
    name: 'Non-Core Incentive 4: $ Offer'
    expr: '[formula_Non-Core Incentive 4: Wgt''d $/unit] / [formula_Non-Core Incentive 4: Take Rate]'
  - id: 'formula_Non-Core Incentive 4: Take Rate'
    name: 'Non-Core Incentive 4: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive4_creditunionmemberdiscount_takerate.ncore4_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive4_creditunionmemberdiscount_takerate.ncore4_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 4: Wgt''d $/unit'
    name: 'Non-Core Incentive 4: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive4_creditunionmemberdiscount.ncore4_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive4_creditunionmemberdiscount.ncore4_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 5: $ Offer'
    name: 'Non-Core Incentive 5: $ Offer'
    expr: '[formula_Non-Core Incentive 5: Wgt''d $/unit] / [formula_Non-Core Incentive 5: Take Rate]'
  - id: 'formula_Non-Core Incentive 5: Take Rate'
    name: 'Non-Core Incentive 5: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive5_reconsensus_dealercash_takerate.ncore5_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive5_reconsensus_dealercash_takerate.ncore5_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 5: Wgt''d $/unit'
    name: 'Non-Core Incentive 5: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive5_reconsensus_dealercash.ncore5_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive5_reconsensus_dealercash.ncore5_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 6: $ Offer'
    name: 'Non-Core Incentive 6: $ Offer'
    expr: '[formula_Non-Core Incentive 6: Wgt''d $/unit] / [formula_Non-Core Incentive 6: Take Rate]'
  - id: 'formula_Non-Core Incentive 6: Take Rate'
    name: 'Non-Core Incentive 6: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive6_dealerbonuscertificates_takerate.ncore6_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive6_dealerbonuscertificates_takerate.ncore6_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 6: Wgt''d $/unit'
    name: 'Non-Core Incentive 6: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive6_dealerbonuscertificates.ncore6_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive6_dealerbonuscertificates.ncore6_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 7: $ Offer'
    name: 'Non-Core Incentive 7: $ Offer'
    expr: '[formula_Non-Core Incentive 7: Wgt''d $/unit] / [formula_Non-Core Incentive 7: Take Rate]'
  - id: 'formula_Non-Core Incentive 7: Take Rate'
    name: 'Non-Core Incentive 7: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive7_instantvaluecertificate_takerate.ncore7_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive7_instantvaluecertificate_takerate.ncore7_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 7: Wgt''d $/unit'
    name: 'Non-Core Incentive 7: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive7_instantvaluecertificate.ncore7_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive7_instantvaluecertificate.ncore7_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 8: $ Offer'
    name: 'Non-Core Incentive 8: $ Offer'
    expr: '[formula_Non-Core Incentive 8: Wgt''d $/unit] / [formula_Non-Core Incentive 8: Take Rate]'
  - id: 'formula_Non-Core Incentive 8: Take Rate'
    name: 'Non-Core Incentive 8: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive8_takerate.ncore8_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive8_takerate.ncore8_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 8: Wgt''d $/unit'
    name: 'Non-Core Incentive 8: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive8.ncore8_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive8.ncore8_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 9: $ Offer'
    name: 'Non-Core Incentive 9: $ Offer'
    expr: '[formula_Non-Core Incentive 9: Wgt''d $/unit] / [formula_Non-Core Incentive 9: Take Rate]'
  - id: 'formula_Non-Core Incentive 9: Take Rate'
    name: 'Non-Core Incentive 9: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive9_takerate.ncore9_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive9_takerate.ncore9_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Incentive 9: Wgt''d $/unit'
    name: 'Non-Core Incentive 9: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive9.ncore9_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive9.ncore9_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Non-Core Lease Offer/Unit
    name: Non-Core Lease Offer/Unit
    expr: '[formula_Non-Core Lease Incentive Spending: Wgt''d $/unit] / [formula_Supported Lease Incentive Penetration]'
  - id: formula_Non-Core Spending/Unit
    name: Non-Core Spending/Unit
    expr: 'ifnull ( [formula_Non-Core Cash Incentive Spending: Wgt''d $/unit] , 0 ) + ifnull ( [formula_Non-Core Finance Incentive Spending: Wgt''d $/unit] , 0 ) + ifnull ( [formula_Non-Core Lease Incentive Spending: Wgt''d $/unit] , 0 )'
  - id: 'formula_Non-Core Cash Incentive Spending: Wgt''d $/unit'
    name: 'Non-Core Cash Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_cash_incentive_spending_per_unit.ncore_cash_unit_w_weight')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_cash_incentive_spending_per_unit.ncore_cash_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_cash_incentive_spending_per_unit.ncore_cash_unit_w_weight')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_cash_incentive_spending_per_unit.ncore_cash_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Finance Incentive Spending: Wgt''d $/unit'
    name: 'Non-Core Finance Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_finance_incentive_spending_per_unit.ncore_fi_unit_w')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_finance_incentive_spending_per_unit.ncore_fi_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_finance_incentive_spending_per_unit.ncore_fi_unit_w')" ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Core Lease Incentive Spending: Wgt''d $/unit'
    name: 'Non-Core Lease Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_lease_incentive_spending_per_unit.ncore_ls_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_lease_incentive_spending_per_unit.ncore_ls_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 * if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_lease_incentive_spending_per_unit.ncore_ls_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncore_lease_incentive_spending_per_unit.ncore_ls_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Non-Visible Cash Incentive Offer/Unit
    name: Non-Visible Cash Incentive Offer/Unit
    expr: '[formula_Non-Visible Cash Incentive Spending: Wgt''d $/unit] / [formula_Cash Incentive Penetration]'
  - id: formula_Non-Visible Cash Offer/Unit
    name: Non-Visible Cash Offer/Unit
    expr: '[formula_Non-Visible Cash Incentive Spending: Wgt''d $/unit] / [formula_Cash Incentive Penetration]'
  - id: formula_Non-Visible Finance Incentive Offer/Unit
    name: Non-Visible Finance Incentive Offer/Unit
    expr: '[formula_Non-Visible Finance Incentive Spending: Wgt''d $/unit] / [formula_Supported Finance Incentive Penetration]'
  - id: formula_Non-Visible Finance Offer/Unit
    name: Non-Visible Finance Offer/Unit
    expr: '[formula_Non-Visible Finance Incentive Spending: Wgt''d $/unit] / [formula_Supported Finance Incentive Penetration]'
  - id: formula_Non-Visible Lease Incentive Offer/Unit
    name: Non-Visible Lease Incentive Offer/Unit
    expr: '[formula_Non-Visible Lease Incentive Spending: Wgt''d $/unit] / [formula_Supported Lease Incentive Penetration]'
  - id: formula_Non-Visible Lease Offer/Unit
    name: Non-Visible Lease Offer/Unit
    expr: '[formula_Non-Visible Lease Incentive Spending: Wgt''d $/unit] / [formula_Supported Lease Incentive Penetration]'
  - id: formula_Non-Visible Spending/Unit
    name: Non-Visible Spending/Unit
    expr: '[formula_Non-Visible Cash Incentive Spending: Wgt''d $/unit] + [formula_Non-Visible Finance Incentive Spending: Wgt''d $/unit] + [formula_Non-Visible Lease Incentive Spending: Wgt''d $/unit]'
  - id: 'formula_Non-Visible Cash Incentive Spending: Wgt''d $/unit'
    name: 'Non-Visible Cash Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.nonvisible_cash_incentivespending_per_unit.nvisi_cash_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.nonvisible_cash_incentivespending_per_unit.nvisi_cash_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Visible Finance Incentive Spending: Wgt''d $/unit'
    name: 'Non-Visible Finance Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.nonvisible_finance_incentivespending_per_unit.nvisi_fi_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.nonvisible_finance_incentivespending_per_unit.nvisi_fi_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Non-Visible Lease Incentive Spending: Wgt''d $/unit'
    name: 'Non-Visible Lease Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.nonvisible_lease_incentivespending_per_unit.nvisi_ls_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.nonvisible_lease_incentivespending_per_unit.nvisi_ls_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Normalized Monthly Payment
    name: Normalized Monthly Payment
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.normalized_monthly_payment.normalized_monthlyp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.normalized_monthly_payment.normalized_monthlyp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_OEM + Fedl Govt Incentive Spending $/unit
    name: OEM + Fedl Govt Incentive Spending $/unit
    expr: '[formula_OEM Inc. Tax Credit] + [formula_Incentive Spending]'
  - id: formula_OEM Inc. Tax Credit
    name: OEM Inc. Tax Credit
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.oem_incentives_tax_credit.oem_inc_tax_credit_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.oem_incentives_tax_credit.oem_inc_tax_credit_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_OEM Revenue
    name: OEM Revenue
    expr: '[formula_Vehicle Cost] - [formula_Incentive Spending]'
  - id: formula_Odometer
    name: Odometer
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.odometer.odometer_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.odometer.odometer_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_PIN Market
    name: PIN Market
    expr: if ( ts_groups = 'administrator' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinmarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Customer Success' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinmarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Customer Success (Demographics)' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinmarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Internal Non Customer Success' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinmarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_acura' ) then '' else if ( ts_groups = 'pin_afs' ) then '' else if ( ts_groups = 'pin_audi' ) then '' else if ( ts_groups = 'pin_bmw' ) then concat ( sql_string_op ( "json_value(bmw_attributes, '$.bmwmarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_ford' ) then concat ( sql_string_op ( "json_value(ford_attributes, '$.fordmarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_genesis' ) then '' else if ( ts_groups = 'pin_gm' ) then '' else if ( ts_groups = 'pin_hatcigenesis' ) then '' else if ( ts_groups = 'pin_hatcihyundai' ) then '' else if ( ts_groups = 'pin_hatcikia' ) then '' else if ( ts_groups = 'pin_honda' ) then '' else if ( ts_groups = 'pin_honda_corp' ) then '' else if ( ts_groups = 'pin_honda_incentive' ) then concat ( sql_string_op ( "json_value(honda_attributes, '$.hondamarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_hyundai' ) then '' else if ( ts_groups = 'pin_infiniti' ) then '' else if ( ts_groups = 'pin_jlr' ) then '' else if ( ts_groups = 'pin_kia' ) then '' else if ( ts_groups = 'pin_kia_incentive' ) then '' else if ( ts_groups = 'pin_lucid' ) then '' else if ( ts_groups = 'pin_mazda' ) then '' else if ( ts_groups = 'pin_mercedes' ) then '' else if ( ts_groups = 'pin_nissan' ) then '' else if ( ts_groups = 'pin_nissan_incentive' ) then '' else if ( ts_groups = 'pin_rivian' ) then '' else if ( ts_groups = 'pin_set' ) then '' else if ( ts_groups = 'pin_stellantis' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinmarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_volvo' ) then concat ( sql_string_op ( "json_value(volvo_attributes, '$.volvomarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_ally' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinmarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_gst' ) then '' else if ( ts_groups = 'pin_karma' ) then '' else if ( ts_groups = 'pin_maserati' ) then '' else if ( ts_groups = 'pin_mitsu' ) then '' else if ( ts_groups = 'pin_porsche' ) then '' else if ( ts_groups = 'pin_subaru' ) then '' else if ( ts_groups = 'pin_tms_lexus' ) then '' else if ( ts_groups = 'pin_tms_toyota' ) then '' else if ( ts_groups = 'pin_vci' ) then '' else if ( ts_groups = 'pin_vw' ) then '' else if ( ts_groups = 'pin_squarepointcap' ) then '' else if ( ts_groups = 'pin_haval' ) then '' else ''
  - id: formula_PIN Region
    name: PIN Region
    expr: if ( ts_groups = 'administrator' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Customer Success' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Customer Success (Demographics)' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Internal Non Customer Success' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_acura' ) then if ( concat ( sql_string_op ( "json_value(acura_attributes,'$.acuraregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(acura_attributes, '$.acuraregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_afs' ) then concat ( sql_string_op ( "json_value(audi_attributes, '$.audiregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_audi' ) then concat ( sql_string_op ( "json_value(audi_attributes, '$.audiregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_bmw' ) then concat ( sql_string_op ( "json_value(bmw_attributes, '$.bmwregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_ford' ) then concat ( sql_string_op ( "json_value(ford_attributes, '$.fordregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_genesis' ) then concat ( sql_string_op ( "json_value(hyundai_attributes, '$.hyundairegion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_gm' ) then concat ( sql_string_op ( "json_value(gm_attributes, '$.gmregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then concat ( sql_string_op ( "json_value(hyundai_attributes, '$.hyundairegion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then concat ( sql_string_op ( "json_value(hyundai_attributes, '$.hyundairegion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_hatcikia' ) then concat ( sql_string_op ( "json_value(kia_attributes, '$.kiasaleregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_honda' ) then if ( concat ( sql_string_op ( "json_value(honda_attributes,'$.hondaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(honda_attributes, '$.hondaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_honda_corp' ) then if ( concat ( sql_string_op ( "json_value(honda_attributes,'$.hondaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(honda_attributes, '$.hondaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_honda_incentive' ) then if ( concat ( sql_string_op ( "json_value(honda_attributes,'$.hondaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(honda_attributes, '$.hondaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_hyundai' ) then concat ( sql_string_op ( "json_value(hyundai_attributes, '$.hyundairegion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_infiniti' ) then concat ( sql_string_op ( "json_value(infiniti_attributes, '$.infinitiregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_jlr' ) then if ( concat ( sql_string_op ( "json_value(,'$.')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(, '$.')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_kia' ) then concat ( sql_string_op ( "json_value(kia_attributes, '$.kiasaleregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_kia_incentive' ) then concat ( sql_string_op ( "json_value(kia_attributes, '$.kiaincentivesregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_lucid' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_mazda' ) then concat ( sql_string_op ( "json_value(mazda_attributes, '$.mazdaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_mercedes' ) then concat ( sql_string_op ( "json_value(mb_attributes, '$.mbRegion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_nissan' ) then concat ( sql_string_op ( "json_value(nissan_attributes, '$.nissanregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then concat ( sql_string_op ( "json_value(nissan_attributes, '$.nissanregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_rivian' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_set' ) then ( concat ( sql_string_op ( "json_value(toyota_attributes,'$.toyotaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else if ( ts_groups = 'pin_stellantis' ) then concat ( sql_string_op ( "json_value(fca_attributes, '$.fcaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_volvo' ) then concat ( sql_string_op ( "json_value(volvo_attributes, '$.volvoregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_ally' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_gst' ) then concat ( sql_string_op ( "json_value(toyota_attributes, '$.toyotaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_karma' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_maserati' ) then if ( concat ( sql_string_op ( "json_value(maserati_attributes,'$.maseratiregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(maserati_attributes, '$.maseratiregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_mitsu' ) then if ( concat ( sql_string_op ( "json_value(mitsubishi_attributes,'$.mitsubishiregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(mitsubishi_attributes, '$.mitsubishiregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_porsche' ) then if ( concat ( sql_string_op ( "json_value(porsche_attributes,'$.porscheregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(porsche_attributes, '$.porscheregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_subaru' ) then if ( concat ( sql_string_op ( "json_value(subaru_attributes,'$.subaruregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(subaru_attributes, '$.subaruregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_tms_lexus' ) then concat ( sql_string_op ( "json_value(lexus_attributes, '$.lexusregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_tms_toyota' ) then concat ( sql_string_op ( "json_value(toyota_attributes, '$.toyotaregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_vci' ) then if ( concat ( sql_string_op ( "json_value(vw_attributes,'$.vmregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(vw_attributes, '$.vmregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_vw' ) then if ( concat ( sql_string_op ( "json_value(vw_attributes,'$.vmregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(vw_attributes, '$.vmregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else if ( ts_groups = 'pin_squarepointcap' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinregion')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_haval' ) then if ( concat ( sql_string_op ( "json_value(,'$.')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'National' ) then concat ( sql_string_op ( "json_value(, '$.')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else '' else ''
  - id: formula_PIN Top 11 DMA
    name: PIN Top 11 DMA
    expr: if ( ts_groups = 'administrator' or ts_groups = 'Customer Success' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_bmw' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_audi' ) then concat ( sql_string_op ( "json_value(audi_attributes, '$.audimarket')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_afs' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_gst' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_mazda' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_mercedes' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_nissan' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_infiniti' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_stellantis' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'internal non customer success' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'customer success' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pintop11ddma')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else null
  - id: formula_Percent Financed
    name: Percent Financed
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.percentfinanced.percentfinanced_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.percentfinanced.percentfinanced_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Platform
    name: Platform
    expr: concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.platform')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Previous 13 Month Retail Share
    name: Previous 13 Month Retail Share
    expr: sum ( group_aggregate ( [formula_Retail Sales] , query_groups ( ) , { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) >= - 12 and diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) <= 0 } ) ) / sum ( group_aggregate ( [formula_Retail Sales] , query_groups ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) >= - 12 and diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) <= 0 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) >= - 12 and diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) <= 0 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } ) )
  - id: formula_Previous 13 Months
    name: Previous 13 Months
    expr: group_aggregate ( max ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) , query_groups ( ) , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) <= - 13 } )
  - id: formula_Previous 13 Months CFTP
    name: Previous 13 Months CFTP
    expr: group_aggregate ( [formula_CFTP] , query_groups ( ) , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) >= - 12 and diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) <= 0 } )
  - id: formula_Previous 13 Months Incentive Spending
    name: Previous 13 Months Incentive Spending
    expr: group_aggregate ( [formula_Incentive Spending] , query_groups ( ) , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) >= - 12 and diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) <= 0 } )
  - id: formula_Previous 13 Months Inventory Share
    name: Previous 13 Months Inventory Share
    expr: sum ( group_aggregate ( [formula_Inventory] , query_groups ( ) , { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) >= - 12 and diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) <= 0 } ) ) / sum ( group_aggregate ( [formula_Inventory] , query_groups ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) >= - 12 and diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) <= 0 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) >= - 12 and diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) <= 0 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } ) )
  - id: formula_Previous Month
    name: Previous Month
    expr: if ( diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , group_max ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) = - 1 ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] else null
  - id: formula_Previous Month CFTP
    name: Previous Month CFTP
    expr: group_aggregate ( [formula_CFTP] , query_groups ( ) , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 1 } )
  - id: formula_Previous Month Incentive Spending
    name: Previous Month Incentive Spending
    expr: group_aggregate ( [formula_Incentive Spending] , query_groups ( ) , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) = - 1 } )
  - id: formula_Previous Month Inventory Share
    name: Previous Month Inventory Share
    expr: sum ( group_aggregate ( [formula_Inventory] , query_groups ( ) , { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 1 } ) ) / sum ( group_aggregate ( [formula_Inventory] , query_groups ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 1 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 1 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } ) )
  - id: formula_Previous Month Retail Share
    name: Previous Month Retail Share
    expr: sum ( group_aggregate ( [formula_Retail Sales] , query_groups ( ) , { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 1 } ) ) / sum ( group_aggregate ( [formula_Retail Sales] , query_groups ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 1 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 1 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } ) )
  - id: formula_Purchase Customer-Facing Transaction Price
    name: Purchase Customer-Facing Transaction Price
    expr: '[formula_Purchase CFTP: Wgt''d $/unit] / [formula_Purchase CFTP: Take Rate]'
  - id: 'formula_Purchase CFTP: Take Rate'
    name: 'Purchase CFTP: Take Rate'
    expr: round ( sum ( if ( ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_cftp_takerate.cftp_purc_tr')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_cftp_takerate.cftp_purc_tr')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_cftp_takerate.cftp_purc_tr')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .001 )
  - id: 'formula_Purchase CFTP: Wgt''d $/unit'
    name: 'Purchase CFTP: Wgt''d $/unit'
    expr: round ( sum ( if ( ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_cftp.cftp_purc_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_cftp.cftp_purc_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_cftp.cftp_purc_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_cftp.cftp_purc_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) , .001 )
  - id: formula_Purchase Incentive Offering/Unit
    name: Purchase Incentive Offering/Unit
    expr: '( [formula_Cash Incentive Spending: Wgt''d $/unit] + [formula_Finance Incentive Spending: Wgt''d $/unit] ) / ( [formula_Cash Incentive Penetration] + [formula_Supported Finance Incentive Penetration] )'
  - id: 'formula_Cash Incentive Spending: Wgt''d $/unit'
    name: 'Cash Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cash_incentivespending_per_unit.cash_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cash_incentivespending_per_unit.cash_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Finance Incentive Spending: Wgt''d $/unit'
    name: 'Finance Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_incentivespending_per_unit.fi_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Purchase Incentive Penetration
    name: Purchase Incentive Penetration
    expr: '[formula_Cash Incentive Penetration] + [formula_Supported Finance Incentive Penetration]'
  - id: 'formula_Purchase Loyalty Cash: $ Offer'
    name: 'Purchase Loyalty Cash: $ Offer'
    expr: '[formula_Purchase Loyalty Cash: Wgt''d $/unit] / [formula_Purchase Loyalty Cash: Take Rate]'
  - id: 'formula_Purchase Loyalty Cash: Take Rate'
    name: 'Purchase Loyalty Cash: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_loyalty_cash_takerate.slcsh_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_loyalty_cash_takerate.slcsh_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Purchase Loyalty Cash: Wgt''d $/unit'
    name: 'Purchase Loyalty Cash: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_loyalty_cash.slcsh_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.purchase_loyalty_cash.slcsh_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Retail SAAR
    name: Retail SAAR
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'forecast' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::forecast_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(forecast_measure_group, '$.retailsaar')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Retail Share %
    name: Retail Share %
    expr: sum ( group_aggregate ( [formula_Retail Sales] , query_groups ( ) , query_filters ( ) ) ) / sum ( group_aggregate ( [formula_Retail Sales] , query_groups ( ) + { [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } , query_filters ( ) + { [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } ) )
  - id: formula_Return Period
    name: Return Period
    expr: concat ( sql_string_op ( "json_value(market_timer_suppl_attributes, '$.returnperiod')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Return Year
    name: Return Year
    expr: concat ( sql_string_op ( "json_value(market_timer_suppl_attributes, '$.returnyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Returning Payment Lease
    name: Returning Payment Lease
    expr: sum ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.monthlypayment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null ) * ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null ) ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null )
  - id: formula_Returning Payment Purchase
    name: Returning Payment Purchase
    expr: sum ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'P' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.monthlypayment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null ) * ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'P' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null ) ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'P' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null )
  - id: formula_Returning Total Down Lease
    name: Returning Total Down Lease
    expr: sum ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.totaldown')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null ) * ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null ) ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null )
  - id: formula_Returning Total Down Purchase
    name: Returning Total Down Purchase
    expr: sum ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'P' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.totaldown')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null ) * ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'P' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null ) ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'P' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) else null )
  - id: formula_Returning Volume
    name: Returning Volume
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Returning Volume Lease
    name: Returning Volume Lease
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'L' ) then ( to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Returning Volume Purchase
    name: Returning Volume Purchase
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::market_timer_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale] = 'P' ) then ( to_double ( concat ( sql_string_op ( "json_value(market_timer_measure_group, '$.returningvolume')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Rightsizing Rules
    name: Rightsizing Rules
    expr: ( if ( ts_groups = 'Administrator' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'Customer Success' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_bmw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_volvo' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Trade-In' , 'Market Timer' , 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Navigator - New' , 'Navigator - Used' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Navigator - New' , 'Navigator - Used' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Navigator - New' , 'Navigator - Used' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Navigator - New' , 'Navigator - Used' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Trade-In' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Inventory' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Market Timer' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Market Timer' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_kia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Market Timer' , 'Trade-In' , 'Navigator - New' , 'Navigator - Used' , 'Inventory' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) and concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Premium' ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_hatci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Market Timer' , 'Trade-In' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_ally' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_gst' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Trade-In' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Market Timer' , 'Trade-In' , 'Navigator - New' , 'Navigator - Used' , 'Inventory' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Market Timer' , 'Trade-In' , 'Navigator - New' , 'Navigator - Used' , 'Inventory' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) and concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Premium' ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Market Timer' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Trade-In' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Trade-In' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'Internal Non Customer Success' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'Customer Success (Demographics)' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_squarepointcap' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_squarepointcap' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Nissan' , 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' , 'Incentives - Regular' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null ) else null )
  - id: formula_Rightsizing Rules Test
    name: Rightsizing Rules Test
    expr: if ( ts_groups = 'Administrator' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and true ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'Customer Success' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and true ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'Customer Success (Demographics)' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and true ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'Internal Non Customer Success' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and true ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_acura' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_afs' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_audi' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_bmw' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and true ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_ford' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_genesis' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_gm' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_hatcigenesis' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_hatcihyundai' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_hatcikia' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_honda' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_honda_corp' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_honda_incentive' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_hyundai' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_infiniti' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Nissan' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_jlr' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_kia' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and add_years ( start_of_year ( now ( ) ) , - 3 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and add_years ( start_of_year ( now ( ) ) , - 7 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_kia_incentive' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and add_years ( start_of_year ( now ( ) ) , - 3 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and add_years ( start_of_year ( now ( ) ) , - 10 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and add_years ( start_of_year ( now ( ) ) , - 7 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_lucid' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and true ) ) and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Premium' and to_date ( '2021-08-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_mazda' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_mercedes' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2017-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_nissan' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Nissan' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_nissan_incentive' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Nissan' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_rivian' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2023-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2023-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2023-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2023-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2023-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2023-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2023-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2023-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_set' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Premium' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2020-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_stellantis' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Stellantis' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and add_months ( start_of_month ( now ( ) ) , - 24 ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_volvo' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_ally' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and true ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_gst' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_karma' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and true and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and true ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_maserati' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Premium' ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_mitsu' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2016-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_porsche' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_subaru' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_tms_lexus' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_tms_toyota' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - New' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Navigator - Used' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2012-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_vci' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_vw' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and to_date ( '2018-01-01' , '%Y-%m-%d' ) <= [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else if ( ts_groups = 'pin_haval' ) then if ( ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Estimated Sales - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - New' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Explorer - Used' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Forecast' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and true and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Inventory' and true and not ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Market Timer' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Total Sales' and true ) or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Trade-In' and true ) ) ) then [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] else null else null
  - id: formula_Sales Day
    name: Sales Day
    expr: to_string ( day ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) )
  - id: formula_Sales Month (String)
    name: Sales Month (String)
    expr: concat ( month ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) , "-" , to_string ( year ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) )
  - id: formula_Sales Quarter
    name: Sales Quarter
    expr: concat ( "Q" , to_string ( quarter_number ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) , "-" , to_string ( year ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) )
  - id: 'formula_Sales Spin: $ Offer'
    name: 'Sales Spin: $ Offer'
    expr: '[formula_Sales Spin: Wgt''d $/unit] / [formula_Sales Spin: Take Rate]'
  - id: 'formula_Sales Spin: Take Rate'
    name: 'Sales Spin: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.sales_spin_takerate.opcsh_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.sales_spin_takerate.opcsh_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Sales Spin: Wgt''d $/unit'
    name: 'Sales Spin: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.sales_spin.opcsh_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.sales_spin.opcsh_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Sales Week
    name: Sales Week
    expr: date ( add_days ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::closedate] , 7 - day_number_of_week ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::closedate] ) ) )
  - id: formula_Sales Year
    name: Sales Year
    expr: to_string ( year ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) )
  - id: formula_Sector
    name: Sector
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Service Contract Income
    name: Service Contract Income
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.servicecontractincome.servicecontractincome_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.servicecontractincome.servicecontractincome_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Service Contract Penetration
    name: Service Contract Penetration
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'n' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.servicecontractpremium.servicecontractpremium_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) != 0 ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.servicecontractpremium.servicecontractpremium_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'n' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price.vehicleprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price.vehicleprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Service Contract Premium
    name: Service Contract Premium
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.servicecontractpremium.servicecontractpremium_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.servicecontractpremium.servicecontractpremium_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Source Filter
    name: Source Filter
    expr: if ( ts_groups = 'Administrator' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'Customer Success' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'Customer Success (Demographics)' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'Internal Non Customer Success' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_scout' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_hertz' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_acura' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_afs' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_audi' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_bmw' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_ford' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_genesis' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_gm' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' } ) then true else null else if ( ts_groups = 'pin_hatcigenesis' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_hatcihyundai' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_hatcikia' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_honda' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_honda_corp' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_honda_incentive' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_hyundai' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_infiniti' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Regular' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_jlr' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Trade-In' } ) then true else null else if ( ts_groups = 'pin_kia' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_kia_incentive' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_lucid' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Forecast' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' , 'Trade-In' } ) then true else null else if ( ts_groups = 'pin_mazda' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_mercedes' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_nissan' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Regular' } ) then true else null else if ( ts_groups = 'pin_nissan_incentive' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Stellantis' , 'Incentives - Regular' } ) then true else null else if ( ts_groups = 'pin_rivian' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Trade-In' } ) then true else null else if ( ts_groups = 'pin_set' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_stellantis' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Regular' , 'Incentives - Nissan' } ) then true else null else if ( ts_groups = 'pin_volvo' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Trade-In' } ) then true else null else if ( ts_groups = 'pin_ally' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' } ) then true else null else if ( ts_groups = 'pin_gst' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' , 'Market Timer' , 'Trade-In' } ) then true else null else if ( ts_groups = 'pin_karma' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Trade-In' } ) then true else null else if ( ts_groups = 'pin_maserati' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Forecast' , 'Trade-in' } ) then true else null else if ( ts_groups = 'pin_mitsu' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' } ) then true else null else if ( ts_groups = 'pin_porsche' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_subaru' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_tms_lexus' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Trade-In' } ) then true else null else if ( ts_groups = 'pin_tms_toyota' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Trade-In' } ) then true else null else if ( ts_groups = 'pin_vci' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_vw' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else if ( ts_groups = 'pin_haval' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] not in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Navigator - New' , 'Navigator - Used' } ) then true else null else true
  - id: formula_State
    name: State
    expr: if ( ts_groups = 'administrator' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Customer Success' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Customer Success (Demographics)' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Internal Non Customer Success' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_acura' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_afs' ) then '' else if ( ts_groups = 'pin_audi' ) then '' else if ( ts_groups = 'pin_bmw' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_ford' ) then '' else if ( ts_groups = 'pin_genesis' ) then '' else if ( ts_groups = 'pin_gm' ) then '' else if ( ts_groups = 'pin_hatcigenesis' ) then '' else if ( ts_groups = 'pin_hatcihyundai' ) then '' else if ( ts_groups = 'pin_hatcikia' ) then '' else if ( ts_groups = 'pin_honda' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_honda_corp' ) then '' else if ( ts_groups = 'pin_honda_incentive' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_hyundai' ) then '' else if ( ts_groups = 'pin_infiniti' ) then '' else if ( ts_groups = 'pin_jlr' ) then '' else if ( ts_groups = 'pin_kia' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_kia_incentive' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_lucid' ) then '' else if ( ts_groups = 'pin_mazda' ) then '' else if ( ts_groups = 'pin_mercedes' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_nissan' ) then '' else if ( ts_groups = 'pin_nissan_incentive' ) then '' else if ( ts_groups = 'pin_rivian' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_set' ) then '' else if ( ts_groups = 'pin_stellantis' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_volvo' ) then '' else if ( ts_groups = 'pin_ally' ) then concat ( sql_string_op ( "json_value(geography, '$.state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_gst' ) then '' else if ( ts_groups = 'pin_karma' ) then '' else if ( ts_groups = 'pin_maserati' ) then '' else if ( ts_groups = 'pin_mitsu' ) then '' else if ( ts_groups = 'pin_porsche' ) then '' else if ( ts_groups = 'pin_subaru' ) then '' else if ( ts_groups = 'pin_tms_lexus' ) then '' else if ( ts_groups = 'pin_tms_toyota' ) then '' else if ( ts_groups = 'pin_vci' ) then '' else if ( ts_groups = 'pin_vw' ) then '' else if ( ts_groups = 'pin_squarepointcap' ) then '' else if ( ts_groups = 'pin_haval' ) then '' else ''
  - id: formula_State of Origin
    name: State of Origin
    expr: concat ( sql_string_op ( "json_value(vehicleattributes, '$.factory_state')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Supported Finance Incentive Offering/Unit
    name: Supported Finance Incentive Offering/Unit
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_incentivespending_per_unit.fi_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_incentive_penetration.fin_incntv_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Supported Lease Incentive Offering/Unit
    name: Supported Lease Incentive Offering/Unit
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_incentivespending_per_unit.ls_unit_w')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_incentive_penetration.lease_incntv_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Term Group
    name: Term Group
    expr: concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.termgroup')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Term Group (Market Timer)
    name: Term Group (Market Timer)
    expr: concat ( sql_string_op ( "json_value(market_timer_suppl_attributes, '$.termgroup')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Tesla and Premium Filter
    name: Tesla and Premium Filter
    expr: if ( ts_groups = 'pin_afs' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_audi' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_genesis' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_gm' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_hatcigenesis' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_hatcihyundai' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_hatcikia' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_hyundai' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_jlr' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_kia' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_kia_incentive' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_set' ) then if ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) or [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] != 'n' ) then null else true else if ( ts_groups = 'pin_gst' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_karma' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_maserati' ) then if ( not ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } ) and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) and concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Premium' ) then true else null else if ( ts_groups = 'pin_mitsu' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_porsche' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) or [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] != 'n' ) then null else true else if ( ts_groups = 'pin_subaru' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_tms_toyota' or ts_groups = 'pin_tms_lexus' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) or [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] != 'n' or [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Estimated Sales - New' , 'Navigator - New' , 'Total Sales' , 'Explorer - New' , 'Explorer - Used' } ) then true else null else if ( ts_groups = 'pin_vci' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_vw' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_haval' ) then if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Inventory' } and ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then null else true else if ( ts_groups = 'pin_lucid' ) then if ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) != 'Premium' ) then null else true else true
  - id: formula_Today
    name: Today
    expr: today ( )
  - id: 'formula_Total Combo Subvention: $ Offer'
    name: 'Total Combo Subvention: $ Offer'
    expr: '[formula_Total Combo Subvention: Wgt''d $/unit] / [formula_Total Combo Subvention: Take Rate]'
  - id: 'formula_Total Combo Subvention: Take Rate'
    name: 'Total Combo Subvention: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_combo_apr_subvention_takerate.rbsd_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_combo_apr_subvention_takerate.rbsd_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Total Combo Subvention: Wgt''d $/unit'
    name: 'Total Combo Subvention: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_combo_apr_subvention.rbsd_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_combo_apr_subvention.rbsd_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total Down
    name: Total Down
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_downpayment.totaldown_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_downpayment.totaldown_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total Down (%)
    name: Total Down (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.percent_total_downpayment.totaldownpct_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.percent_total_downpayment.totaldownpct_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total Finance APR
    name: Total Finance APR
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.average_finance_apr.aprd_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.average_finance_apr.aprd_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Total Finance APR Down Payment
    name: Total Finance APR Down Payment
    expr: sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_downpayment.totaldown')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_downpayment.totaldown')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 * if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_downpayment.totaldown')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_downpayment.totaldown')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Total Finance APR Subvention: $ Offer'
    name: 'Total Finance APR Subvention: $ Offer'
    expr: '[formula_Total Finance APR Subvention: Wgt''d $/unit] / [formula_Total Finance APR Subvention: Take Rate]'
  - id: 'formula_Total Finance APR Subvention: Wgt''d $/unit'
    name: 'Total Finance APR Subvention: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_apr_subvention.subd_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_apr_subvention.subd_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total Finance APR Term Mix
    name: Total Finance APR Term Mix
    expr: '[formula_Finance APR Term Mix (Term <= 24)] + [formula_Finance APR Term Mix (Term <= 36)] + [formula_Finance APR Term Mix (Term <= 48)] + [formula_Finance APR Term Mix (Term <= 60)] + [formula_Finance APR Term Mix (Term <= 72)] + [formula_Finance APR Term Mix (Term <= 84)]'
  - id: formula_Finance APR Term Mix (Term <= 24)
    name: Finance APR Term Mix (Term <= 24)
    expr: '[formula_Finance APR Subvention (Term <= 24): Take Rate] / [formula_Total Finance APR Subvention: Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 24): Take Rate'
    name: 'Finance APR Subvention (Term <= 24): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_24_takerate.subd24_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_24_takerate.subd24_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance APR Term Mix (Term <= 36)
    name: Finance APR Term Mix (Term <= 36)
    expr: '[formula_Finance APR Subvention (Term <= 36): Take Rate] / [formula_Total Finance APR Subvention: Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 36): Take Rate'
    name: 'Finance APR Subvention (Term <= 36): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_36_takerate.subd36_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_36_takerate.subd36_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance APR Term Mix (Term <= 48)
    name: Finance APR Term Mix (Term <= 48)
    expr: '[formula_Finance APR Subvention (Term <= 48): Take Rate] / [formula_Total Finance APR Subvention: Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 48): Take Rate'
    name: 'Finance APR Subvention (Term <= 48): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_48_takerate.subd48_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_48_takerate.subd48_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance APR Term Mix (Term <= 60)
    name: Finance APR Term Mix (Term <= 60)
    expr: '[formula_Finance APR Subvention (Term <= 60): Take Rate] / [formula_Total Finance APR Subvention: Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 60): Take Rate'
    name: 'Finance APR Subvention (Term <= 60): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_60_takerate.subd60_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_60_takerate.subd60_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance APR Term Mix (Term <= 72)
    name: Finance APR Term Mix (Term <= 72)
    expr: '[formula_Finance APR Subvention (Term <= 72): Take Rate] / [formula_Total Finance APR Subvention: Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 72): Take Rate'
    name: 'Finance APR Subvention (Term <= 72): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_72_takerate.subd72_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_72_takerate.subd72_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Finance APR Term Mix (Term <= 84)
    name: Finance APR Term Mix (Term <= 84)
    expr: '[formula_Finance APR Subvention (Term <= 84): Take Rate] / [formula_Total Finance APR Subvention: Take Rate]'
  - id: 'formula_Finance APR Subvention (Term <= 84): Take Rate'
    name: 'Finance APR Subvention (Term <= 84): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_84_takerate.subd84_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.financeaprsubvention_term_lteq_84_takerate.subd84_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Total Finance APR Subvention: Take Rate'
    name: 'Total Finance APR Subvention: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_apr_subvention_takerate.subd_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_apr_subvention_takerate.subd_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total Finance Monthly Payment
    name: Total Finance Monthly Payment
    expr: sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_monthlypayment.dmonthlyp')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_monthlypayment.dmonthlyp')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 * if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_monthlypayment.dmonthlyp')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_finance_monthlypayment.dmonthlyp')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total Lease APR
    name: Total Lease APR
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.average_lease_apr.aprl_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.average_lease_apr.aprl_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / 100
  - id: formula_Total Lease APR Down Payment
    name: Total Lease APR Down Payment
    expr: sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_downpayment.totaldown_l')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_downpayment.totaldown_l')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 * if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_downpayment.totaldown_l')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_downpayment.totaldown_l')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total Lease Monthly Payment
    name: Total Lease Monthly Payment
    expr: sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_monthlypayment.monthlyp_l')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_monthlypayment.monthlyp_l')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 * if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_monthlypayment.monthlyp_l')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_monthlypayment.monthlyp_l')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Total Lease Subvention: $ Offer'
    name: 'Total Lease Subvention: $ Offer'
    expr: '[formula_Total Lease Subvention: Wgt''d $/unit] / [formula_Total Lease Subvention: Take Rate]'
  - id: 'formula_Total Lease Subvention: Wgt''d $/unit'
    name: 'Total Lease Subvention: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_subvention.lcsub_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_subvention.lcsub_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total Lease Term Mix
    name: Total Lease Term Mix
    expr: '[formula_Lease Term Mix (24 < Term <= 36)] + [formula_Lease Term Mix (36 < Term <= 39)] + [formula_Lease Term Mix (39 < Term <= 48)] + [formula_Lease Term Mix (Term <= 24)] + [formula_Lease Term Mix (Term > 48)]'
  - id: formula_Lease Term Mix (24 < Term <= 36)
    name: Lease Term Mix (24 < Term <= 36)
    expr: '[formula_Lease Subvention (Term <= 36): Take Rate] / [formula_Total Lease Subvention: Take Rate]'
  - id: 'formula_Lease Subvention (Term <= 36): Take Rate'
    name: 'Lease Subvention (Term <= 36): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_36_takerate.lcsub36_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_36_takerate.lcsub36_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Term Mix (36 < Term <= 39)
    name: Lease Term Mix (36 < Term <= 39)
    expr: '[formula_Lease Subvention (Term <= 39): Take Rate] / [formula_Total Lease Subvention: Take Rate]'
  - id: 'formula_Lease Subvention (Term <= 39): Take Rate'
    name: 'Lease Subvention (Term <= 39): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_39_takerate.lcsub39_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_39_takerate.lcsub39_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Term Mix (39 < Term <= 48)
    name: Lease Term Mix (39 < Term <= 48)
    expr: '[formula_Lease Subvention (Term <= 48): Take Rate] / [formula_Total Lease Subvention: Take Rate]'
  - id: 'formula_Lease Subvention (Term <= 48): Take Rate'
    name: 'Lease Subvention (Term <= 48): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_48_takerate.lcsub48_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_48_takerate.lcsub48_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Term Mix (Term <= 24)
    name: Lease Term Mix (Term <= 24)
    expr: '[formula_Lease Subvention (Term <= 24): Take Rate] / [formula_Total Lease Subvention: Take Rate]'
  - id: 'formula_Lease Subvention (Term <= 24): Take Rate'
    name: 'Lease Subvention (Term <= 24): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_24_takerate.lcsub24_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_24_takerate.lcsub24_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Lease Term Mix (Term > 48)
    name: Lease Term Mix (Term > 48)
    expr: '[formula_Lease Subvention (Term <= 60): Take Rate] / [formula_Total Lease Subvention: Take Rate]'
  - id: 'formula_Lease Subvention (Term <= 60): Take Rate'
    name: 'Lease Subvention (Term <= 60): Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_60_takerate.lcsub60_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.leaseaprsubvention_term_lteq_60_takerate.lcsub60_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Total Lease Subvention: Take Rate'
    name: 'Total Lease Subvention: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_subvention_takerate.lcsub_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.total_lease_subvention_takerate.lcsub_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total PIN F&I Income (PVR)
    name: Total PIN F&I Income (PVR)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.fi_income.fi_income_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) > 0 ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.fi_income.fi_income_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_price.totalprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_price.totalprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total Reported Sales
    name: Total Reported Sales
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::totalsales_measure_group] != 'null' and [formula_New / Used Flag] = 'New' ) then ( to_double ( concat ( sql_string_op ( "json_value(totalsales_measure_group, '$.totalsales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
    properties:
      column_type: ATTRIBUTE
  - id: formula_New / Used Flag
    name: New / Used Flag
    expr: if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'n' ) then "New" else if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'u' ) then "Used" else if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] = 'd' ) then "Demo" else null
  - id: formula_Total SAAR
    name: Total SAAR
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'forecast' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::forecast_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(forecast_measure_group, '$.totalsaar')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Total Spend Less DVB
    name: Total Spend Less DVB
    expr: ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.incentive_spending.incspending')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) ) - ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealervolumebonus.vbcsh')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) )
  - id: formula_Trade Aspiration
    name: Trade Aspiration
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradeaspiration')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Bodytype
    name: Trade Bodytype
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradebodytype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Class
    name: Trade Class
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradepremiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Color
    name: Trade Color
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradecolor')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Cylinders
    name: Trade Cylinders
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradecylinders')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Displacement
    name: Trade Displacement
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradedisplacement')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Doors
    name: Trade Doors
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradedoors')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Drivetype
    name: Trade Drivetype
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradedrivetype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Fueltype
    name: Trade Fueltype
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradefueltype')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade In %
    name: Trade In %
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.tradeinflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Y' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Trade In Same Manufacturer (%)
    name: Trade In Same Manufacturer (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradeoem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.tradeincount')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Trade In Same Nameplate (%)
    name: Trade In Same Nameplate (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradenameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.tradeincount')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) * to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Trade Model
    name: Trade Model
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.trademodel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Modelyear
    name: Trade Modelyear
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.trademodelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Nameplate
    name: Trade Nameplate
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradenameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade OEM
    name: Trade OEM
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradeoem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Payoff
    name: Trade Payoff
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.trade_payoff.tradepayoff_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.trade_payoff.tradepayoff_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Trade Platform
    name: Trade Platform
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradeplatform')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Sales
    name: Trade Sales
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::tradein_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(tradein_measure_group, '$.tradesales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null )
  - id: formula_Trade Segment
    name: Trade Segment
    expr: concat ( sql_string_op ( "json_value(trade_attributes, '$.tradeSegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade Series
    name: Trade Series
    expr: concat ( sql_string_op ( "json_value(tradein_vehicle_attributes, '$.tradeseries')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade-In OA/UA
    name: Trade-In OA/UA
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradein_over_under_allowance.tradein_oa_ua_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradein_over_under_allowance.tradein_oa_ua_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null )
  - id: formula_Trade-in ACV
    name: Trade-in ACV
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradein_acv.tradeinacv_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradein_acv.tradeinacv_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null )
  - id: formula_Trade-in ACV Less Payoff
    name: Trade-in ACV Less Payoff
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.trade_acv_less_payoff.tradeacv_lp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.trade_acv_less_payoff.tradeacv_lp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null )
  - id: formula_Trade-in Amount
    name: Trade-in Amount
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradein_amount.tradeinamount_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradein_amount.tradeinamount_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null )
  - id: 'formula_Trade-in Assistance Program: $ Offer'
    name: 'Trade-in Assistance Program: $ Offer'
    expr: '[formula_Trade-in Assistance Program: Wgt''d $/unit] / [formula_Trade-in Assistance Program: Take Rate]'
  - id: 'formula_Trade-in Assistance Program: Take Rate'
    name: 'Trade-in Assistance Program: Take Rate'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.tradein_assistance_program_takerate.trdin_tr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.tradein_assistance_program_takerate.trdin_tr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Trade-in Assistance Program: Wgt''d $/unit'
    name: 'Trade-in Assistance Program: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.tradein_assistance_program.trdin_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.tradein_assistance_program.trdin_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Trade-in Equity
    name: Trade-in Equity
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.trade_equity.tradeequity_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.trade_equity.tradeequity_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null )
  - id: formula_Trade-in Flag
    name: Trade-in Flag
    expr: concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.tradeinflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Trade-in Odometer
    name: Trade-in Odometer
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradeodometer.tradeodometer_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradeodometer.tradeodometer_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null )
  - id: formula_Trade-in Vehicle Age
    name: Trade-in Vehicle Age
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradein_vehicle_age.tradeinvehicleage_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.tradein_vehicle_age.tradeinvehicleage_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null )
  - id: formula_Transaction Count
    name: Transaction Count
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.pin_transaction_count.transcount')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Transaction Count (Explorer)
    name: Transaction Count (Explorer)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.transcount')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Transmission
    name: Transmission
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_kia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Market Timer' } or ( add_years ( start_of_year ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_kia_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Market Timer' } or ( add_years ( start_of_year ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Inventory' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Inventory' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_volvo' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.transmission')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Trim Level
    name: Trim Level
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_kia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Market Timer' } or ( add_years ( start_of_year ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_kia_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Market Timer' } or ( add_years ( start_of_year ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Inventory' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Inventory' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Inventory' , 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Explorer - New' , 'Explorer - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_volvo' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' , 'Estimated Sales - Used' , 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.trimlevel')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Type of Sale
    name: Type of Sale
    expr: if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Explorer - New' , 'Explorer - Used' } ) then concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.typeofsale')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Regular' , 'Incentives - Stellantis' , 'Incentives - Nissan' } ) then concat ( sql_string_op ( "json_value(incentives_suppl_attributes, '$.typeofsale')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else null
  - id: formula_Type of Sale - Market Timer
    name: Type of Sale - Market Timer
    expr: concat ( sql_string_op ( "json_value(market_timer_suppl_attributes, '$.typeofsale')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: 'formula_Type of Sale : Cash (%)'
    name: 'Type of Sale : Cash (%)'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.cash_weight.cash_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Type of Sale : Finance (%)'
    name: 'Type of Sale : Finance (%)'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.finance_weight.finance_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Type of Sale : Lease(%)'
    name: 'Type of Sale : Lease(%)'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.lease_weight.lease_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.weightedcounts')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Type of Sale Purchase (%)
    name: Type of Sale Purchase (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' and concat ( sql_string_op ( "json_value(transactons_suppl_attributes, '$.typeofsale')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) in { 'C' , 'D' } ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.transcount')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.total_counts.transcount')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Used Days to Turn
    name: Used Days to Turn
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'u' , 'd' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.daystoturn.daystoturn_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'u' , 'd' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.daystoturn.daystoturn_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Used F&I/Unit
    name: Used F&I/Unit
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'u' , 'd' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.fi_income.fi_income_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'u' , 'd' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.fi_income.fi_income_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Used Gross/Unit
    name: Used Gross/Unit
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'u' , 'd' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_gross_profit.vehgrossprofit_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'u' , 'd' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_gross_profit.vehgrossprofit_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Used Vehicle Price
    name: Used Vehicle Price
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'u' , 'd' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price.vehicleprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::newusedflag] in { 'u' , 'd' } and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price.vehicleprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
    properties:
      column_type: ATTRIBUTE
  - id: formula_Vehicle Age
    name: Vehicle Age
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_age.vehicleage_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_age.vehicleage_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Vehicle Cost
    name: Vehicle Cost
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_cost.vehiclecost_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_cost.vehiclecost_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Vehicle Price
    name: Vehicle Price
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Vehicle Price % of MSRP
    name: Vehicle Price % of MSRP
    expr: ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) ) / ( sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.imputed_msrp.msrp_isr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.imputed_msrp.msrp_isr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) )
  - id: formula_Vehicle Price (Explorer)
    name: Vehicle Price (Explorer)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price.vehicleprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price.vehicleprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Vehicle Price Above MSRP (%)
    name: Vehicle Price Above MSRP (%)
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and [formula_Vehicleprice Pct Msrp] > 1 ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'Incentives - Regular' and [formula_Vehicleprice Pct Msrp] > 0 ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Vehicle Price Less Cash Rebate
    name: Vehicle Price Less Cash Rebate
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price_less_rebate.vehpricelessrebate_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_price_less_rebate.vehpricelessrebate_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Vehicle Profit Margin
    name: Vehicle Profit Margin
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_profit_margin_percent.vehprofitmarginpct_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_profit_margin_percent.vehprofitmarginpct_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Vehicle Profit Markup
    name: Vehicle Profit Markup
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_profit_markup_percent.vehprofitmarkuppct_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.vehicle_profit_markup_percent.vehprofitmarkuppct_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Vehicleprice Pct Msrp
    name: Vehicleprice Pct Msrp
    expr: ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.vehicle_price.vehprice_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) ) / ( ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.imputed_msrp.msrp_isr_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.imputed_msrp.msrp_isr_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) )
  - id: formula_Visible Cash Incentive Spending Per Unit
    name: Visible Cash Incentive Spending Per Unit
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cash_incentivespending_per_unit.cash_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cash_incentivespending_per_unit.cash_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Visible Cash Offer/Unit
    name: Visible Cash Offer/Unit
    expr: '[formula_Visible Cash Incentive Spending: Wgt''d $/unit] / [formula_Cash Incentive Penetration]'
  - id: formula_Cash Incentive Penetration
    name: Cash Incentive Penetration
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.cash_incentive_penetration.cash_incntv_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Visible Finance Offer/Unit
    name: Visible Finance Offer/Unit
    expr: '[formula_Visible Finance Incentive Spending: Wgt''d $/unit] / [formula_Supported Finance Incentive Penetration]'
  - id: formula_Supported Finance Incentive Penetration
    name: Supported Finance Incentive Penetration
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.finance_incentive_penetration.fin_incntv_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Visible Lease Offer/Unit
    name: Visible Lease Offer/Unit
    expr: '[formula_Visible Lease Incentive Spending: Wgt''d $/unit] / [formula_Supported Lease Incentive Penetration]'
  - id: formula_Supported Lease Incentive Penetration
    name: Supported Lease Incentive Penetration
    expr: sum ( if ( ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_incentive_penetration.lease_incntv_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_incentive_penetration.lease_incntv_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) * ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.lease_incentive_penetration.lease_incntv_pct')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) != null ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.weighted_counts.sales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Visible Spending/Unit
    name: Visible Spending/Unit
    expr: '[formula_Visible Cash Incentive Spending: Wgt''d $/unit] + [formula_Visible Finance Incentive Spending: Wgt''d $/unit] + [formula_Visible Lease Incentive Spending: Wgt''d $/unit]'
  - id: 'formula_Visible Cash Incentive Spending: Wgt''d $/unit'
    name: 'Visible Cash Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.visible_cash_incentivespending_per_unit.visi_cash_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.visible_cash_incentivespending_per_unit.visi_cash_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Visible Finance Incentive Spending: Wgt''d $/unit'
    name: 'Visible Finance Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.visible_finance_incentivespending_per_unit.visi_fi_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.visible_finance_incentivespending_per_unit.visi_fi_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: 'formula_Visible Lease Incentive Spending: Wgt''d $/unit'
    name: 'Visible Lease Incentive Spending: Wgt''d $/unit'
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.visible_lease_incentivespending_per_unit.visi_ls_unit_w_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.visible_lease_incentivespending_per_unit.visi_ls_unit_w_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Weighted Counts of All other generation buyer transactions
    name: Weighted Counts of All other generation buyer transactions
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.generation.gen_unknown_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Weighted Counts of Boomer buyer transactions
    name: Weighted Counts of Boomer buyer transactions
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.generation.boomer_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Weighted Counts of Female customers
    name: Weighted Counts of Female customers
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.gender.femalecount')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Weighted Counts of Generation X buyer transactions
    name: Weighted Counts of Generation X buyer transactions
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.generation.genx_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Weighted Counts of Generation Y buyer transactions
    name: Weighted Counts of Generation Y buyer transactions
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.generation.geny_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Weighted Counts of Generation Z buyer transactions
    name: Weighted Counts of Generation Z buyer transactions
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.generation.genz_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Weighted Counts of Male customers
    name: Weighted Counts of Male customers
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.gender.malecount')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Weighted Counts of Pre-Boomer buyer transactions
    name: Weighted Counts of Pre-Boomer buyer transactions
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.generation.preboomer_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_YoY CFTP
    name: YoY CFTP
    expr: ( [formula_Current Month CFTP] - [formula_Current Month Previous Year CFTP] )
  - id: formula_Current Month CFTP
    name: Current Month CFTP
    expr: group_aggregate ( [formula_CFTP] , query_groups ( ) , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = 0 } )
  - id: formula_Current Month Previous Year CFTP
    name: Current Month Previous Year CFTP
    expr: group_aggregate ( [formula_CFTP] , query_groups ( ) , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 12 } )
  - id: formula_CFTP
    name: CFTP
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.CFTP.cftp_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_YoY Incentive Spending
    name: YoY Incentive Spending
    expr: '[formula_Current Month Incentive Spending] - [formula_Current Month Previous Year Incentive Spending]'
  - id: formula_Current Month Incentive Spending
    name: Current Month Incentive Spending
    expr: group_aggregate ( [formula_Incentive Spending] , query_groups ( ) , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) = 0 } )
  - id: formula_Current Month Previous Year Incentive Spending
    name: Current Month Previous Year Incentive Spending
    expr: group_aggregate ( [formula_Incentive Spending] , query_groups ( ) , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) = - 12 } )
  - id: formula_Incentive Spending
    name: Incentive Spending
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.incentive_spending.incspending_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.incentive_spending.incspending_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_YoY Inventory Share
    name: YoY Inventory Share
    expr: '[formula_Current Month Inventory Share] - sum ( group_aggregate ( [formula_Inventory] , query_groups ( ) , { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 12 } ) ) / sum ( group_aggregate ( [formula_Inventory] , query_groups ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) = - 12 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 12 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } ) )'
  - id: formula_Current Month Inventory Share
    name: Current Month Inventory Share
    expr: sum ( group_aggregate ( [formula_Inventory] , query_groups ( ) , { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = 0 } ) ) / sum ( group_aggregate ( [formula_Inventory] , query_groups ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = 0 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = 0 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } ) )
  - id: formula_Inventory
    name: Inventory
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] = 'inventory' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::inventory_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(inventory_measure_group, '$.invcountwtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else null )
  - id: formula_YoY Retail Share
    name: YoY Retail Share
    expr: '[formula_Current Month Retail Share] - sum ( group_aggregate ( [formula_Retail Sales] , query_groups ( ) , { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 12 } ) ) / sum ( group_aggregate ( [formula_Retail Sales] , query_groups ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = - 12 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , [Month Parameter] ) = - 12 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } ) )'
  - id: formula_Current Month Retail Share
    name: Current Month Retail Share
    expr: sum ( group_aggregate ( [formula_Retail Sales] , query_groups ( ) , { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = 0 } ) ) / sum ( group_aggregate ( [formula_Retail Sales] , query_groups ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = 0 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } , query_filters ( ) + { diff_months ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] , today ( ) ) = 0 } - { [formula_OEM] , [formula_Nameplate] , [formula_Model] , [formula_Series] , [formula_Client Segment] , [formula_Super Segment] , [formula_Premium Flag] , [formula_Model Year] } ) )
  - id: formula_Client Segment
    name: Client Segment
    expr: if ( ts_groups = 'administrator' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Customer Success' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Customer Success (Demographics)' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'Internal Non Customer Success' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_acura' ) then concat ( sql_string_op ( "json_value(acura_attributes, '$.acurasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_afs' ) then concat ( sql_string_op ( "json_value(audi_attributes, '$.audisegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_audi' ) then concat ( sql_string_op ( "json_value(audi_attributes, '$.audisegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_bmw' ) then concat ( sql_string_op ( "json_value(bmw_attributes, '$.bmwsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_ford' ) then concat ( sql_string_op ( "json_value(ford_attributes, '$.fordsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_genesis' ) then concat ( sql_string_op ( "json_value(hyundai_attributes, '$.hyundaisegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_gm' ) then concat ( sql_string_op ( "json_value(gm_attributes, '$.gmsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then concat ( sql_string_op ( "json_value(hyundai_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then concat ( sql_string_op ( "json_value(hyundai_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_hatcikia' ) then concat ( sql_string_op ( "json_value(kia_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_honda' ) then concat ( sql_string_op ( "json_value(honda_attributes, '$.hondasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_honda_corp' ) then concat ( sql_string_op ( "json_value(honda_attributes, '$.hondasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_honda_incentive' ) then concat ( sql_string_op ( "json_value(honda_attributes, '$.hondasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_hyundai' ) then concat ( sql_string_op ( "json_value(hyundai_attributes, '$.hyundaisegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_infiniti' ) then concat ( sql_string_op ( "json_value(infiniti_attributes, '$.infinitisegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_jlr' ) then concat ( sql_string_op ( "json_value(jlr_attributes, '$.jlrsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_kia' ) then concat ( sql_string_op ( "json_value(kia_attributes, '$.kiasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_kia_incentive' ) then concat ( sql_string_op ( "json_value(kia_attributes, '$.kiasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_lucid' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_mazda' ) then concat ( sql_string_op ( "json_value(mazda_attributes, '$.mazdasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_mercedes' ) then concat ( sql_string_op ( "json_value(mb_attributes, '$.mbSegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_nissan' ) then concat ( sql_string_op ( "json_value(nissan_attributes, '$.nissansegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then concat ( sql_string_op ( "json_value(nissan_attributes, '$.nissansegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_rivian' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_set' ) then concat ( sql_string_op ( "json_value(toyota_attributes, '$.toyotasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_stellantis' ) then concat ( sql_string_op ( "json_value(fca_attributes, '$.fcasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_volvo' ) then concat ( sql_string_op ( "json_value(volvo_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_ally' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_gst' ) then concat ( sql_string_op ( "json_value(toyota_attributes, '$.toyotasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_karma' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_maserati' ) then concat ( sql_string_op ( "json_value(maserati_attributes, '$.maseratisegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_mitsu' ) then concat ( sql_string_op ( "json_value(mitsubishi_attributes, '$.mitsubishisegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_porsche' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_subaru' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_tms_lexus' ) then concat ( sql_string_op ( "json_value(toyota_attributes, '$.toyotasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_tms_toyota' ) then concat ( sql_string_op ( "json_value(toyota_attributes, '$.toyotasegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_vci' ) then concat ( sql_string_op ( "json_value(vw_attributes, '$.vmsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_vw' ) then concat ( sql_string_op ( "json_value(vw_attributes, '$.vmsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_squarepointcap' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else if ( ts_groups = 'pin_haval' ) then concat ( sql_string_op ( "json_value(pin_attributes, '$.pinsegment')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) else null
  - id: formula_Model
    name: Model
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.model')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Model Year
    name: Model Year
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_infiniti' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mercedes' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } or ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.modelyear')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Nameplate
    name: Nameplate
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_afs' ) then ( if ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_audi' ) then ( if ( ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Stellantis' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Stellantis' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } or ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Incentives - Nissan' , 'Incentives - Regular' , 'Incentives - Stellantis' , 'Inventory' } and concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) = 'Tesla' ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.nameplate')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_OEM
    name: OEM
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.oem')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Premium Flag
    name: Premium Flag
    expr: concat ( sql_string_op ( "json_value(vehicleattributes, '$.premiumflag')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) )
  - id: formula_Retail Sales
    name: Retail Sales
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retailsales_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - New' } ) then ( to_double ( concat ( sql_string_op ( "json_value(retailsales_measure_group, '$.retailsales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) + sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::usedsales_measure_group] != 'null' and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' } ) then ( to_double ( concat ( sql_string_op ( "json_value(usedsales_measure_group, '$.retailsales')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_Series
    name: Series
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_nissan_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Total Sales' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.series')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_Super Segment
    name: Super Segment
    expr: if ( ts_groups = 'pin_acura' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_ford' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_genesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_gm' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcigenesis' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcihyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hatcikia' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_corp' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_honda_incentive' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_hyundai' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_jlr' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_lucid' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mazda' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_rivian' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_set' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_stellantis' ) then ( if ( ( add_months ( start_of_month ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] and [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_karma' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_maserati' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_mitsu' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_porsche' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Market Timer' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_subaru' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_lexus' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_tms_toyota' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Inventory' , 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vci' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_vw' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Market Timer' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else if ( ts_groups = 'pin_haval' ) then ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] in { 'Estimated Sales - Used' , 'Navigator - New' , 'Navigator - Used' } ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.superseg')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) )
  - id: formula_cust_cash_rebate
    name: cust_cash_rebate
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.customer_cash_rebate.customercashrebate_wtd')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 ) / sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::retail_transactions_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(retail_transactions_measure_group, '$.customer_cash_rebate.customercashrebate_weight')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_last 3 year
    name: last 3 year
    expr: ( if ( ( add_years ( start_of_year ( now ( ) ) , - 2 ) > [PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt] ) ) then 'All' else ( concat ( sql_string_op ( "json_value(vehicleattributes, '$.sector')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) )
  - id: formula_lease_cash_offer
    name: lease_cash_offer
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_cust_bonuscash_tos_lease.sales_spin')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_lease_loyalty_cash
    name: lease_loyalty_cash
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.conquest_cash.noncoreincentive10')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_lease_residual_subvention
    name: lease_residual_subvention
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.dealercash.noncoreincentive2_employeepricing')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_noncoreincentive4_creditunionmemberdiscount
    name: noncoreincentive4_creditunionmemberdiscount
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive5_reconsensus_dealercash.noncoreincentive6_dealerbonuscertificates')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_noncoreincentive7_instantvaluecertificate
    name: noncoreincentive7_instantvaluecertificate
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive8.noncoreincentive9')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_total_combo_apr_subvention
    name: total_combo_apr_subvention
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.captivelender_cust_bonuscash_tos_finance.dealervolumebonus')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_total_finance_apr_subvention
    name: total_finance_apr_subvention
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.consumer_bonuscash.captivelender_dealercash_lease_tos')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  - id: formula_tradein_assistance_program
    name: tradein_assistance_program
    expr: sum ( if ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::pricing_metrics_measure_group] != 'null' ) then ( to_double ( concat ( sql_string_op ( "json_value(pricing_metrics_measure_group, '$.noncoreincentive1_emp_supplier_dealerbonuscash.noncoreincentive3_firsttimebuyer')" ) , left ( [PIN_RETAIL_DATA_DIGEST_FINAL_V3::source] , 0 ) ) ) ) else 0 )
  filters:
  - column:
    - Source Filter
    oper: in
    values:
    - 'true'
  - column:
    - Tesla and Premium Filter
    oper: in
    values:
    - 'true'
  - column:
    - Date Filter
    oper: in
    values:
    - 'true'
  columns:
  - name: Retail SAAR
    description: An annualized measure of monthly sales performance
    formula_id: formula_Retail SAAR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Retail Sales: ''}
  - name: Series
    description: Like models may be grouped together as belonging to a series which may include a variety of different engine types, body types, or chassis.  Note that while every model carries a series naming convention within PIN, series-level aggregates are provided only where multiple PIN models are mapped to a single series (i.e., Ford F-Series, BMW 3 Series, Toyota Camry).
    formula_id: formula_Series
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Credit Score
    description: The credit bureau rating for the customer at the time of the transaction. For USA, score is calculated using the FICO Risk Score, Classic Auto. For Canada, score is calculated using the TransUnion CreditVision algorithm.
    formula_id: formula_Credit Score
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Navigator: ''}
  - name: Buy Rate APR/IRR
    description: The rate offered to the retailer by the financing/leasing institution (e.g. Chase or Wells Fargo), based on the credit worthiness of the customer. The retailer, as an agent for the financing/leasing institution, then has the option of charging the customer a rate in excess of this buy rate. The commission or Dealer Reserve amount earned by the retailer is based on the spread between these two rates during the term of the contract.
    formula_id: formula_Buy Rate APR/IRR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Vehicle Profit Markup
    description: Vehicle Gross divided by Vehicle Cost.
    formula_id: formula_Vehicle Profit Markup
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Term
    formula_id: formula_Average Term
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Total Reported Sales
    description: Retail sales plus Fleet sales
    formula_id: formula_Total Reported Sales
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Total Sales: ''}
  - name: Lease 39M PMT (37-39)
    formula_id: formula_Lease 39M PMT (37-39)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Model
    description: The classification of the vehicle as a particular variety within the same nameplate/make (e.g. Honda Civic, Honda Accord).
    formula_id: formula_Model
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Days Supply
    description: Weighted current inventory divided by 3 month average selling rate
    formula_id: formula_Days Supply
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Inventory: ''}
  - name: Gross/Unit
    description: The dollar profit that the retailer makes on the vehicle and on factory and dealer-installed accessories and options, contracted for at the time of sale.
    formula_id: formula_Gross/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Customer Age
    description: The age of the customer at the time of purchase or lease.
    formula_id: formula_Customer Age
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Life Insurance Income
    description: The retailer commission (profit) made on the sale of Credit Life Insurance.
    formula_id: formula_Life Insurance Income
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Cylinder
    formula_id: formula_Cylinders
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Inventory Share %
    formula_id: formula_Inventory Share %
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Inventory: ''}
  - name: 'Type of Sale : Lease(%)'
    description: The percentage of transactions in which a customer leases the vehicle through a lessor provided by the retailer.
    formula_id: 'formula_Type of Sale : Lease(%)'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Incentive Spending
    description: Sum of weighted cost per unit across all incentive types. This value is intended to reflect the out-of-pocket market value of OEM/captive-funded incentive programs. As such, any federal tax credits applicable to HEV/EV units are deducted from the program value to arrive at incentive spending net of federal tax credits.  For instance, if the market value of OEM incentive offers for Vehicle X is assessed at $10,000/unit but the lienholder would qualify for a $7,500 federal tax credit, incentive spending per unit would equal $10,000 - $7,500 or $2,500/unit.
    formula_id: formula_Incentive Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Trade-in Amount
    description: The dollar amount the retailer allows the customer for the trade-in vehicle.
    formula_id: formula_Trade-in Amount
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Trade Sales
    formula_id: formula_Trade Sales
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Trade-In: ''}
  - name: Service Contract Income
    description: The retailer commission (profit) made on the sale of a Service Contract.
    formula_id: formula_Service Contract Income
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease 36M PMT  (25-36)
    formula_id: formula_Lease 36M PMT  (25-36)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Doors
    formula_id: formula_Doors
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Model Year
    description: The vehicle model year as derived from the Vehicle Identification Number (VIN) decoding process
    formula_id: formula_Model Year
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: 'Type of Sale : Cash (%)'
    description: The percentage of transactions in which a purchaser either pays the total price of the vehicle on delivery or finances the vehicle through a lender not provided by the retailer (e.g. via personal bank or credit union).
    formula_id: 'formula_Type of Sale : Cash (%)'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Trade-in Flag
    formula_id: formula_Trade-in Flag
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Transaction Attributes: ''}
  - name: Odometer
    description: The vehicle odometer reading, at the time of transaction.
    formula_id: formula_Odometer
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: OEM
    description: The manufacturer of the vehicle (e.g. Ford, General Motors, Toyota) as defined by J.D. Power
    formula_id: formula_OEM
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Lease 48M PMT (40-48)
    formula_id: formula_Lease 48M PMT (40-48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Service Contract Premium
    description: The total price charged to the customer for the Service Contract.
    formula_id: formula_Service Contract Premium
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Negative Equity Percentage
    description: The percentage of transactions with a Trade In where the Trade Payoff exceeds the Trade In ACV.
    formula_id: formula_Negative Equity Percentage
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Aggregate Payment
    formula_id: formula_Aggregate Payment (Sum of all payments over the entire lease term)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Market Timer: ''}
  - name: Contract Price
    description: The price printed on the customers purchase contract, which includes the vehicle and any factory and dealer-installed accessories and options contracted for at the time of sale, and without any adjustments, either for the trade-in allowance or for any customer cash rebate amount. This price is not the Manufacturers Suggested Retail Price (MSRP).
    formula_id: formula_Contract Price
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Displacement
    formula_id: formula_Displacement
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Trade-in Odometer
    description: The trade-in vehicle odometer reading at the time of transaction.
    formula_id: formula_Trade-in Odometer
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease Cap Reduction
    description: Cap Reduction is the prepayment of a leased vehicles depreciation, made by the customer at the time of the lease transaction. The prepayment may be comprised of a Cash Down Payment, Trade In Equity, and/or Customer Cash Rebates offered by the dealer or vehicle manufacturer.
    formula_id: formula_Lease Cap Reduction
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Customer Age 35-55 (%)
    description: The percentage of retail buyers between 36 and 55 years of age.
    formula_id: formula_Customer Age 35-55 (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Transmission
    formula_id: formula_Transmission
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Drive Type
    formula_id: formula_Drive Type
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Super Segment
    formula_id: formula_Super Segment
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Segmentation Attributes: ''}
  - name: Sector
    formula_id: formula_Sector
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Segmentation Attributes: ''}
  - name: Term Group
    description: The number of months that a customer will make finance or lease payments on the vehicle.
    formula_id: formula_Term Group
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Fuel Type
    formula_id: formula_Fuel Type
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: FICO C (625 - 649)
    formula_id: formula_FICO C (625 - 649)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Navigator: ''}
  - name: Used F&I/Unit
    formula_id: formula_Used F&I/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Platform
    formula_id: formula_Platform
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Premium Flag
    formula_id: formula_Premium Flag
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Segmentation Attributes: ''}
  - name: Retail Sales
    description: Vehicles with <500 miles on the odometer bought by a retail customer
    formula_id: formula_Retail Sales
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Retail Sales: ''}
  - name: Lender
    formula_id: formula_Lender
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Total Down
    description: For Finance transactions, Total Down is the total amount of cash and equity applied as a down payment on the vehicle. For Lease transactions, Total Down is the total initial payment (also known as Drive-Off) that the customer must make at the time of vehicle delivery.
    formula_id: formula_Total Down
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Vehicle Profit Margin
    description: Vehicle Gross divided by Vehicle Price.
    formula_id: formula_Vehicle Profit Margin
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Monthly Payment Lease
    formula_id: formula_Monthly Payment Lease
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: New / Used Flag
    formula_id: formula_New / Used Flag
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Category of Sale: ''}
  - name: FICO B (650 - 679)
    formula_id: formula_FICO B (650 - 679)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Navigator: ''}
  - name: Dealer Reserve Penetration
    description: The The percentage of finance/lease transactions in which the retailer received a Dealer Reserve amount or a flat fee up to $500.
    formula_id: formula_Dealer Reserve Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Used Gross/Unit
    formula_id: formula_Used Gross/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Retail Share %
    description: Percentage of Retail Sales within a sub-section of the industry
    formula_id: formula_Retail Share %
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Retail Sales: ''}
  - name: Dealer Reserve
    description: The retailer commission (profit) made by marking up the finance or lease APR/IRR rate charged to the customer.
    formula_id: formula_Dealer Reserve
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Body Type
    formula_id: formula_Body Type
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Transaction Count (Explorer)
    description: The number of individual transactions returned for selected measures and options.
    formula_id: formula_Transaction Count (Explorer)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease Residual
    description: The dollar value of the vehicle at the end of the lease, as estimated by the lessor at the beginning of the lease.
    formula_id: formula_Lease Residual
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: FICO Sum
    formula_id: formula_FICO Sum
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
      is_hidden: true
    data_panel_column_groups: {Navigator: ''}
  - name: Trim Level
    formula_id: formula_Trim Level
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Trade-in Vehicle Age
    description: The age of the trade-in vehicle, calculated as the difference (in years) between the trade-in date and the midpoint of the trade-in model year.
    formula_id: formula_Trade-in Vehicle Age
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Days to Turn
    description: The number of days between the date that the vehicle arrived at the retailer and the date that the vehicle was purchased or leased. Days to Turn is an indicator of selling velocity.
    formula_id: formula_Days to Turn
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Used Days to Turn
    formula_id: formula_Used Days to Turn
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Inventory
    description: Retail inventory data sourced independently from dealers' source of truth using VINs from vehicles that are at dealerships or in-transit.
    formula_id: formula_Inventory
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Inventory: ''}
  - name: Color
    formula_id: formula_Color
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Vehicle Age
    description: The age of the vehicle, calculated as the difference (in years) between the sold date and the midpoint of the vehicle's model year.
    formula_id: formula_Vehicle Age
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Monthly Payment Finance
    formula_id: formula_Monthly Payment Finance
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Gap Insurance Premium
    description: The total price charged to the customer for the GAP Insurance policy.
    formula_id: formula_Gap Insurance Premium
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Returning Volume Lease
    formula_id: formula_Returning Volume Lease
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Market Timer: ''}
  - name: Trade-in Equity
    description: Also known as Net Trade. The customers equity in the trade-in vehicle, equal to the Trade In Amount less the Trade In Payoff.
    formula_id: formula_Trade-in Equity
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Trade-in ACV Less Payoff
    description: The Actual Cash Value (ACV) of the customers trade, less the Trade Payoff (amount the customer still owes on his previously-financed Trade In)
    formula_id: formula_Trade-in ACV Less Payoff
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Life Insurance Cost
    formula_id: formula_Life Insurance Cost
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Nameplate
    description: The brand name or make of the vehicle (e.g. Chevrolet, Lexus, Jaguar)
    formula_id: formula_Nameplate
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Life Insurance Premium
    description: The total price charged to the customer for Credit Life Insurance.
    formula_id: formula_Life Insurance Premium
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Trade-in ACV
    description: The trade-in vehicles Actual Cash Value (ACV) or wholesale market value. This is the amount at which the retailer will book the vehicle into inventory.
    formula_id: formula_Trade-in ACV
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: FI Income
    formula_id: formula_Average FI Income
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Customer Age 56+ (%)
    description: The percentage of retail buyers who are 56+ years of age.
    formula_id: formula_Customer Age 56+ (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: FICO D <625
    formula_id: formula_FICO D <625
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Navigator: ''}
  - name: Lease Term
    formula_id: formula_Avg Lease Term
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Service Contract Penetration
    description: The percentage of transactions in which a Service Contract was sold to the customer, as part of a new vehicle purchase.
    formula_id: formula_Service Contract Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Vehicle Price
    description: The negotiated price that the customer agrees to pay for the vehicle + factory and/or dealer-installed accessories and options contracted for at the time of sale.  This value is inclusive of trade-in over/under allowance and any dealer-facing incentives passed to the consumer via the negotiation but is not adjusted to reflect visible incentives (i.e., cash rebates). This is not the Manufacturer's Suggested Retail Price (MSRP).
    formula_id: formula_Vehicle Price
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Direct Fin Flag
    formula_id: formula_Direct Fin Flag
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: FICO A (680 - 719)
    formula_id: formula_FICO A (680 - 719)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Navigator: ''}
  - name: Life Insurance Penetration
    description: The percentage of transactions in which Credit Life Insurance was sold to the customer.
    formula_id: formula_Life Insurance Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Monthly Payment
    description: The amount owed to the lender/lessor each month.
    formula_id: formula_Monthly Payment
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Trade-In OA/UA
    description: Also known as Trade In Over (Under) Allowance. The difference, if any, between Trade In Amount (the amount the retailer allows the customer for the trade-in) and Trade In ACV (Actual Cash Value, or wholesale market value of the trade-in). An Over Allowance occurs when the retailer allows more for the trade-in than it is worth. An Under Allowance occurs when the retailer gives the customer less than it is worth.
    formula_id: formula_Trade-In OA/UA
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Aspirations
    formula_id: formula_Aspirations
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Customer Age 18-35 (%)
    description: The percentage of retail buyers between 18 and 35 years of age.
    formula_id: formula_Customer Age 18-35 (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Body Type 2
    formula_id: formula_Body Type 2
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: 'Type of Sale : Finance (%)'
    description: The percentage of transactions in which a purchaser finances the vehicle through a lender provided by the retailer.
    formula_id: 'formula_Type of Sale : Finance (%)'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Used Vehicle Price
    formula_id: formula_Used Vehicle Price
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: FICO  A+ (720+)
    formula_id: formula_FICO  A+ (720+)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Navigator: ''}
  - name: Captive Flag
    formula_id: formula_Captive Flag
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Transaction Attributes: ''}
  - name: Vehicle Cost
    description: The retailers net or dead cost for the vehicle and for both factory and dealer-installed accessories contracted for at the time of sale.
    formula_id: formula_Vehicle Cost
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: 'Lease Cash: Wgt''d $/unit'
    description: 'Rebates for captive leased vehicles; consists of cash offered directly to the consumer for captive leases. Also referred to as cap cost reduction. Manufacturer offers are used to determine the amount. PIN data are used to determine the take rate. (Note: OEM supported lease transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward)'
    formula_id: 'formula_Lease Cash: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Cash: Take Rate'
    description: 'Rebates for captive leased vehicles; consists of cash offered directly to the consumer for captive leases. Also referred to as cap cost reduction. Manufacturer offers are used to determine the amount. PIN data are used to determine the take rate. (Note: OEM supported lease transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward)'
    formula_id: 'formula_Lease Cash: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Residual Subvention: Wgt''d $/unit'
    description: Dollars spent to enhance residual value above the anticipated market vale at end of OEM-supported lease term. ALG reported residual values are used to compare with PIN residual amounts to determine the subvention. PIN data are used to determine the take rates. Non-captive OEM supported leases are included effective Sep'12-forward.
    formula_id: 'formula_Lease Residual Subvention: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Residual Subvention: Take Rate'
    description: Dollars spent to enhance residual value above the anticipated market vale at end of OEM-supported lease term. ALG reported residual values are used to compare with PIN residual amounts to determine the subvention. PIN data are used to determine the take rates. Non-captive OEM supported leases are included effective Sep'12-forward.
    formula_id: 'formula_Lease Residual Subvention: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease APR Subvention: Wgt''d $/unit'
    description: Dollars spent to reduce supported lease payments below the current market rate and the present value of residual enhancement. The precise structure of each lease (amount financed, term, APR, taxes, security deposit, etc.) is used to determine the exact present value of the interest subvention. Cost of funds rate is used as baseline for comparison. PIN data are used to determine the take rates. Non-captive OEM supported leases are included effective Sep'12-forward.
    formula_id: 'formula_Lease APR Subvention: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease APR Subvention: Take Rate'
    description: Dollars spent to reduce supported lease payments below the current market rate and the present value of residual enhancement. The precise structure of each lease (amount financed, term, APR, taxes, security deposit, etc.) is used to determine the exact present value of the interest subvention. Cost of funds rate is used as baseline for comparison. PIN data are used to determine the take rates. Non-captive OEM supported leases are included effective Sep'12-forward.
    formula_id: 'formula_Lease APR Subvention: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Customer Bonus - Finance Type of Sale: Wgt''d $/unit'
    description: Cash offered directly to the consumer for loans facilitated via a specified captive/preferred lender. Manufacturer offers are used to determine the amount. PIN data are used to determine take rates. Assume applied to 100% of type of sale finance and captive, unless otherwise specified.
    formula_id: 'formula_Captive Lender Customer Bonus - Finance Type of Sale: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Customer Bonus - Finance Type of Sale: Take Rate'
    description: Cash offered directly to the consumer for loans facilitated via a specified captive/preferred lender. Manufacturer offers are used to determine the amount. PIN data are used to determine take rates. Assume applied to 100% of type of sale finance and captive, unless otherwise specified.
    formula_id: 'formula_Captive Lender Customer Bonus - Finance Type of Sale: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Customer Bonus - Lease Type of Sale: Wgt''d $/unit'
    description: Cash offered directly to the consumer for leases facilitated via a specified captive/preferred lender. Manufacturer offers are used to determine the amount. PIN data are used to determine take rates. Assume applied to 100% of type of sale lease and captive, unless otherwise specified.
    formula_id: 'formula_Captive Lender Customer Bonus - Lease Type of Sale: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Customer Bonus - Lease Type of Sale: Take Rate'
    description: Cash offered directly to the consumer for leases facilitated via a specified captive/preferred lender. Manufacturer offers are used to determine the amount. PIN data are used to determine take rates. Assume applied to 100% of type of sale lease and captive, unless otherwise specified.
    formula_id: 'formula_Captive Lender Customer Bonus - Lease Type of Sale: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Cash - Cash Type of Sale: Wgt''d $/unit'
    description: Cash paid directly to dealers in form of per-vehicle payments, applicable to transactions defined as cash type of sale. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume take rate of 100% within type of sale if no restrictions apply
    formula_id: 'formula_Dealer Cash - Cash Type of Sale: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Cash - Cash Type of Sale: Take Rate'
    description: Cash paid directly to dealers in form of per-vehicle payments, applicable to transactions defined as cash type of sale. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume take rate of 100% within type of sale if no restrictions apply
    formula_id: 'formula_Dealer Cash - Cash Type of Sale: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Dealer Cash - Lease Type of Sale: Wgt''d $/unit'
    description: 'Cash paid directly to dealers in form of per-vehicle payments on leased units facilitated by captive/preferred lenders. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume 100% penetration within type of sale if no restrictions apply.   (For reference:  Ford Motor Credit Co., Toyota Motor Finance, etc... = Captive.  Chrysler Capital, Ally, and other recognized OEM-lender partnerships = Preferred lender)'
    formula_id: 'formula_Captive Lender Dealer Cash - Lease Type of Sale: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Dealer Cash - Lease Type of Sale: Take Rate'
    description: 'Cash paid directly to dealers in form of per-vehicle payments on leased units facilitated by captive/preferred lenders. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume 100% penetration within type of sale if no restrictions apply.   (For reference:  Ford Motor Credit Co., Toyota Motor Finance, etc... = Captive.  Chrysler Capital, Ally, and other recognized OEM-lender partnerships = Preferred lender)'
    formula_id: 'formula_Captive Lender Dealer Cash - Lease Type of Sale: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Sales Spin: Wgt''d $/unit'
    description: Dollars paid to sales managers or salespersons. Manufacturer offers are used to determine the amount. The midpoint is assumed as the average offer where offers consist of a range of outcomes.  Penetration is assumed to be 100% of applicable transactions
    formula_id: 'formula_Sales Spin: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Sales Spin: Take Rate'
    description: Dollars paid to sales managers or salespersons. Manufacturer offers are used to determine the amount. The midpoint is assumed as the average offer where offers consist of a range of outcomes.  Penetration is assumed to be 100% of applicable transactions
    formula_id: 'formula_Sales Spin: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Loyalty Cash: Wgt''d $/unit'
    description: Cash offered to returning lessees on leases or purchases. Manufacturer offers are used to determine the amount. Loyalty calculation depends on program coverage (model, nameplate, OEM). PIN trade-in information and PIN lease penetration is used to calculate take rate.
    formula_id: 'formula_Lease Loyalty Cash: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Loyalty Cash: Take Rate'
    description: Cash offered to returning lessees on leases or purchases. Manufacturer offers are used to determine the amount. Loyalty calculation depends on program coverage (model, nameplate, OEM). PIN trade-in information and PIN lease penetration is used to calculate take rate.
    formula_id: 'formula_Lease Loyalty Cash: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Conquest Cash: Wgt''d $/unit'
    description: Cash offered to consumers who currently own a competitive vehicles on leases or purchases. Manufacturer offers are used to determine the amount. PIN trade-in information is used to calculate take rate. Assume no trade-in necessary unless otherwise indicated.
    formula_id: 'formula_Conquest Cash: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Conquest Cash: Take Rate'
    description: Cash offered to consumers who currently own a competitive vehicles on leases or purchases. Manufacturer offers are used to determine the amount. PIN trade-in information is used to calculate take rate. Assume no trade-in necessary unless otherwise indicated.
    formula_id: 'formula_Conquest Cash: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Purchase Loyalty Cash: Wgt''d $/unit'
    description: Cash offered to returning owners (including current lessees) on leases or purchases. Manufacturer offers are used to determine the available amount. Loyalty calculations depends on program coverage (model, nameplate, OEM). PIN trade-in information is used to calculate take rate. Unless otherwise described, assume no trade-in necessary.
    formula_id: 'formula_Purchase Loyalty Cash: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Purchase Loyalty Cash: Take Rate'
    description: Cash offered to returning owners (including current lessees) on leases or purchases. Manufacturer offers are used to determine the available amount. Loyalty calculations depends on program coverage (model, nameplate, OEM). PIN trade-in information is used to calculate take rate. Unless otherwise described, assume no trade-in necessary.
    formula_id: 'formula_Purchase Loyalty Cash: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Aged Inventory Program: Wgt''d $/unit'
    description: Cash offered to vehicles which have been in dealer inventory for longer than a prescribed number of days. Manufacturer offers are used to determine the amount. PIN days to turn is used to calculate take rate.
    formula_id: 'formula_Aged Inventory Program: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Aged Inventory Program: Take Rate'
    description: Cash offered to vehicles which have been in dealer inventory for longer than a prescribed number of days. Manufacturer offers are used to determine the amount. PIN days to turn is used to calculate take rate.
    formula_id: 'formula_Aged Inventory Program: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Trade-in Assistance Program: Wgt''d $/unit'
    description: Cash offered to leases or purchases with a traded-in vehicle. Manufacturer offers are used to determine the amount. PIN trade in penetration is used to calculate take rate.
    formula_id: 'formula_Trade-in Assistance Program: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Trade-in Assistance Program: Take Rate'
    description: Cash offered to leases or purchases with a traded-in vehicle. Manufacturer offers are used to determine the amount. PIN trade in penetration is used to calculate take rate.
    formula_id: 'formula_Trade-in Assistance Program: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 1: Wgt''d $/unit'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 1: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 1: Take Rate'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 1: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 2: Wgt''d $/unit'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 2: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 2: Take Rate'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 2: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Cash Rebate
    description: Cash offered directly to the consumer of the vehicle. Offer values reflect non-zero manufacturer offers and PIN data are used to determine the take rate.
    formula_id: formula_cust_cash_rebate
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Total Finance APR Subvention
    description: 'Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. (Note: OEM supported finance transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward.)'
    formula_id: formula_total_finance_apr_subvention
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Total Combo APR Subvention
    formula_id: formula_total_combo_apr_subvention
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Cash Offer
    description: 'Rebates for captive leased vehicles; consists of cash offered directly to the consumer for captive leases. Also referred to as cap cost reduction. Manufacturer offers are used to determine the amount. PIN data are used to determine the take rate. (Note: OEM supported lease transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward)'
    formula_id: formula_lease_cash_offer
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Residual Subvention
    description: Dollars spent to enhance residual value above the anticipated market vale at end of OEM-supported lease term. ALG reported residual values are used to compare with PIN residual amounts to determine the subvention. PIN data are used to determine the take rates. Non-captive OEM supported leases are included effective Sep'12-forward.
    formula_id: formula_lease_residual_subvention
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: Trade-in Assistance Program
    description: Cash offered to leases or purchases with a traded-in vehicle. Manufacturer offers are used to determine the amount. PIN trade in penetration is used to calculate take rate.
    formula_id: formula_tradein_assistance_program
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Non-Core Incentive 4 Credit Union Member Discount
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: formula_noncoreincentive4_creditunionmemberdiscount
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Non-Core Incentive 7 Instant Value Certificate
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: formula_noncoreincentive7_instantvaluecertificate
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Loyalty Cash
    description: Cash offered to returning lessees on leases or purchases. Manufacturer offers are used to determine the amount. Loyalty calculation depends on program coverage (model, nameplate, OEM). PIN trade-in information and PIN lease penetration is used to calculate take rate.
    formula_id: formula_lease_loyalty_cash
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 3: Wgt''d $/unit'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 3: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 3: Take Rate'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 3: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 4: Wgt''d $/unit'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 4: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 4: Take Rate'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 4: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 5: Wgt''d $/unit'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 5: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 5: Take Rate'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 5: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 6: Wgt''d $/unit'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 6: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 6: Take Rate'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 6: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 7: Wgt''d $/unit'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 7: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 7: Take Rate'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 7: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 8: Wgt''d $/unit'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 8: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 8: Take Rate'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 8: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 9: Wgt''d $/unit'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 9: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 9: Take Rate'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 9: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 10: Wgt''d $/unit'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 10: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 10: Take Rate'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 10: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (Term <= 24): Wgt''d $/unit'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 24): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (Term <= 24): Take Rate'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 24): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (24<Term<=36): Wgt''d $/unit'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 36): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (24<Term<=36): Take Rate'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 36): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (36<Term<=48): Wgt''d $/unit'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 48): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (36<Term<=48): Take Rate'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 48): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (48<Term<=60): Wgt''d $/unit'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 60): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (48<Term<=60): Take Rate'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 60): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (60<Term<=72): Wgt''d $/unit'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 72): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (60<Term<=72): Take Rate'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 72): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention(Term>72): Wgt''d $/unit'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 84): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (Term>72): Take Rate'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 84): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Term Mix (Term <= 24)
    description: Mix of OEM-supported loans  for the term band specified
    formula_id: formula_Finance APR Term Mix (Term <= 24)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Term Mix (24<Term<=36)
    description: Mix of OEM-supported loans  for the term band specified
    formula_id: formula_Finance APR Term Mix (Term <= 36)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Term Mix (36<Term<=48)
    description: Mix of OEM-supported loans  for the term band specified
    formula_id: formula_Finance APR Term Mix (Term <= 48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Term Mix (48<Term<=60)
    description: Mix of OEM-supported loans  for the term band specified
    formula_id: formula_Finance APR Term Mix (Term <= 60)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Term Mix (60<Term<=72)
    description: Mix of OEM-supported loans  for the term band specified
    formula_id: formula_Finance APR Term Mix (Term <= 72)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Term Mix (Term>72)
    description: Mix of OEM-supported loans  for the term band specified
    formula_id: formula_Finance APR Term Mix (Term <= 84)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Total Finance APR
    formula_id: formula_Total Finance APR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Combo APR
    formula_id: formula_Combo APR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Monthly Payment (Term <= 24)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes. Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Finance APR Monthly Payment (Term <= 24)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Monthly Payment  (24<Term<=36)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes. Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Finance APR Monthly Payment (Term <= 36)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Monthly Payment (36<Term<=48)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes. Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Finance APR Monthly Payment (Term <= 48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Monthly Payment (48<Term<=60)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes. Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Finance APR Monthly Payment (Term <= 60)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Monthly Payment (60<Term<=72)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes. Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Finance APR Monthly Payment (Term <= 72)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Monthly Payment (Term>72)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes. Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Finance APR Monthly Payment (Term <= 84)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Total Finance APR Monthly Payment
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes. Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Total Finance Monthly Payment
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Combo Monthly Payment
    description: Monthly payment on OEM-supported combo offers across all terms. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes. Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Combo Monthly Payment
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (Term <= 24): Take Rate'
    description: The proportion of transactions bearing at least one of the three types of lease support (Lease Cash, Lease Residual, Lease APR Subvention) for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 24): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (Term <= 24): Wgt''d $/unit'
    description: Sum of offer for Lease Cash, Lease Residual, and Lease APR Subvention for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 24): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (24 < Term <= 36): Wgt''d $/unit'
    description: Sum of offer for Lease Cash, Lease Residual, and Lease APR Subvention for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 36): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (24 < Term <= 36): Take Rate'
    description: The proportion of transactions bearing at least one of the three types of lease support (Lease Cash, Lease Residual, Lease APR Subvention) for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 36): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (36 < Term <= 39): Wgt''d $/unit'
    description: Sum of offer for Lease Cash, Lease Residual, and Lease APR Subvention for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 39): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (36 < Term <= 39): Take Rate'
    description: The proportion of transactions bearing at least one of the three types of lease support (Lease Cash, Lease Residual, Lease APR Subvention) for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 39): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (39 < Term <= 48): Wgt''d $/unit'
    description: Sum of offer for Lease Cash, Lease Residual, and Lease APR Subvention for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 48): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (39 < Term <= 48): Take Rate'
    description: The proportion of transactions bearing at least one of the three types of lease support (Lease Cash, Lease Residual, Lease APR Subvention) for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 48): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (Term > 48): Wgt''d $/unit'
    description: Sum of offer for Lease Cash, Lease Residual, and Lease APR Subvention for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 60): Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (Term > 48): Take Rate'
    description: The proportion of transactions bearing at least one of the three types of lease support (Lease Cash, Lease Residual, Lease APR Subvention) for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 60): Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Lease APR (Term <= 24)
    description: Annual percentage rate of OEM-supported leases for the term band specified
    formula_id: formula_Lease APR (Term <= 24)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease APR (24 < Term <= 36)
    description: Annual percentage rate of OEM-supported leases for the term band specified
    formula_id: formula_Lease APR (Term <= 36)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease APR (36 < Term <= 39)
    description: Annual percentage rate of OEM-supported leases for the term band specified
    formula_id: formula_Lease APR (Term <= 39)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease APR (39 < Term <= 48)
    description: Annual percentage rate of OEM-supported leases for the term band specified
    formula_id: formula_Lease APR (Term <= 48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease APR (Term > 48)
    description: Annual percentage rate of OEM-supported leases for the term band specified
    formula_id: formula_Lease APR (Term <= 60)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Total Lease APR
    description: Annual percentage rate of OEM-supported leases, across all terms
    formula_id: formula_Total Lease APR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease Down Payment (Term <= 24)
    description: Average down payment on OEM-supported leases for the term band specified
    formula_id: formula_Lease APR Down Payment (Term <= 24)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Down Payment (24 < Term <= 36)
    formula_id: formula_Lease  APR Down Payment (Term <= 36)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Down Payment (36 < Term <= 39)
    description: Average down payment on OEM-supported leases for the term band specified
    formula_id: formula_Lease APR Down Payment (Term <= 39)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Down Payment (39 < Term <= 48)
    formula_id: formula_Lease  APR Down Payment (Term <= 48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Down Payment (Term > 48)
    description: Average down payment on OEM-supported leases for the term band specified
    formula_id: formula_Lease APR Down Payment (Term <= 60)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Total Lease Down Payment
    description: Average down payment on OEM-supported leases across all terms
    formula_id: formula_Total Lease APR Down Payment
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Total Lease Monthly Payment
    description: Weighted average monthly payment on OEM-supported loans across all terms. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes.  Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Total Lease Monthly Payment
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Monthly Payment (Term <= 24)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes.  Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Lease Monthly Payment (Term <= 24)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Monthly Payment (24 < Term <= 36)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes.  Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Lease Monthly Payment (Term <= 36)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Monthly Payment (36 < Term <= 39)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes.  Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Lease Monthly Payment (Term <= 39)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Monthly Payment (39 < Term <= 48)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes.  Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Lease Monthly Payment (Term <= 48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Monthly Payment (Term > 48)
    description: Weighted average monthly payment on OEM-supported loans for the term band specified. Note that monthly payments represented in PIN Explorer and PIN ISR are "out-the-door" payments inclusive of tax/title/fees as transmitted via dealer management systems. While payments are validated by PIN processes, they are not calculated outcomes.  Dealer-facing incentives are reflected in both transaction price and monthly payments to the extent that they are passed to consumers via the negotiation
    formula_id: formula_Lease Monthly Payment (Term <= 60)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Total Finance APR Down Payment
    description: Average down payment on OEM-supported loans across all terms
    formula_id: formula_Total Finance APR Down Payment
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Down Payment (Term <= 24)
    description: Average down payment on OEM-supported loans for the term band specified
    formula_id: formula_Finance Down Payment Term Mix (Term <=24)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Down Payment (24<Term<=36)
    description: Average down payment on OEM-supported loans for the term band specified
    formula_id: formula_Finance Down Payment Term Mix (Term <=36)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Down Payment (36<Term<=48)
    description: Average down payment on OEM-supported loans for the term band specified
    formula_id: formula_Finance Down Payment Term Mix (Term <=48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Down Payment (48<Term<=60)
    description: Average down payment on OEM-supported loans for the term band specified
    formula_id: formula_Finance Down Payment Term Mix (Term <=60)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Down Payment (60<Term<=72)
    description: Average down payment on OEM-supported loans for the term band specified
    formula_id: formula_Finance Down Payment Term Mix (Term <=72)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR Down Payment (Term>72)
    description: Average down payment on OEM-supported loans for the term band specified
    formula_id: formula_Finance Down Payment Term Mix (Term <=84)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Combo Down Payment
    description: Average down payment on OEM-supported combo offers across all terms
    formula_id: formula_Combo Down Payment
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Dealer Cash - Finance Type of Sale: Wgt''d $/unit'
    description: 'Cash paid directly to the dealer in form of per-vehicle payments for captive/preferred lender loan transactions. Manufacturer offers are used to determine the amount. PIN data are used to determine take rates. Assume applicable to all captive/preferred finance transactions unless otherwise specified. (For reference:  Ford Motor Credit Co., Toyota Motor Finance, etc... = Captive.  Chrysler Capital, Ally, and other recognized OEM-lender partnerships = Preferred lender)'
    formula_id: 'formula_Captive Lender Dealer Cash - Finance Type of Sale: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Dealer Cash - Finance Type of Sale: Take Rate'
    description: 'Cash paid directly to the dealer in form of per-vehicle payments for captive/preferred lender loan transactions. Manufacturer offers are used to determine the amount. PIN data are used to determine take rates. Assume applicable to all captive/preferred finance transactions unless otherwise specified. (For reference:  Ford Motor Credit Co., Toyota Motor Finance, etc... = Captive.  Chrysler Capital, Ally, and other recognized OEM-lender partnerships = Preferred lender)'
    formula_id: 'formula_Captive Lender Dealer Cash - Finance Type of Sale: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Cash - Lease Type of Sale: Wgt''d $/unit'
    description: Cash paid directly to dealers in form of per-vehicle payments on leased units. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume 100% penetration within type of sale if no restrictions apply.
    formula_id: 'formula_Dealer Cash - Lease Type of Sale: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Cash - Lease Type of Sale: Take Rate'
    description: Cash paid directly to dealers in form of per-vehicle payments on leased units. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume 100% penetration within type of sale if no restrictions apply.
    formula_id: 'formula_Dealer Cash - Lease Type of Sale: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Cash - Finance Type of Sale: Take Rate'
    description: Cash paid directly to dealers in form of per-vehicle payments, made to finance types of sale. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume 100% penetration within type of sale if no restrictions apply.
    formula_id: 'formula_Dealer Cash - Finance Type of Sale: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Cash - Finance Type of Sale: Wgt''d $/unit'
    description: Cash paid directly to dealers in form of per-vehicle payments, made to finance types of sale. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume 100% penetration within type of sale if no restrictions apply.
    formula_id: 'formula_Dealer Cash - Finance Type of Sale: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Visible Cash Incentive Spending Per Unit
    formula_id: formula_Visible Cash Incentive Spending Per Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: Normalized Monthly Payment
    formula_id: formula_Normalized Monthly Payment
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Cash Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Cash Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Finance Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Lease Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Visible Cash Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Visible Cash Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Visible Finance Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Visible Finance Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Visible Lease Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Visible Lease Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Visible Cash Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Non-Visible Cash Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: CFTP
    description: Customer-Facing Transaction Price (CFTP) is defined as vehicle price (field 14) less visible or customer-facing incentive spending/unit (field 233). Dealer-facing incentives (i.e., dealer cash, salesperson incentives, and certain non-core incentives such as dealer bonus certificates, inventory objective incentives, etc...) are already reflected in negotiated vehicle price to the extent that they are passed to the consumer and are therefore not again subtracted in this calculation. Please note that "employee pricing for all" discounts are included in both vehicle price and total incentive spending; this double-counting is resolved in the transaction price calculation.  Effective Jan'13-forward, CFTP reflects the value of federal tax credits for both leased and purchased HEV/EV units.  Published vehicle price does not include federal tax credits that are passed directly to the consumer for purchased hybrid/electric vehicles; this is also resolved in the transaction price calculation.
    formula_id: formula_CFTP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Incentives % of Vehicle Price
    formula_id: formula_Incentives % of Vehicle Price
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: ISR Weighted Counts
    description: Weighted counts ascribed in the aggregation process . This metric refers to the total population and is suitable for aggregating metrics found in the Incentive Spending Report (e.g. Incentive Spending/Unit or CFTP).
    formula_id: formula_ISR Weighted Counts
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {ISR: ''}
  - name: Transaction Count (ISR)
    description: The number of individual transactions returned for selected measures and options.
    formula_id: formula_Transaction Count
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {ISR: ''}
  - name: 'Customer Cash Rebate: Wgt''d $/unit'
    description: Cash offered directly to the consumer of the vehicle. Offer values reflect non-zero manufacturer offers and PIN data are used to determine the take rate.
    formula_id: 'formula_Customer Cash Rebate: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Customer Cash Rebate: Take Rate'
    description: Cash offered directly to the consumer of the vehicle. Offer values reflect non-zero manufacturer offers and PIN data are used to determine the take rate.
    formula_id: 'formula_Customer Cash Rebate: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Total Finance APR Subvention: Wgt''d $/unit'
    description: 'Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. (Note: OEM supported finance transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward.)'
    formula_id: 'formula_Total Finance APR Subvention: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Total Finance APR Subvention: Take Rate'
    description: 'Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. (Note: OEM supported finance transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward.)'
    formula_id: 'formula_Total Finance APR Subvention: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Total Combo Subvention: Wgt''d $/unit'
    description: 'Dollars spent to reduce captive/preferred lender finance payments below the current market rate, including the consumer cash portion. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Term-group specific cost of funds assumption is used as a baseline for comparison. (Note: OEM supported finance transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward.)'
    formula_id: 'formula_Total Combo Subvention: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Total Combo Subvention: Take Rate'
    description: 'Dollars spent to reduce captive/preferred lender finance payments below the current market rate, including the consumer cash portion. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Term-group specific cost of funds assumption is used as a baseline for comparison. (Note: OEM supported finance transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward.)'
    formula_id: 'formula_Total Combo Subvention: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Total Lease Subvention: Wgt''d $/unit'
    description: Sum of supported offer for Lease Cash, Lease Residual, and Lease APR Subvention. Non-captive OEM-supported leases are included effective Sep'12-forward.
    formula_id: 'formula_Total Lease Subvention: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Total Lease Subvention: Take Rate'
    description: Sum of supported offer for Lease Cash, Lease Residual, and Lease APR Subvention. Non-captive OEM-supported leases are included effective Sep'12-forward.
    formula_id: 'formula_Total Lease Subvention: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Consumer Bonus Cash: Wgt''d $/unit'
    description: Cash offered directly to the consumer for all purchases and leases. Manufacturer offers are used to determine the amount. Assume 100% penetration if no restrictions apply.
    formula_id: 'formula_Consumer Bonus Cash: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Consumer Bonus Cash: Take Rate'
    description: Cash offered directly to the consumer for all purchases and leases. Manufacturer offers are used to determine the amount. Assume 100% penetration if no restrictions apply.
    formula_id: 'formula_Consumer Bonus Cash: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Volume Bonus: Wgt''d $/unit'
    description: Cash paid directly to dealers for achieving sales goals which may or may not be known.  Achievement is calculated based on PIN estimated retail sales data where objectives are known.  Where objectives are not publicly available, standard assumption is that 75% of dealers reach the 100% payout-level objective.  Actual reporting assumptions will vary with market performance and other available information.
    formula_id: 'formula_Dealer Volume Bonus: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Volume Bonus: Take Rate'
    description: Cash paid directly to dealers for achieving sales goals which may or may not be known.  Achievement is calculated based on PIN estimated retail sales data where objectives are known.  Where objectives are not publicly available, standard assumption is that 75% of dealers reach the 100% payout-level objective.  Actual reporting assumptions will vary with market performance and other available information.
    formula_id: 'formula_Dealer Volume Bonus: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: OEM + Fedl Govt Incentive Spending $/unit
    description: The sum of OEM incentive spending  plus applicable federal tax credits for electric or hybrid electric vehicles
    formula_id: formula_OEM + Fedl Govt Incentive Spending $/unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: MSRP
    description: The manufacturer suggested retail price as recorded in the dealers finance and insurance (F&I) component of the dealer management system (DMS)
    formula_id: formula_MSRP ISR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: '% Non-Captive OEM Supported Lease'
    description: Non-captive lease with any OEM Supported Lease Cash, Lease Residual Subvention, or Lease APR Subvention
    formula_id: formula_% Non-Captive OEM Supported Lease
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Cash Incentive Penetration
    description: All transactions that are not captive, supported leases and not captive, supported loans or combo loans. Equal to or greater than the Customer Cash Rebate take rate. Effective Sep'12 non-captive OEM supported finance/lease is excluded.
    formula_id: formula_Cash Incentive Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Supported Finance Incentive Penetration
    description: Sum of Finance APR Subvention take rate and Combo APR Subvention take rate. Non-captive OEM-supported finance transactions are included effective Sep'12 forward.
    formula_id: formula_Supported Finance Incentive Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Supported Lease Incentive Penetration
    description: 'Sum of captive take rate with at lease one of the three: Lease Cash, Lease Residual, Lease APR Subvention. Non-captive OEM-supported leases are included effective Sep''12-forward.'
    formula_id: formula_Supported Lease Incentive Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Purchase Customer-Facing Transaction Price
    description: Consumer-facing transaction price for cash and finance transactions. Refer to field 16 for definition of consumer-facing transaction price
    formula_id: formula_Purchase Customer-Facing Transaction Price
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Lease Customer-Facing Transaction Price
    description: Consumer-facing transaction price for lease transactions. Refer to field 16 for definition of consumer-facing transaction price
    formula_id: formula_Lease Customer-Facing Transaction Price
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Customer Cash Rebate  $ Offer Value
    description: Cash offered directly to the consumer of the vehicle. Offer values reflect non-zero manufacturer offers and PIN data are used to determine the take rate.
    formula_id: formula_Customer cash rebate  $ offer value
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Total Finance APR Subvention: $ Offer'
    description: 'Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. (Note: OEM supported finance transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward.)'
    formula_id: 'formula_Total Finance APR Subvention: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Total Combo Subvention: $ Offer'
    description: 'Dollars spent to reduce captive/preferred lender finance payments below the current market rate, including the consumer cash portion. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Term-group specific cost of funds assumption is used as a baseline for comparison. (Note: OEM supported finance transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward.)'
    formula_id: 'formula_Total Combo Subvention: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Cash: $ Offer'
    description: 'Rebates for captive leased vehicles; consists of cash offered directly to the consumer for captive leases. Also referred to as cap cost reduction. Manufacturer offers are used to determine the amount. PIN data are used to determine the take rate. (Note: OEM supported lease transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward)'
    formula_id: 'formula_Lease Cash: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Residual Subvention: $ Offer'
    description: Dollars spent to enhance residual value above the anticipated market vale at end of OEM-supported lease term. ALG reported residual values are used to compare with PIN residual amounts to determine the subvention. PIN data are used to determine the take rates. Non-captive OEM supported leases are included effective Sep'12-forward.
    formula_id: 'formula_Lease Residual Subvention: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease APR Subvention: $ Offer'
    description: Dollars spent to reduce supported lease payments below the current market rate and the present value of residual enhancement. The precise structure of each lease (amount financed, term, APR, taxes, security deposit, etc.) is used to determine the exact present value of the interest subvention. Cost of funds rate is used as baseline for comparison. PIN data are used to determine the take rates. Non-captive OEM supported leases are included effective Sep'12-forward.
    formula_id: 'formula_Lease APR Subvention: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Total Lease Subvention: $ Offer'
    description: Sum of supported offer for Lease Cash, Lease Residual, and Lease APR Subvention. Non-captive OEM-supported leases are included effective Sep'12-forward.
    formula_id: 'formula_Total Lease Subvention: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Consumer Bonus Cash: $ Offer'
    description: Cash offered directly to the consumer for all purchases and leases. Manufacturer offers are used to determine the amount. Assume 100% penetration if no restrictions apply.
    formula_id: 'formula_Consumer Bonus Cash: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Customer Bonus - Finance Type of Sale: $ Offer'
    description: Cash offered directly to the consumer for loans facilitated via a specified captive/preferred lender. Manufacturer offers are used to determine the amount. PIN data are used to determine take rates. Assume applied to 100% of type of sale finance and captive, unless otherwise specified.
    formula_id: 'formula_Captive Lender Customer Bonus - Finance Type of Sale: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Customer Bonus - Lease Type of Sale: $ Offer'
    description: Cash offered directly to the consumer for leases facilitated via a specified captive/preferred lender. Manufacturer offers are used to determine the amount. PIN data are used to determine take rates. Assume applied to 100% of type of sale lease and captive, unless otherwise specified.
    formula_id: 'formula_Captive Lender Customer Bonus - Lease Type of Sale: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Cash - Cash Type of Sale: $ Offer'
    description: Cash paid directly to dealers in form of per-vehicle payments, applicable to transactions defined as cash type of sale. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume take rate of 100% within type of sale if no restrictions apply
    formula_id: 'formula_Dealer Cash - Cash Type of Sale: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Cash - Finance Type of Sale: $ Offer'
    description: Cash paid directly to dealers in form of per-vehicle payments, made to finance types of sale. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume 100% penetration within type of sale if no restrictions apply.
    formula_id: 'formula_Dealer Cash - Finance Type of Sale: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Cash - Lease Type of Sale: $ Offer'
    description: Cash paid directly to dealers in form of per-vehicle payments on leased units. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume 100% penetration within type of sale if no restrictions apply.
    formula_id: 'formula_Dealer Cash - Lease Type of Sale: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Dealer Cash - Lease Type of Sale: $ Offer'
    description: 'Cash paid directly to dealers in form of per-vehicle payments on leased units facilitated by captive/preferred lenders. Manufacturer offers are used to determine the amount for per-vehicle programs. Assume 100% penetration within type of sale if no restrictions apply.   (For reference:  Ford Motor Credit Co., Toyota Motor Finance, etc... = Captive.  Chrysler Capital, Ally, and other recognized OEM-lender partnerships = Preferred lender)'
    formula_id: 'formula_Captive Lender Dealer Cash - Lease Type of Sale: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Dealer Volume Bonus: $ Offer'
    description: Cash paid directly to dealers for achieving sales goals which may or may not be known.  Achievement is calculated based on PIN estimated retail sales data where objectives are known.  Where objectives are not publicly available, standard assumption is that 75% of dealers reach the 100% payout-level objective.  Actual reporting assumptions will vary with market performance and other available information.
    formula_id: 'formula_Dealer Volume Bonus: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Sales Spin: $ Offer'
    description: Dollars paid to sales managers or salespersons. Manufacturer offers are used to determine the amount. The midpoint is assumed as the average offer where offers consist of a range of outcomes.  Penetration is assumed to be 100% of applicable transactions
    formula_id: 'formula_Sales Spin: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Loyalty Cash: $ Offer'
    description: Cash offered to returning lessees on leases or purchases. Manufacturer offers are used to determine the amount. Loyalty calculation depends on program coverage (model, nameplate, OEM). PIN trade-in information and PIN lease penetration is used to calculate take rate.
    formula_id: 'formula_Lease Loyalty Cash: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Conquest Cash: $ Offer'
    description: Cash offered to consumers who currently own a competitive vehicles on leases or purchases. Manufacturer offers are used to determine the amount. PIN trade-in information is used to calculate take rate. Assume no trade-in necessary unless otherwise indicated.
    formula_id: 'formula_Conquest Cash: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Purchase Loyalty Cash: $ Offer'
    description: Cash offered to returning owners (including current lessees) on leases or purchases. Manufacturer offers are used to determine the available amount. Loyalty calculations depends on program coverage (model, nameplate, OEM). PIN trade-in information is used to calculate take rate. Unless otherwise described, assume no trade-in necessary.
    formula_id: 'formula_Purchase Loyalty Cash: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Aged Inventory Program: $ Offer'
    description: Cash offered to vehicles which have been in dealer inventory for longer than a prescribed number of days. Manufacturer offers are used to determine the amount. PIN days to turn is used to calculate take rate.
    formula_id: 'formula_Aged Inventory Program: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Trade-in Assistance Program: $ Offer'
    description: Cash offered to leases or purchases with a traded-in vehicle. Manufacturer offers are used to determine the amount. PIN trade in penetration is used to calculate take rate.
    formula_id: 'formula_Trade-in Assistance Program: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 1: $ Offer'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 1: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 2: $ Offer'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 2: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 3: $ Offer'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 3: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 4: $ Offer'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 4: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 5: $ Offer'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 5: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 6: $ Offer'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 6: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 7: $ Offer'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 7: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 8: $ Offer'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 8: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 9: $ Offer'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 9: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Incentive 10: $ Offer'
    description: Non-core programs treated on ad-hoc basis as they occur. Manufacturer offers used to determine the amount. PIN data or assumptions used to calculate take rate.
    formula_id: 'formula_Non-Core Incentive 10: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (Term <= 24): $ Offer'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 24): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention(24<Term<=36): $ Offer'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 36): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (36<Term<=48): $ Offer'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 48): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (48<Term<=60): $ Offer'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 60): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (60<Term<=72): $ Offer'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 72): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Finance APR Subvention (Term>72): $ Offer'
    description: Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. For term band specified.
    formula_id: 'formula_Finance APR Subvention (Term <= 84): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (Term <= 24): $ Offer'
    description: Sum of offer for Lease Cash, Lease Residual, and Lease APR Subvention for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 24): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (24 < Term <= 36): $ Offer'
    description: Sum of offer for Lease Cash, Lease Residual, and Lease APR Subvention for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 36): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (36 < Term <= 39): $ Offer'
    description: Sum of offer for Lease Cash, Lease Residual, and Lease APR Subvention for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 39): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (39 < Term <= 48): $ Offer'
    description: Sum of offer for Lease Cash, Lease Residual, and Lease APR Subvention for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 48): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease Subvention (Term > 48): $ Offer'
    description: Sum of offer for Lease Cash, Lease Residual, and Lease APR Subvention for the term band specified
    formula_id: 'formula_Lease Subvention (Term <= 60): $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: '% Cash Type of Sale'
    description: Purchase transaction in which the buyer pays for the total sale price of the vehicle or finances the vehicle through a lender not provided by the retailer ("Direct Lending")
    formula_id: formula_% Cash Type of Sale
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Cash With Customer Cash Rebate'
    description: Cash type of sale with a Customer Cash Rebate
    formula_id: formula_% Cash With Customer Cash Rebate
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Cash Without Customer Cash Rebate'
    description: Cash type of sale without a Customer Cash Rebate
    formula_id: formula_% Cash Without Customer Cash Rebate
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Visible Finance Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Non-Visible Finance Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Visible Lease Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Non-Visible Lease Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Core Cash Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Core Cash Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Core Finance Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Core Finance Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Core Lease Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Core Lease Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Cash Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Non-Core Cash Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Finance Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Non-Core Finance Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Non-Core Lease Incentive Spending: Wgt''d $/unit'
    formula_id: 'formula_Non-Core Lease Incentive Spending: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: MSRP (Explorer)
    description: The manufacturer suggested retail price as recorded in the dealers finance and insurance (F&I) component of the dealer management system (DMS)
    formula_id: formula_MSRP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: '% Finance Type of Sale'
    description: Purchase transaction in which the buyer finances part or all of the total price of the vehicle through a lender facilitated by the retailer ("Indirect Lending")
    formula_id: formula_% Finance Type of Sale
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Captive Supported Finance APR'
    description: 'Dollars spent to reduce captive/preferred lender finance payments below the current market rate. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Prime rate is used as the base cost of fund. (Note: OEM supported finance transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward.)'
    formula_id: formula_% Captive Supported Finance APR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Captive Supported Combo'
    description: 'Dollars spent to reduce captive/preferred lender finance payments below the current market rate, including the consumer cash portion. PIN data, including amount financed, term, and actual interest rate, are used to determine the amount. PIN data are used to determine the take rate. Term-group specific cost of funds assumption is used as a baseline for comparison. (Note: OEM supported finance transactions facilitated via preferred but non-captive lenders are included effective Sep''12-forward.)'
    formula_id: formula_% Captive Supported Combo
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Captive Non-Supported Finance With Customer Cash Rebate'
    description: 'Proportion of sample involving a captive/preferred lender loan with rates > offered rate + allowance for dealer mark-up that are assumed to be accompanied by a Customer Cash Rebate in lieu of rate support. Note: PIN tracks only rates available to qualified consumers'
    formula_id: formula_% Captive Non-Supported Finance With Customer Cash Rebate
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Captive Non-Supported Finance Without Customer Cash Rebate'
    description: 'Proportion of sample involving a captive/preferred lender loan with rates > offered rate + allowance for dealer mark-up for which a OEM-offered cash rebate is not applicable. Note: PIN tracks only rates available to qualified consumers'
    formula_id: formula_% Captive Non-Supported Finance Without Customer Cash Rebate
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Non-Captive OEM Supported Finance'
    description: Proportion of sample involving APR support via a non-captive but OEM-supported lender
    formula_id: formula_% Non-Captive OEM Supported Finance
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Non-Captive Non-Supported Finance'
    description: Proportion of sample involving a non-captive lender without OEM-supported rates
    formula_id: formula_% Non-Captive Non-Supported Finance
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Lease Type of Sale'
    description: Proportion of sample involving a lease wherein consumers opt to pay for a specified proportion of the vehicle's value over a specified term at a specified rate
    formula_id: formula_% Lease Type of Sale
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Captive Supported Lease'
    description: 'Sum of captive take rate with at lease one of the three: Lease Cash, Lease Residual, Lease APR Subvention. Non-captive OEM-supported leases are included effective Sep''12-forward.'
    formula_id: formula_% Captive Supported Lease
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Captive Non-Supported Lease With Customer Cash Rebate'
    description: Captive lease without any Lease Cash, Lease Residual Subvention, or Lease APR Subvention but with Customer Cash Rebate
    formula_id: formula_% Captive Non-Supported Lease With Customer Cash Rebate
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Captive Non-Supported Lease Without Customer Cash Rebate'
    description: Captive lease without any Lease Cash, Lease Residual Subvention, or Lease APR Subvention but without Customer Cash Rebate
    formula_id: formula_% Captive Non-Supported Lease Without Customer Cash Rebate
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Non-Captive Non-Supported Lease'
    description: Non-captive lease without any OEM Supported Lease Cash, Lease Residual Subvention, or Lease APR Subvention
    formula_id: formula_% Non-Captive Non-Supported Lease
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Visible Spending/Unit
    description: 'Visible incentives are those that would be disclosed to the consumer via the sales process and specifically exclude those that are dealer-facing and do not require consumer disclosure (i.e., dealer cash or dealer-facing certificate programs that do not require consumer acknowledgment).  Sum of "Wgt''d $/unit" for: Customer Cash Rebate, Total Finance APR Subvention, Total Combo Subvention, Total Lease Subvention, Consumer Bonus Cash, Captive Lender Customer Bonus - Finance Type of Sale, Captive Lender Customer Bonus - Lease Type of Sale, Lease Loyalty Cash, Conquest Cash, Purchase Loyalty Cash, as well as Trade-In Assistance, Aged Inventory and other non-core incentives classified as visible according to program documents. (Note that Trade-In Assistance and Aged Inventory programs may be visible or non-visible; classification is entirely dependent upon specific program guidelines)'
    formula_id: formula_Visible Spending/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Cash Incentive Offering/Unit
    description: Average value of incentives applicable to transactions classified as cash incentive type.  Inclusive of both core rebate/dealer cash support as well as other compatible programs (i.e., conquest, loyalty, bonus cash) as applicable. Average offer value is arrived at by computing the average incentive spending for cash incentive transactions and dividing that figure by the proportion of transactions receiving cash support.  As such, zero-value offers are not reflected in the offer value but are instead captured via diminished penetration rates.
    formula_id: formula_Cash Incentive Offering/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Supported Finance Incentive Offering/Unit
    description: Total offer (core + compatible programs) for transactions classified as finance incentive type (supported rates via captive or OEM-supported preferred lender effective Sep'12-forward)
    formula_id: formula_Supported Finance Incentive Offering/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Supported Lease Incentive Offering/Unit
    description: Total offer (core + compatible programs) for transactions classified as lease incentive type (supported rates via captive or OEM-supported preferred lender effective Sep'12-forward)
    formula_id: formula_Supported Lease Incentive Offering/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Non-Visible Spending/Unit
    description: 'Sum of "Wgt''d $/unit" for: Dealer Cash - Cash Type of Sale, Dealer Cash - Finance Type of Sale, Dealer Cash - Lease Type of Sale, Captive Lender Dealer Cash - Finance Type of Sale, Captive Lender Dealer Cash - Lease Type of Sale, Dealer Volume Bonus, Sales Spin, Aged Inventory Program, Trade-In Assistance Program, and non-core incentives classified as non-visible by PIN.'
    formula_id: formula_Non-Visible Spending/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Core Spending/Unit
    description: 'Sum of "Wgt''d $/unit" for: Customer Cash Rebate, Total Finance APR Subvention, Total Combo Subvention, Total Lease Subvention, Consumer Bonus Cash'
    formula_id: formula_Core Spending/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: '% Core Spending'
    description: Proportion of weighted spending/unit that is defined as "Core"
    formula_id: formula_% Core Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% No Traditional Incentives Penetration'
    description: 'Proportion of customers who do not receive any of following: Customer Cash Rebate, Total Finance APR Subvention, Total Combo Subvention, or Total Lease Subvention. Some/all of this group may, however, receive other incentives listed in the report.'
    formula_id: formula_% No Traditional Incentives Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Traditional Incentives Penetration'
    description: 'Proportion of customers who receive one of: Customer Cash Rebate, Total Finance APR Subvention, Total Combo Subvention, or Total Lease Subvention. Some/all of this group may, however, receive other incentives listed in the report.'
    formula_id: formula_% Traditional Incentives Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Total Penetration'
    description: Quality check to ensure that sum of the incentive penetration adds to 100%.
    formula_id: formula_% Total Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Visible Cash Offer/Unit
    description: Average visible offer for cash incentive types.
    formula_id: formula_Visible Cash Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Visible Finance Offer/Unit
    description: Average visible offer for finance incentive types.
    formula_id: formula_Visible Finance Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Visible Lease Offer/Unit
    description: Average visible offer for lease incentive types
    formula_id: formula_Visible Lease Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Non-Visible Cash Offer/Unit
    formula_id: formula_Non-Visible Cash Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Non-Visible Finance Offer/Unit
    description: Total offer across all incentive types on captive, supported APR or Combo offers.
    formula_id: formula_Non-Visible Finance Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Non-Visible Lease Offer/Unit
    description: Total offer across all incentive types on captive, supported leases.
    formula_id: formula_Non-Visible Lease Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Core Cash Offer/Unit
    formula_id: formula_Core Cash Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Core Finance Offer/Unit
    description: Total offer across all incentive types on captive, supported APR or Combo offers.
    formula_id: formula_Core Finance Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Core Lease Offer/Unit
    description: Total offer across all incentive types on captive, supported leases.
    formula_id: formula_Core Lease Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Non-Core Cash Offer/Unit
    formula_id: formula_Non-Core Cash Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Non-Core Finance Offer/Unit
    description: Total offer across all incentive types on captive, supported APR or Combo offers.
    formula_id: formula_Non-Core Finance Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Non-Core Lease Offer/Unit
    description: Total offer across all incentive types on captive, supported leases.
    formula_id: formula_Non-Core Lease Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Non-Core Spending/Unit
    formula_id: formula_Non-Core Spending/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: OEM Revenue
    description: Retail Sales multiplied by Revenue / Unit
    formula_id: formula_OEM Revenue
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: OEM Inc. Tax Credit
    formula_id: formula_OEM Inc. Tax Credit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Captive Lender Dealer Cash - Finance Type of Sale: $ Offer'
    description: 'Cash paid directly to the dealer in form of per-vehicle payments for captive/preferred lender loan transactions. Manufacturer offers are used to determine the amount. PIN data are used to determine take rates. Assume applicable to all captive/preferred finance transactions unless otherwise specified. (For reference:  Ford Motor Credit Co., Toyota Motor Finance, etc... = Captive.  Chrysler Capital, Ally, and other recognized OEM-lender partnerships = Preferred lender)'
    formula_id: 'formula_Captive Lender Dealer Cash - Finance Type of Sale: $ Offer'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Distribution Weight
    formula_id: formula_Distribution Weight
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Distribution Attributes: ''}
  - name: Filter - Age
    formula_id: formula_Filter - Age
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Filters: ''}
  - name: Filter - CFTP
    formula_id: formula_Filter - CFTP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###.##'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Filters: ''}
  - name: Filter - Credit Score
    formula_id: formula_Filter - Credit Score
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Filters: ''}
  - name: Filter - Days Supply
    formula_id: formula_Filter - Days Supply
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Filters: ''}
  - name: Filter - Days To Turn
    formula_id: formula_Filter - Days To Turn
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Filters: ''}
  - name: Filter - FI Income
    formula_id: formula_Filter - FI Income
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###.##'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Filters: ''}
  - name: Finance APR
    formula_id: formula_Avg Finance APR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Finance Term
    formula_id: formula_Avg Finance Term
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease APR
    formula_id: formula_Avg Lease APR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Filter - Lease Term
    formula_id: formula_Filter - Lease Term
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Filters: ''}
  - name: Filter - APR Lease
    formula_id: formula_Filter - APR Lease
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Filters: ''}
  - name: Filter - MO PMT Lease
    formula_id: formula_Filter - MO PMT Lease
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###.##'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Filters: ''}
  - name: Filter - APR Fin
    formula_id: formula_Filter - APR Fin
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Filters: ''}
  - name: Filter - MO PMT Fin
    formula_id: formula_Filter - MO PMT Fin
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###.##'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Filters: ''}
  - name: Filter - Finance Term
    formula_id: formula_Filter - Finance Term
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Filters: ''}
  - name: Filter - MSRP
    formula_id: formula_Filter - MSRP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###.##'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Filters: ''}
  - name: Filter - Total PIN Gross Profit
    formula_id: formula_Filter - Total PIN Gross Profit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###.##'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Filters: ''}
  - name: Filter - Vehicle Gross
    formula_id: formula_Filter - Vehicle Gross
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###.##'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Filters: ''}
  - name: Filter - Trade ACV LP
    formula_id: formula_Filter - Trade ACV LP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###.##'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Filters: ''}
  - name: Distribution Group Calc
    formula_id: formula_Distribution Group Calc
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Distribution Attributes: ''}
  - name: DMA
    formula_id: formula_DMA
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Geographic Attributes: ''}
  - name: State
    formula_id: formula_State
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      geo_config:
        region_name:
          country: UNITED STATES
          region_name: state
    data_panel_column_groups: {Geographic Attributes: ''}
  - name: Country
    formula_id: formula_Country
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Geographic Attributes: ''}
  - name: Client Segment
    description: Client specific segmentation (i.e., Compact, Midsize, Large)
    formula_id: formula_Client Segment
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Segmentation Attributes: ''}
  - name: Region
    formula_id: formula_PIN Region
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Geographic Attributes: ''}
  - name: Market
    formula_id: formula_PIN Market
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Geographic Attributes: ''}
  - name: Top 11 DMA
    formula_id: formula_PIN Top 11 DMA
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Geographic Attributes: ''}
  - name: Sales Year
    formula_id: formula_Sales Year
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Time: ''}
  - name: Sales Quarter
    formula_id: formula_Sales Quarter
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Time: ''}
  - name: Sales Month (String)
    formula_id: formula_Sales Month (String)
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Sales Week
    formula_id: formula_Sales Week
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Time: ''}
  - name: Sales Day
    formula_id: formula_Sales Day
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Time: ''}
  - name: Distribution Dimension 1
    formula_id: formula_Distribution Dimension 1
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Distribution Attributes: ''}
  - name: Distribution Dimension 2
    formula_id: formula_Distribution Dimension 2
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Distribution Attributes: ''}
  - name: Distribution Dimension 3
    formula_id: formula_Distribution Dimension 3
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Distribution Attributes: ''}
  - name: Max Date
    formula_id: formula_Max Date
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Current Month
    formula_id: formula_Current Month
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Previous Month
    formula_id: formula_Previous Month
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Previous Month CFTP
    formula_id: formula_Previous Month CFTP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Current Month CFTP
    formula_id: formula_Current Month CFTP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: MoM CFTP
    formula_id: formula_MoM CFTP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Current Month Previous Year CFTP
    formula_id: formula_Current Month Previous Year CFTP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: YoY CFTP
    formula_id: formula_YoY CFTP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Previous 13 Months
    formula_id: formula_Previous 13 Months
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Previous 13 Months CFTP
    formula_id: formula_Previous 13 Months CFTP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Current Month Incentive Spending
    formula_id: formula_Current Month Incentive Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Previous Month Incentive Spending
    formula_id: formula_Previous Month Incentive Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Current Month Previous Year Incentive Spending
    formula_id: formula_Current Month Previous Year Incentive Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: MoM Incentive Spending
    formula_id: formula_MoM Incentive Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: YoY Incentive Spending
    formula_id: formula_YoY Incentive Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Previous 13 Months Incentive Spending
    formula_id: formula_Previous 13 Months Incentive Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Current Month Retail Share
    formula_id: formula_Current Month Retail Share
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Current Month Inventory Share
    formula_id: formula_Current Month Inventory Share
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Previous Month Retail Share
    formula_id: formula_Previous Month Retail Share
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Previous Month Inventory Share
    formula_id: formula_Previous Month Inventory Share
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: MoM Retail Share
    formula_id: formula_MoM Retail Share
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: MoM Inventory Share
    formula_id: formula_MoM Inventory Share
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: YoY Retail Share
    formula_id: formula_YoY Retail Share
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: YoY Inventory Share
    formula_id: formula_YoY Inventory Share
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: 13 Month Trend Dim
    formula_id: formula_13 Month Trend Dim
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Previous 13 Month Retail Share
    formula_id: formula_Previous 13 Month Retail Share
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Previous 13 Months Inventory Share
    formula_id: formula_Previous 13 Months Inventory Share
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Trade Aspiration
    formula_id: formula_Trade Aspiration
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Bodytype
    formula_id: formula_Trade Bodytype
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Class
    formula_id: formula_Trade Class
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Color
    formula_id: formula_Trade Color
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Cylinders
    formula_id: formula_Trade Cylinders
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Displacement
    formula_id: formula_Trade Displacement
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Doors
    formula_id: formula_Trade Doors
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Drivetype
    formula_id: formula_Trade Drivetype
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Fueltype
    formula_id: formula_Trade Fueltype
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Model
    formula_id: formula_Trade Model
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Modelyear
    formula_id: formula_Trade Modelyear
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Nameplate
    formula_id: formula_Trade Nameplate
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade OEM
    formula_id: formula_Trade OEM
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Platform
    formula_id: formula_Trade Platform
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Trade Segment
    formula_id: formula_Trade Segment
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: Finance 84M PMT  (73-84)
    formula_id: formula_84M PMT - Finance (73-84)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Finance 72M PMT (61-72)
    formula_id: formula_72M PMT - Finance (61-72)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Finance 60M PMT (49-60)
    formula_id: formula_60M PMT - Finance (49-60)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Amount Financed
    formula_id: formula_Average Amount Financed
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: APR
    description: The annualized percentage rate paid by a customer on the financed or leased vehicle.
    formula_id: formula_Average APR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Finance Lease Reserve
    formula_id: formula_Average Finance Lease Reserve
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
    data_panel_column_groups: {Transaction Data: ''}
  - name: Weighted Counts of Male customers
    formula_id: formula_Weighted Counts of Male customers
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Weighted Counts of Female customers
    formula_id: formula_Weighted Counts of Female customers
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Disability Insurance
    formula_id: formula_Average Disability Insurance
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Disability Income
    formula_id: formula_Average Disability Income
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Total Price
    formula_id: formula_Average Total Price
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Negative Equity Weighted Counts
    formula_id: formula_Negative Equity Weighted Counts
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Equity Weighted Counts
    formula_id: formula_Equity Weighted Counts
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Trade Equity Percent
    formula_id: formula_Average Trade Equity Percent
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
    data_panel_column_groups: {Transaction Data: ''}
  - name: Weighted Counts of Pre-Boomer buyer transactions
    formula_id: formula_Weighted Counts of Pre-Boomer buyer transactions
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Weighted Counts of Boomer buyer transactions
    formula_id: formula_Weighted Counts of Boomer buyer transactions
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Weighted Counts of Generation X buyer transactions
    formula_id: formula_Weighted Counts of Generation X buyer transactions
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Weighted Counts of Generation Y buyer transactions
    formula_id: formula_Weighted Counts of Generation Y buyer transactions
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Weighted Counts of Generation Z buyer transactions
    formula_id: formula_Weighted Counts of Generation Z buyer transactions
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Transaction Data: ''}
  - name: Weighted Counts of All other generation buyer transactions
    formula_id: formula_Weighted Counts of All other generation buyer transactions
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
    data_panel_column_groups: {Transaction Data: ''}
  - name: Purchase Incentive Offering/Unit
    description: Average offer value across all transactions not classified as receiving lease support.
    formula_id: formula_Purchase Incentive Offering/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: Purchase Incentive Penetration
    description: Proportion of weighted sample that receive finance or cash incentive type support (excludes transactions that receive captive/preferred lender lease support). Note that non-captive lease transactions that are deemed compatible with customer cash rebates are included in this result.
    formula_id: formula_Purchase Incentive Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Total Finance APR Term Mix
    description: Sum of OEM-supported loans'  mix across all terms = 100%
    formula_id: formula_Total Finance APR Term Mix
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR (24<Term<=36)
    description: Annual percentage rate of OEM-supported loans for the term band specified
    formula_id: formula_Finance APR (24<Term<=36)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR (36<Term<=48)
    description: Annual percentage rate of OEM-supported loans for the term band specified
    formula_id: formula_Finance APR (36<Term<=48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR (48<Term<=60)
    description: Annual percentage rate of OEM-supported loans for the term band specified
    formula_id: formula_Finance APR (48<Term<=60)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR (60<Term <= 72)
    description: Annual percentage rate of OEM-supported loans for the term band specified
    formula_id: formula_Finance APR (60<Term <= 72)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR (Term <= 24)
    description: Annual percentage rate of OEM-supported loans for the term band specified
    formula_id: formula_Finance APR (Term <= 24)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR (Term>72)
    description: Annual percentage rate of OEM-supported loans for the term band specified
    formula_id: formula_Finance APR (Term>72)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR / Combo Cost of Funds (48<Term<=60)
    description: Apply markup vs. 11th District Cost of Funds Index across industry, or apply manufacturer assumptions. Effective Jan'2022-Utilizing Federal  Cost of Funds Index (COFI) in lieu of 11th District Cost of Funds Index.
    formula_id: formula_Finance APR / Combo Cost of Funds (48<Term<=60)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR / Combo Cost of Funds (Term<=48)
    description: Apply markup vs. 11th District Cost of Funds Index across industry, or apply manufacturer assumptions. Effective Jan'2022-Utilizing Federal  Cost of Funds Index (COFI) in lieu of 11th District Cost of Funds Index.
    formula_id: formula_Finance APR / Combo Cost of Funds (Term<=48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Finance APR / Combo Cost of Funds (Term>60)
    description: Apply markup vs. 11th District Cost of Funds Index across industry, or apply manufacturer assumptions. Effective Jan'2022-Utilizing Federal  Cost of Funds Index (COFI) in lieu of 11th District Cost of Funds Index.
    formula_id: formula_Finance APR / Combo Cost of Funds (Term>60)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Lease Cost of Funds
    formula_id: formula_Lease Cost of Funds
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Lease Term Mix (24 < Term <= 36)
    description: Mix of OEM-supported leases for the term band specified
    formula_id: formula_Lease Term Mix (24 < Term <= 36)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Lease Term Mix (36 < Term <= 39)
    description: Mix of OEM-supported leases for the term band specified
    formula_id: formula_Lease Term Mix (36 < Term <= 39)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Lease Term Mix (39 < Term <= 48)
    description: Mix of OEM-supported leases for the term band specified
    formula_id: formula_Lease Term Mix (39 < Term <= 48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Lease Term Mix (Term <= 24)
    description: Mix of OEM-supported leases for the term band specified
    formula_id: formula_Lease Term Mix (Term <= 24)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Lease Term Mix (Term > 48)
    description: Mix of OEM-supported leases for the term band specified
    formula_id: formula_Lease Term Mix (Term > 48)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: Total Lease Term Mix
    description: Sum of OEM-supported lease mix across all terms = 100%
    formula_id: formula_Total Lease Term Mix
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Non-Core Spending'
    description: Proportion of weighted spending/unit that is defined as "Non-Core"
    formula_id: formula_% Non-Core Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Non-Visible Spending'
    formula_id: formula_% Non-Visible Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: '% Visible Spending'
    description: Proportion of weighted spending/unit that is defined as visible.
    formula_id: formula_% Visible Spending
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Purchase CFTP: Take Rate'
    formula_id: 'formula_Purchase CFTP: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {ISR: ''}
  - name: 'Purchase CFTP: Wgt''d $/unit'
    formula_id: 'formula_Purchase CFTP: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease CFTP: Take Rate'
    formula_id: 'formula_Lease CFTP: Take Rate'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: 'Lease CFTP: Wgt''d $/unit'
    formula_id: 'formula_Lease CFTP: Wgt''d $/unit'
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: Rightsizing Rules
    formula_id: formula_Rightsizing Rules
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: All
    formula_id: formula_All
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Other Attributes: ''}
  - name: Non-Visible Cash Incentive Offer/Unit
    formula_id: formula_Non-Visible Cash Incentive Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: Non-Visible Finance Incentive Offer/Unit
    formula_id: formula_Non-Visible Finance Incentive Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: Non-Visible Lease Incentive Offer/Unit
    formula_id: formula_Non-Visible Lease Incentive Offer/Unit
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
      is_hidden: true
    data_panel_column_groups: {ISR: ''}
  - name: Male %
    formula_id: formula_Male %
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Female %
    formula_id: formula_Female %
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Total SAAR
    formula_id: formula_Total SAAR
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##'
    data_panel_column_groups: {Retail Sales: ''}
  - name: National
    formula_id: formula_National
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
  - name: Class
    formula_id: formula_Class
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: last 3 year
    formula_id: formula_last 3 year
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
  - name: Type of Sale - Market Timer
    formula_id: formula_Type of Sale - Market Timer
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Market Timer Attributes: ''}
  - name: Returning Volume Purchase
    formula_id: formula_Returning Volume Purchase
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
    data_panel_column_groups: {Market Timer: ''}
  - name: Returning Payment Lease
    formula_id: formula_Returning Payment Lease
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
    data_panel_column_groups: {Market Timer: ''}
  - name: Returning Payment Purchase
    formula_id: formula_Returning Payment Purchase
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
    data_panel_column_groups: {Market Timer: ''}
  - name: Returning Total Down Lease
    formula_id: formula_Returning Total Down Lease
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
    data_panel_column_groups: {Market Timer: ''}
  - name: Returning Total Down Purchase
    formula_id: formula_Returning Total Down Purchase
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
    data_panel_column_groups: {Market Timer: ''}
  - name: Return Period
    formula_id: formula_Return Period
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Market Timer Attributes: ''}
  - name: Return Year
    formula_id: formula_Return Year
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Market Timer Attributes: ''}
  - name: Term Group (Market Timer)
    formula_id: formula_Term Group (Market Timer)
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Market Timer Attributes: ''}
  - name: Rightsizing Rules Test
    formula_id: formula_Rightsizing Rules Test
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
  - name: New Date Filter
    formula_id: formula_New Date Filter
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
  - name: 72mo+ Term Mix
    formula_id: formula_72mo+ Term Mix
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: 84mo+ Term Mix
    formula_id: formula_84mo+ Term Mix
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: CFTP Above MSRP (%)
    formula_id: formula_CFTP Above MSRP (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: 0.00%
    data_panel_column_groups: {ISR: ''}
  - name: Trade Series
    formula_id: formula_Trade Series
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Trade Attributes: ''}
  - name: CFTP % of MSRP
    formula_id: formula_CFTP % of MSRP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: 0.00%
    data_panel_column_groups: {ISR: ''}
  - name: Trade In %
    formula_id: formula_Trade In %
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Vehicle Price % of MSRP
    formula_id: formula_Vehicle Price % of MSRP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
  - name: Captive %
    formula_id: formula_Captive %
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Returning Volume
    formula_id: formula_Returning Volume
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
    data_panel_column_groups: {Market Timer: ''}
  - name: Vehicleprice Pct Msrp
    formula_id: formula_Vehicleprice Pct Msrp
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      is_hidden: true
  - name: Vehicle Price Above MSRP (%)
    formula_id: formula_Vehicle Price Above MSRP (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
  - name: Equalized payments (Finance)
    formula_id: formula_Equalized payments (Finance)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Equalized payments (Lease)
    formula_id: formula_Equalized payments (Lease)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: CFTP PCT MSRP
    formula_id: formula_CFTP PCT MSRP
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      is_hidden: true
  - name: City of Origin
    formula_id: formula_City of Origin
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: State of Origin
    formula_id: formula_State of Origin
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Country of Origin
    formula_id: formula_Country of Origin
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Filter - Vehicle Price
    formula_id: formula_Filter - Vehicle Price
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
      format_pattern: '#,###.##'
      currency_type:
        iso_code: USD
  - name: Cash %
    formula_id: formula_Cash %
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Finance - Non-Captive %
    formula_id: formula_Finance - Non-Captive %
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Finance - Captive %  All Type of Sales
    formula_id: formula_Finance - Captive %  All Type of Sales
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease - Captive % All Type of Sales Sales
    formula_id: formula_Lease - Captive % All Type of Sales Sales
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease - Non-Captive %
    formula_id: formula_Lease - Non-Captive %
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: AH Insurance Income
    formula_id: formula_AH Insurance Income
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Total PIN F&I Income (PVR)
    formula_id: formula_Total PIN F&I Income (PVR)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Trade In Same Manufacturer (%)
    formula_id: formula_Trade In Same Manufacturer (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Trade-In: ''}
  - name: Trade In Same Nameplate (%)
    formula_id: formula_Trade In Same Nameplate (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Trade-In: ''}
  - name: Source Filter
    formula_id: formula_Source Filter
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
  - name: Date Filter
    formula_id: formula_Date Filter
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
  - name: Tesla and Premium Filter
    formula_id: formula_Tesla and Premium Filter
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
  - name: Vehicle Price (Explorer)
    formula_id: formula_Vehicle Price (Explorer)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: AH Insurance Penetration (%)
    formula_id: formula_AH Insurance Penetration (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: AH Insurance Premium
    formula_id: formula_AH Insurance Premium
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Cash Rebate Penetration (%)
    formula_id: formula_Cash Rebate Penetration (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Loan to Value (%)
    formula_id: formula_Loan to Value (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Percent Financed
    formula_id: formula_Percent Financed
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Total Down (%)
    formula_id: formula_Total Down (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Trade Payoff
    formula_id: formula_Trade Payoff
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: Type of Sale Purchase (%)
    formula_id: formula_Type of Sale Purchase (%)
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Vehicle Price Less Cash Rebate
    formula_id: formula_Vehicle Price Less Cash Rebate
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Transaction Data: ''}
  - name: JD Power Segment
    description: J.D. Power vehicle segmentation (i.e., Compact, Midsize, Large)
    formula_id: formula_JD Power Segment
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Segmentation Attributes: ''}
  - name: Total Spend Less DVB
    formula_id: formula_Total Spend Less DVB
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
  - name: KWH
    formula_id: formula_KWH
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Distance Per Charge
    formula_id: formula_Distance Per Charge
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Vehicle Attributes: ''}
  - name: Loan to Cost
    formula_id: formula_Loan to Cost
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
  - name: Customer Cash Rebate Penetration
    formula_id: formula_Customer Cash Rebate Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
  - name: Finance - Captive % Finance Sales
    formula_id: formula_Finance - Captive % Finance Sales
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Lease - Captive %  Lease Sales
    formula_id: formula_Lease - Captive %  Lease Sales
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Filter - Vehicle Age
    formula_id: formula_Filter - Vehicle Age
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
    data_panel_column_groups: {Filters: ''}
  - name: Finance Reserve Penetration
    formula_id: formula_Finance Reserve Penetration
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#.##%'
    data_panel_column_groups: {Transaction Data: ''}
  - name: Consumer Expenditure
    formula_id: formula_Consumer Expenditure
    properties:
      column_type: MEASURE
      aggregation: SUM
      index_type: DONT_INDEX
      format_pattern: '#,###'
      currency_type:
        iso_code: USD
    data_panel_column_groups: {Retail Sales: ''}
  - name: Type of Sale
    column_id: PIN_RETAIL_DATA_DIGEST_FINAL_V3::typeofsale
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Transaction Attributes: ''}
  - name: Source
    column_id: PIN_RETAIL_DATA_DIGEST_FINAL_V3::source
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Other Attributes: ''}
  - name: Sales Month
    column_id: PIN_RETAIL_DATA_DIGEST_FINAL_V3::monthind_dt
    properties:
      column_type: ATTRIBUTE
    data_panel_column_groups: {Time: ''}
  - name: Close Date
    column_id: PIN_RETAIL_DATA_DIGEST_FINAL_V3::closedate
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
    data_panel_column_groups: {Time: ''}
  properties:
    is_bypass_rls: false
    join_progressive: true
    spotter_config:
      is_spotter_enabled: false
  parameters:
  - id: 768a8541-c03d-4bc5-a7e6-bf02bcc0238f
    name: 13 Month Trend Dimension
    data_type: CHAR
    default_value: Nameplate
    list_config:
      list_choice:
      - value: OEM
      - value: Nameplate
      - value: Model
      - value: Series
      - value: Segment
      - value: Super Segment
      - value: Class
      - value: Industry
    description: ''
  - id: 5a499037-6282-4444-850c-4263c797ec25
    name: Bucket Size
    data_type: INT64
    default_value: '10'
    description: Select Bucket Size
  - id: 2f8ee106-3f7d-4b41-9fd3-9c185af7bfea
    name: Dimension
    data_type: CHAR
    default_value: a
    list_config:
      list_choice:
      - value: a
        display_name: Nameplate
      - value: b
        display_name: Nameplate + Model
      - value: c
        display_name: Nameplate + Model + Model Year
    description: Dimension
  - id: 4d44aa48-49ca-4a12-9b93-1c077d1a32f3
    name: Distribution Metric
    data_type: CHAR
    default_value: Age
    list_config:
      list_choice:
      - value: Age
      - value: CFTP
      - value: Credit Score
      - value: DaysToTurn
      - value: DaysSupply
      - value: FI Income
      - value: Finance APR
      - value: Finance Monthly Payment
      - value: Finance Term
      - value: Lease APR
      - value: Lease Monthly Payment
      - value: Lease Term
      - value: MSRP Distribution
      - value: Total Gross Profit
      - value: Trade ACV LP Distribution
      - value: Vehicle Gross
      - value: Vehicle Price
    description: Select the metric to be distributed and select the bucket size
  - id: 66513574-c2f9-467d-b843-1aada2e8980a
    name: Month Parameter
    data_type: DATE
    default_value: 09/30/2024
    description: ''
  - id: 483fa5db-e4ea-49fe-a368-b6f8d0303fed
    name: Period
    data_type: CHAR
    default_value: Rolling 13 Months
    list_config:
      list_choice:
      - value: Current Month
      - value: YTD
      - value: Rolling 2 Months
      - value: Rolling 3 Months
      - value: Rolling 4 Months
      - value: Rolling 5 Months
      - value: Rolling 6 Months
      - value: Rolling 12 Months
      - value: Rolling 13 Months
      - value: Rolling 24 Months
      - value: Rolling 25 Months
      - value: Rolling 36 Months
      - value: Rolling 37 Months
      - value: Rolling 2 Years
      - value: Rolling 3 Years
      - value: Rolling Dates
    description: ''
  - id: 4c07ecac-1284-4c09-a64a-b8dda850f7bd
    name: Select Distribution by Dimension 1
    data_type: CHAR
    default_value: Nameplate
    list_config:
      list_choice:
      - value: Aspiration
      - value: Body Type
      - value: Body Type Detail
      - value: Captive/ Non-Captive
      - value: Class
      - value: Cylinders
      - value: Dealer Market Area
      - value: Displacement
      - value: Doors
      - value: Drive Type
      - value: Fuel Type
      - value: Incentive Type
      - value: Market
      - value: Model
      - value: Model Year
      - value: Nameplate
      - value: New/Used
      - value: OEM
      - value: Region
      - value: Transmission Type
      - value: Trim
      - value: Type of Sale
      - value: Sales Time (Year)
      - value: Sales Time (Month)
      - value: Sales Time (Quarter)
      - value: Sales Time (Week)
      - value: Sales Time (Day)
      - value: Sector
      - value: Segment
      - value: Series
      - value: State
      - value: Super Segment
    description: Select the 1st Dimension for distribution
  - id: f1c8d3d0-4445-4ea4-8100-6406aa66a01a
    name: Select Distribution by Dimension 2
    data_type: CHAR
    default_value: 'Off'
    list_config:
      list_choice:
      - value: 'Off'
      - value: Aspiration
      - value: Body Type
      - value: Body Type Detail
      - value: Captive/ Non-Captive
      - value: Class
      - value: Cylinders
      - value: Dealer Market Area
      - value: Displacement
      - value: Doors
      - value: Drive Type
      - value: Fuel Type
      - value: Incentive Type
      - value: Market
      - value: Model
      - value: Model Year
      - value: Nameplate
      - value: New/Used
      - value: OEM
      - value: Region
      - value: Transmission Type
      - value: Trim
      - value: Type of Sale
      - value: Sales Time (Year)
      - value: Sales Time (Month)
      - value: Sales Time (Quarter)
      - value: Sales Time (Week)
      - value: Sales Time (Day)
      - value: Sector
      - value: Segment
      - value: Series
      - value: State
      - value: Super Segment
    description: Select the 2nd Dimension for distribution
  - id: e47e867a-fbe9-4278-a7dd-436b2bb42e95
    name: Select Distribution by Dimension 3
    data_type: CHAR
    default_value: 'Off'
    list_config:
      list_choice:
      - value: 'Off'
      - value: Aspiration
      - value: Body Type
      - value: Body Type Detail
      - value: Captive/ Non-Captive
      - value: Class
      - value: Cylinders
      - value: Dealer Market Area
      - value: Displacement
      - value: Doors
      - value: Drive Type
      - value: Fuel Type
      - value: Incentive Type
      - value: Market
      - value: Model
      - value: Model Year
      - value: Nameplate
      - value: New/Used
      - value: OEM
      - value: Region
      - value: Transmission Type
      - value: Trim
      - value: Type of Sale
      - value: Sales Time (Year)
      - value: Sales Time (Month)
      - value: Sales Time (Quarter)
      - value: Sales Time (Week)
      - value: Sales Time (Day)
      - value: Sector
      - value: Segment
      - value: Series
      - value: State
      - value: Super Segment
    description: Select the 3rd Dimension for distribution
  column_groups:
  - type: DATA_PANEL
    properties:
      status: ENABLE
      default_sort: DISABLE
    column_group_info:
    - name: Category of Sale
      include_ungrouped_columns: false
    - name: Time
      include_ungrouped_columns: false
    - name: Vehicle Attributes
      include_ungrouped_columns: false
    - name: Segmentation Attributes
      include_ungrouped_columns: false
    - name: Geographic Attributes
      include_ungrouped_columns: false
    - name: Transaction Attributes
      include_ungrouped_columns: false
    - name: Trade Attributes
      include_ungrouped_columns: false
    - name: Inventory
      include_ungrouped_columns: false
    - name: Retail Sales
      include_ungrouped_columns: false
    - name: ISR
      include_ungrouped_columns: true
    - name: Transaction Data
      include_ungrouped_columns: false
    - name: Navigator
      include_ungrouped_columns: false
    - name: Trade-In
      include_ungrouped_columns: false
    - name: Market Timer Attributes
      include_ungrouped_columns: false
    - name: Market Timer
      include_ungrouped_columns: false
    - name: Total Sales
      include_ungrouped_columns: false
    - name: Filters
      include_ungrouped_columns: false
    - name: Distribution Attributes
      include_ungrouped_columns: false
    - name: Other Attributes
      include_ungrouped_columns: false
